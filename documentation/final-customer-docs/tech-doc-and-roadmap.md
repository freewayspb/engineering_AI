# Техническая документация и план реализации продукта BA_AI_GOST

**Версия**: 0.1 (черновик для заказчика)  
**Дата**: 2025-XX-XX  
**Назначение**: Самодостаточное описание целевой архитектуры, инфраструктуры и плана перехода от прототипа к промышленной версии (без ссылок на другие папки).

---

## 1. Обзор и цель
- Продукт: локальная система ИИ для обработки инженерных документов (PDF, ARP/GSFX/XML, RTF/DOCX, XLSX/CSV, изображения), ответы на запросы, отчёты и нормативные проверки.
- Отличие от прототипа: усиленные требования к безопасности, масштабированию, эксплуатации (мониторинг, бэкапы), интеграции и управлению версиями.

## 2. Целевая архитектура (высокоуровнево)
- Компоненты: клиент (web/desktop), backend API, слой ML/LLM (локальные модели), сервисы обработки файлов (OCR, штампы, таблицы, сметы, нормативка), хранилище артефактов/логов, база знаний/контекстов, реестр шаблонов Excel, нормативная база.
- Интеграции: двусторонний REST API (получение знаний, обратная связь), вебхуки уведомлений, проектные шаблоны/подписки на контекст, экспорт/импорт контекстов между проектами.
- Безопасность: air-gapped, ACL по ролям и проектам, аудит действий, шифрование данных при хранении/передаче, управление токенами API.
- Мониторинг: метрики по шагам обработки (время, ошибки), состояние очередей/пайплайнов, статус моделей, место на диске, доступность сервисов.

## 3. RAG-пайплайн (ответы на запросы)
- Документы (PDF/RTF/DOCX/текстовые артефакты) нарезаются на фрагменты и кодируются локальной embedding-моделью.
- Векторная база (локальная, без интернета) хранит индексы по проектам/ACL; при запросе выполняется поиск похожих фрагментов.
- Запрос кодируется и используется для семантического поиска; найденные фрагменты + исходный запрос формируют prompt.
- LLM (локальная модель) отвечает на основе prompt; ответ включает ссылки на использованные фрагменты для трассировки.
- Требования: раздельные индексы по проектам; очистка/повторное индексирование при обновлении контекста; хранение trace (какие фрагменты участвовали).

## 4. Инфраструктура и развёртывание
- Контейнеризация: Docker/Compose; сервисы разнесены по контейнерам (backend, клиент, модели).
- Окружения: тест/прод в локальном контуре; конфиги через ENV/файлы; кеши моделей/образов.
- Минимальные требования (целевые для SLA): уточнить CPU/GPU, RAM, диск; хранение артефактов/логов/версий.
- Политики: лимиты на размер файлов/страниц/листов, ретенция логов/артефактов, резервное копирование и восстановление.

## 5. Управление версиями и конфигурациями
- Версионирование: контексты обучения, артефакты (штамп/таблицы/сметы), шаблоны Excel, нормативная база; поддержка rollback.
- Конфигурации: пути данных, лимиты, активные шаблоны, приоритетные ГОСТ/СП, параметры моделей; хранение в управляемых конфиг-файлах/ENV.
- CI/CD (в локальном контуре): сборка/тест/развёртывание контейнеров; контроль версий образов и конфигов; процедура обновления/отката.

## 6. План перехода от прототипа к прод (этапы)
- Этап 1: Уточнение входных данных и шаблонов (эталоны PDF/смет/нормативки, Excel шаблоны ПТО/сметы, приоритетные ГОСТ/СП); настройка лимитов и контрольных наборов.
- Этап 2: Усиление пайплайнов и метрик (производительность на целевом железе, обработка DXF, round-trip смет, проверки шаблонов, отчёты о несоответствиях нормативки).
- Этап 3: Безопасность и операции (ACL/аудит, шифрование, мониторинг/алертинг, бэкапы, регламенты поддержки, SLA реакции).
- Этап 4: Интеграции и API (внешние системы, вебхуки, экспорт/импорт контекстов, проектные шаблоны/подписки).
- Этап 5: Приёмка и стабилизация (контрольный пакет, достижение метрик, обучение пользователей, финальный релиз).

## 7. Дорожная карта (примерно)
- Контрольные точки: согласование контрольных наборов и шаблонов; подтверждение SLA на целевом стенде; включение мониторинга/бэкапов; запуск внешнего API; финальная приёмка.
- Приоритеты: сначала данные/шаблоны/ГОСТ, затем производительность и безопасность, далее интеграции и эксплуатация.
- Артефакты на выходе: отчёты об испытаниях, настройки окружений, инструкции по эксплуатации, пользовательские/админские гайды.

## 8. Риски и митигации
- Качество входных данных (низкие сканы, большие DXF, неполные сметы) → предобработка, согласованные лимиты и контрольные наборы.
- Зависимость от локальных моделей → кеши, тесты качества на стенде, возможность обновления/отката моделей.
- Нормативка/шаблоны → требуется список приоритетов, регламент обновлений и проверки.
- Производительность/ресурсы → уточнение конфигурации оборудования, профилирование на реальных данных.
- Интеграции → согласование форматов API/webhook, управление токенами и правами.

## 9. Эксплуатация и поддержка
- Мониторинг/алертинг: время этапов, ошибки OCR/валидаций, состояние очередей, доступность сервисов, свободное место.
- Бэкапы/ретенция: артефакты, логи, база знаний/контекстов, шаблоны; периодичность и хранение; проверка восстановления.
- Поддержка: регламент реакции на инциденты, повторные запуски шагов, ведение журнала инцидентов.

## 10. Открытые вопросы
- Уточнить требования к железу (CPU/GPU/RAM/диск) и лимиты по размерам файлов/страниц.
- Предоставить эталоны шаблонов Excel (ПТО/сметы) и приоритетные ГОСТ/СП.
- Согласовать контрольные наборы для метрик (OCR/штампы/таблицы/сметы/нормативка/экспорт).
- Определить внешние системы для интеграции и форматы API/webhook.
- Согласовать политику ретенции логов/артефактов и регламенты бэкапов/восстановления.
