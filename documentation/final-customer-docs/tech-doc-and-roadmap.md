# Техническая документация и план реализации продукта BA_AI_GOST

**Версия**: 0.1 (черновик для заказчика)  
**Дата**: 2025-XX-XX  
**Назначение**: Самодостаточное описание целевой архитектуры, инфраструктуры и плана перехода от прототипа к промышленной версии (без ссылок на другие папки).

---

## 1. Обзор и цель
Описание: целевой продукт — локальная система ИИ для обработки инженерных документов, выдачи ответов и отчётов, с повышенными требованиями к безопасности, масштабированию и эксплуатации.
- Продукт: работа с PDF, ARP/GSFX/XML, RTF/DOCX, XLSX/CSV, изображениями; RAG для запросов; нормативные проверки.
- Отличие от прототипа: усиленные меры безопасности, мониторинг/бэкапы, интеграции, управление версиями артефактов/контекстов.

## 2. Целевая архитектура (высокоуровнево)
Описание: целевые компоненты и принципы архитектуры.
- Требования:
  - Компоненты: клиент (web/desktop), backend API, локальные LLM/embedding модели, сервисы обработки файлов (OCR/штампы/таблицы/сметы/нормативка), хранилища артефактов/логов, база знаний/контекстов, реестр шаблонов Excel, нормативная база.
  - Интеграции: REST API (знания + обратная связь), вебхуки уведомлений, проектные шаблоны/подписки, экспорт/импорт контекстов между проектами.
  - Безопасность: air-gapped, ACL по ролям/проектам, аудит, шифрование при хранении/передаче, управление токенами API, сегментация сети и секреты в защищённом хранилище.
  - Мониторинг: время/ошибки шагов, состояние очередей, статус моделей, дисковое пространство, доступность сервисов, SLA ответов/генерации отчётов, контроль заполнения индексов/хранилищ.
  - Хранение: предсказуемая структура артефактов/логов/версий, раздельные каталоги по projectId/датам, политика ретенции и бэкапов.
- Комментарии:
  - Согласовать приоритеты интеграций и список внешних систем.
  - Уточнить формат хранения базы знаний/нормативки и ретенцию (сроки, размер, путь).

## 3. RAG-пайплайн (ответы на запросы)
Описание: цепочка Retrieval-Augmented Generation для ответов.
- Требования:
  - Документы нарезаются на фрагменты и кодируются embedding-моделью; индексы ведутся по проектам/ACL.
  - Запрос кодируется, выполняется семантический поиск; найденные фрагменты + запрос формируют prompt.
  - LLM отвечает локально; в ответе — ссылки на использованные фрагменты (trace).
- Комментарии:
  - Нужны политики нарезки (размер чанк/перекрытие) и повторного индексирования при обновлении контекста.
  - Требуется согласовать хранение/очистку индексов по проектам, ретенцию и регламенты деградации при переполнении.

## 4. Инфраструктура и развёртывание
Описание: как развёртываем и на чём.
- Требования:
  - Docker/Compose; отдельные контейнеры для backend, клиента, моделей.
  - Окружения test/prod в локальном контуре; конфиги через ENV/файлы; кеши моделей/образов.
  - Уточнить CPU/GPU, RAM, диск для целевых SLA; организовать хранение артефактов/логов/версий (раздельные тома, квоты).
  - Лимиты: размер файлов/страниц/листов; ретенция логов/артефактов; бэкап/restore процедурно; ограничения на размер индексов и кэш моделей.
  - Сети и доступы: обязательная сегментация, закрытые исходящие соединения, разрешённые порты/хосты внутри контура.
- Комментарии:
  - Согласовать конкретные лимиты и расписание бэкапов/проверок восстановления.

## 5. Управление версиями и конфигурациями
Описание: как храним версии и настройки.
- Требования:
  - Версии для контекстов обучения, артефактов (штамп/таблицы/сметы), шаблонов, нормативной базы; поддержка rollback/compare.
  - Конфиги: пути данных, лимиты, активные шаблоны, приоритетные ГОСТ/СП, параметры моделей — в управляемых файлах/ENV.
  - CI/CD (локальный): сборка/тест/деплой контейнеров; контроль версий образов/конфигов; процедуры обновления/отката; smoke/rollback планы.
  - Ретенция: сроки хранения версий/логов/артефактов, правила очистки, архивы для нормативки и шаблонов.
- Комментарии:
  - Уточнить глубину истории версий и регламент очистки/архивации.

## 6. План перехода от прототипа к прод (этапы)
Описание: шаги для выхода в прод.
- Этап 1: данные/шаблоны/ГОСТ — собрать эталоны PDF/смет/нормативки, Excel шаблоны ПТО/сметы, приоритетные ГОСТ/СП; настроить лимиты и контрольные наборы.
- Этап 2: пайплайны/метрики — производительность на целевом железе, DXF, round-trip смет, проверки шаблонов, отчёты о несоответствиях.
- Этап 3: безопасность/операции — ACL/аудит, шифрование, мониторинг/алертинг, бэкапы, регламенты поддержки, SLA реакции.
- Этап 4: интеграции/API — внешние системы, вебхуки, экспорт/импорт контекстов, проектные шаблоны/подписки.
- Этап 5: приёмка/стабилизация — контрольный пакет, достижение метрик, обучение пользователей, финальный релиз.

## 7. Дорожная карта (примерно)
- Контрольные точки: согласование контрольных наборов и шаблонов; подтверждение SLA на целевом стенде; включение мониторинга/бэкапов; запуск внешнего API; финальная приёмка.
- Приоритеты: сначала данные/шаблоны/ГОСТ, затем производительность и безопасность, далее интеграции и эксплуатация.
- Артефакты на выходе: отчёты об испытаниях, настройки окружений, инструкции по эксплуатации, пользовательские/админские гайды.

## 8. Риски и митигации
- Качество входных данных (низкие сканы, большие DXF, неполные сметы) → предобработка, согласованные лимиты и контрольные наборы.
- Зависимость от локальных моделей → кеши, тесты качества на стенде, возможность обновления/отката моделей.
- Нормативка/шаблоны → требуется список приоритетов, регламент обновлений и проверки.
- Производительность/ресурсы → уточнение конфигурации оборудования, профилирование на реальных данных.
- Интеграции → согласование форматов API/webhook, управление токенами и правами.

## 9. Эксплуатация и поддержка
- Мониторинг/алертинг: время этапов, ошибки OCR/валидаций, состояние очередей, доступность сервисов, свободное место.
- Бэкапы/ретенция: артефакты, логи, база знаний/контекстов, шаблоны; периодичность и хранение; проверка восстановления.
- Поддержка: регламент реакции на инциденты, повторные запуски шагов, ведение журнала инцидентов.

## 10. Открытые вопросы
- Уточнить требования к железу (CPU/GPU/RAM/диск) и лимиты по размерам файлов/страниц.
- Предоставить эталоны шаблонов Excel (ПТО/сметы) и приоритетные ГОСТ/СП.
- Согласовать контрольные наборы для метрик (OCR/штампы/таблицы/сметы/нормативка/экспорт).
- Определить внешние системы для интеграции и форматы API/webhook.
- Согласовать политику ретенции логов/артефактов и регламенты бэкапов/восстановления.
