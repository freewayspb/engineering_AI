# Техническое задание и план работ продукта AI GOST

**Версия**: 0.1 (черновик для заказчика)  
**Дата**: 2025-XX-XX  
**Назначение**: Описание целевой архитектуры, инфраструктуры и плана перехода от прототипа к промышленной версии.

---

## 0. Словарь терминов (кратко)
- **Учитель** / **Пользователь** / **Администратор**: роли для загрузки/обработки/администрирования, настроек и обновлений.
- **Проектный контекст**: projectId/rdCipher обязательны для данных и операций; ACL ограничивает доступ.
- **Артефакт**: результат или проверка (text/tables/titleBlock/estimate/validationReport/routeDecision/итоговые Excel/CSV/JSON, логи).
- **ACL**: управление доступом по ролям и проектам.
- **SLA**: целевые сроки операций (OCR, ответы, экспорт, проверки).
- **OCR/CER/WER**: распознавание текста и метрики точности (символы/слова).
- **Estimate**: унифицированная модель сметы (разделы → позиции → ресурсы).
- **ГОСТ/СП**: локальная нормативная база.
- **RAG**: Retrieval-Augmented Generation (векторный поиск + LLM).
- **Round-trip**: импорт формата → нормализация → экспорт без потерь структуры/формул.

## 1. Обзор и цель
Описание: целевой продукт — локальная система ИИ для обработки инженерных документов, выдачи ответов и отчётов, с повышенными требованиями к безопасности, масштабированию и эксплуатации.
- Продукт: работа с PDF, ARP/GSFX/XML, RTF/DOCX, XLSX/CSV, изображениями; RAG для запросов; нормативные проверки.
- Отличие от прототипа: усиленные меры безопасности, мониторинг/бэкапы, интеграции, управление версиями артефактов/контекстов.

## 1.1 Работы и результаты этапа
- Сбор требований и бизнес-кейсов: интервью, формализация сценариев, ограничения по ИБ/интеграциям.
- Анализ решений и выбор моделей: оценка LLM/embedding, OCR/штампа, табличных и сметных парсеров; критерии — точность, оффлайн, стоимость владения, удобство интеграции.
- Прототипы по минимальным изолированным задачам: OCR/штамп PDF; таблицы PDF/DXF; сметы ARP/GSFX/XML; нормативка/выжимки; RAG-ответы/trace.
- Архитектурная схема и документация: целевая схема, принципы безопасности, управление версиями/артефактами, регламенты мониторинга и бэкапов.
- Перечень и номенклатура оборудования для опытно-промышленного стенда: CPU/GPU/RAM/диск, сегментация сети, тома под артефакты/логи/индексы, регламенты бэкапов/ретенции.

## 2. Целевая архитектура (высокоуровнево)
Описание: целевые компоненты и принципы архитектуры.
- Требования:
  - Компоненты: клиент (web/desktop), адаптивный веб-клиент для мобильных устройств, backend API, локальные LLM/embedding модели, сервисы обработки файлов (OCR/штампы/таблицы/сметы/нормативка), хранилища артефактов/логов, база знаний/контекстов, реестр шаблонов Excel, конструктор отчетных форм (принцип «Чистого листа»), конструктор чат-ботов (принцип «без ИТ-инженеров»), модуль организационной структуры (дерево системы на основе штатного расписания), VPN-сервер для удаленного доступа (опционально), нормативная база.
  - Интеграции: REST API (знания + обратная связь), вебхуки уведомлений, проектные шаблоны/подписки, экспорт/импорт контекстов между проектами, интеграции «Розетка» (plug-and-play подключение к внешним БД: ERP, ECM/ДОУ, CAD, бухгалтерские системы).
  - Принцип «Чистого листа»: визуальный конструктор отчетных форм с минимальными программными ограничениями, позволяющий Администратору и Учителю создавать произвольные формы для экспорта информации без привлечения ИТ-инженеров; поддержка всех форматов экспорта (XLSX, CSV, XML, RTF, PDF, DWG, DXF, ARP, GSFX, JSON); использование созданных форм как шаблонов для однотипных проектов.
  - Принцип «без ИТ-инженеров» для чат-ботов: текстовый конструктор чат-ботов с подсказками и примерами, позволяющий Администратору создавать специализированные чат-боты для конкретных задач (сметы, ГОСТы, проекты, обработка документов, генерация отчетов) без привлечения высококвалифицированных ИТ-инженеров; поддержка функций взаимодействия сотрудников (передача задач, уведомления, координация); шаблоны ботов и возможность создания кастомных ботов.
  - Принцип «Розетки» для интеграций: библиотека готовых адаптеров для типовых систем (ERP, ECM/ДОУ, CAD, бухгалтерские системы) с стандартизированным интерфейсом подключения (plug-and-play); возможность добавления кастомных адаптеров; двусторонний обмен данными (экспорт и импорт); простое подключение внешних систем силами Администратора без привлечения ИТ-инженеров.
  - Управляемое взаимодействие с сетью Ethernet: возможность включения/выключения сетевого доступа по необходимости; ограниченное взаимодействие (только исходящий трафик для экспорта, без входящих соединений); белые списки разрешенных адресов/протоколов/портов; временные окна для экспорта; обязательное шифрование (TLS/SSL); аудит всех сетевых операций; сохранение основного режима air-gapped.
  - Удаленные мобильные рабочие места: адаптивный веб-интерфейс для мобильных устройств (планшеты, смартфоны) с оптимизацией под сенсорное управление; опциональное VPN-подключение для доступа извне локальной сети; ограниченный набор функций для мобильного доступа (текстовые запросы, просмотр отчетов, статус обработки, уведомления, просмотр проектов); настройка мобильного доступа администратором (включение/выключение, права доступа, VPN-управление); безопасность (двухфакторная аутентификация опционально, шифрование TLS/SSL, ACL, аудит, автоматическое отключение неактивных сессий).
  - Формирование дерева системы на основе штатного расписания: импорт штатного расписания из Excel/CSV с автоматическим построением иерархической структуры подразделений (организация → департаменты → отделы → группы); привязка пользователей к подразделениям и должностям; привязка проектов к подразделениям (опционально); использование структуры для фильтрации данных, настройки прав доступа по подразделениям, отчетности по подразделениям, назначения задач; управление структурой (редактирование, синхронизация с актуальным штатным расписанием, версионирование).
  - Безопасность: air-gapped (основной режим), управляемое/ограниченное взаимодействие с сетью Ethernet для экспорта (только исходящий трафик, белые списки, временные окна), ACL по ролям/проектам, аудит, шифрование при хранении/передаче, управление токенами API, сегментация сети и секреты в защищённом хранилище.
  - Мониторинг: время/ошибки шагов, состояние очередей, статус моделей, дисковое пространство, доступность сервисов, SLA ответов/генерации отчётов, контроль заполнения индексов/хранилищ.
  - Хранение: предсказуемая структура артефактов/логов/версий, раздельные каталоги по projectId/датам, политика ретенции и бэкапов.
- Комментарии:
  - Согласовать приоритеты интеграций и список внешних систем.
  - Уточнить формат хранения базы знаний/нормативки и ретенцию (сроки, размер, путь).
  - Конструктор отчетных форм должен быть реализован как отдельный модуль с возможностью независимого обновления и масштабирования.

## 2.1 Анализ решений и выбор моделей
Описание: выбран стек и критерии отбора.
- Критерии: оффлайн/air-gapped, точность на контрольных данных, стоимость владения и размер моделей, скорость на целевом железе, простота интеграции в пайплайны.
- Выбранный стек:
  - LLM/RAG: локальные модели Ollama (llama3.1, deepseek-r1) + эмбеддинги; RAG с индексами по проектам/ACL.
  - OCR/штамп: локальный OCR с предобработкой; детект штампа из PDF с координатами/confidence.
  - Таблицы: детекция табличных областей PDF/DXF, восстановление структуры, извлечение ценовых полей.
  - Сметы: парсинг ARP/GSFX/XML в единую модель Estimate, round-trip экспорт/импорт.
  - Нормативка: локальная база ГОСТ/СП, правила/выжимки, отчёты о несоответствиях.
- Требуется уточнить: финальные версии моделей под продуктив, пороги метрик, комплект контрольных данных.

## 3. RAG-пайплайн (ответы на запросы)
Описание: цепочка Retrieval-Augmented Generation для ответов.
- Требования:
  - Документы нарезаются на фрагменты и кодируются embedding-моделью; индексы ведутся по проектам/ACL.
  - Запрос кодируется, выполняется семантический поиск; найденные фрагменты + запрос формируют prompt.
  - LLM отвечает локально; в ответе — ссылки на использованные фрагменты (trace).
- Комментарии:
  - Нужны политики нарезки (размер чанк/перекрытие) и повторного индексирования при обновлении контекста.
  - Требуется согласовать хранение/очистку индексов по проектам, ретенцию и регламенты деградации при переполнении.

## 4. Инфраструктура и развёртывание
Описание: как развёртываем и на чём.
- Требования:
  - Docker/Compose; отдельные контейнеры для backend, клиента, моделей.
  - Окружения test/prod в локальном контуре; конфиги через ENV/файлы; кеши моделей/образов.
  - Уточнить CPU/GPU, RAM, диск для целевых SLA; организовать хранение артефактов/логов/версий (раздельные тома, квоты).
  - Лимиты: размер файлов/страниц/листов; ретенция логов/артефактов; бэкап/restore процедурно; ограничения на размер индексов и кэш моделей.
  - Сети и доступы: обязательная сегментация, закрытые исходящие соединения, разрешённые порты/хосты внутри контура.
- Комментарии:
  - Согласовать конкретные лимиты и расписание бэкапов/проверок восстановления.

## 5. Управление версиями и конфигурациями
Описание: как храним версии и настройки.
- Требования:
  - Версии для контекстов обучения, артефактов (штамп/таблицы/сметы), шаблонов, нормативной базы; поддержка rollback/compare.
  - Конфиги: пути данных, лимиты, активные шаблоны, приоритетные ГОСТ/СП, параметры моделей — в управляемых файлах/ENV.
  - CI/CD (локальный): сборка/тест/деплой контейнеров; контроль версий образов/конфигов; процедуры обновления/отката; smoke/rollback планы.
  - Ретенция: сроки хранения версий/логов/артефактов, правила очистки, архивы для нормативки и шаблонов.
- Комментарии:
  - Уточнить глубину истории версий и регламент очистки/архивации.

## 6. План перехода от прототипа к прод (этапы)
Описание: шаги для выхода в прод.
- Этап 1: данные/шаблоны/ГОСТ — собрать эталоны PDF/смет/нормативки, Excel шаблоны ПТО/сметы, приоритетные ГОСТ/СП; настроить лимиты и контрольные наборы.
- Этап 2: пайплайны/метрики — производительность на целевом железе, DXF, round-trip смет, проверки шаблонов, отчёты о несоответствиях.
- Этап 3: безопасность/операции — ACL/аудит, шифрование, мониторинг/алертинг, бэкапы, регламенты поддержки, SLA реакции.
- Этап 4: интеграции/API — внешние системы, вебхуки, экспорт/импорт контекстов, проектные шаблоны/подписки.
- Этап 5: приёмка/стабилизация — контрольный пакет, достижение метрик, обучение пользователей, финальный релиз.

## 6.1 План на 30 дней (этап текущего договора)
- Неделя 1: интервью и сбор требований/кейсов; фиксируем ограничения ИБ/интеграций; утверждаем контрольные наборы данных.
- Неделя 2: прототипы OCR/штамп, таблицы PDF/DXF; первичная оценка метрик; сбор обратной связи.
- Неделя 3: прототип смет ARP/GSFX/XML, нормативка/выжимки, RAG-ответы; корректировки по метрикам и SLA.
- Неделя 4: целевая архитектура и оборудование; актуализация технического задания; финальный пакет артефактов (ТЗ, отчёт по моделям, результаты прототипов) для приёмки.

## 7. Дорожная карта (примерно)
- Контрольные точки: согласование контрольных наборов и шаблонов; подтверждение SLA на целевом стенде; включение мониторинга/бэкапов; запуск внешнего API; финальная приёмка.
- Приоритеты: сначала данные/шаблоны/ГОСТ, затем производительность и безопасность, далее интеграции и эксплуатация.
- Артефакты на выходе: отчёты об испытаниях, настройки окружений, инструкции по эксплуатации, пользовательские/админские гайды.

## 8. Риски и митигации
- Качество входных данных (низкие сканы, большие DXF, неполные сметы) → предобработка, согласованные лимиты и контрольные наборы.
- Зависимость от локальных моделей → кеши, тесты качества на стенде, возможность обновления/отката моделей.
- Нормативка/шаблоны → требуется список приоритетов, регламент обновлений и проверки.
- Производительность/ресурсы → уточнение конфигурации оборудования, профилирование на реальных данных.
- Интеграции → согласование форматов API/webhook, управление токенами и правами.

## 9. Эксплуатация и поддержка
- Мониторинг/алертинг: время этапов, ошибки OCR/валидаций, состояние очередей, доступность сервисов, свободное место.
- Бэкапы/ретенция: артефакты, логи, база знаний/контекстов, шаблоны; периодичность и хранение; проверка восстановления.
- Поддержка: регламент реакции на инциденты, повторные запуски шагов, ведение журнала инцидентов.

## 9.1 Оборудование и инфраструктура (опытно-промышленный стенд)
- Минимум: CPU 8 vCPU, RAM 32 GB, диск 200 GB SSD (отдельные тома: артефакты/логи/индексы), сегментация сети, закрытые исходящие соединения.
- Рекомендация: CPU 16 vCPU, RAM 64 GB, диск 500 GB SSD + опционально GPU (NVIDIA 16–24 GB VRAM) для ускорения OCR/LLM; отдельные тома для моделей, артефактов, логов, индексов.
- Сети и доступы: air-gapped, разрешённые порты только внутри контура, секреты в защищённом хранилище, аудит действий.
- Бэкапы и ретенция: ежедневные инкрементальные, еженедельные полные; проверка восстановления; ретенция логов/артефактов по согласованной политике.
- Требуется подтвердить: финальные лимиты по размеру файлов/индексов, расписание бэкапов, конфигурацию аппаратуры у заказчика.

## 10. Открытые вопросы
- Уточнить требования к железу (CPU/GPU/RAM/диск) и лимиты по размерам файлов/страниц.
- Предоставить эталоны шаблонов Excel (ПТО/сметы) и приоритетные ГОСТ/СП.
- Согласовать контрольные наборы для метрик (OCR/штампы/таблицы/сметы/нормативка/экспорт).
- Определить внешние системы для интеграции и форматы API/webhook.
- Согласовать политику ретенции логов/артефактов и регламенты бэкапов/восстановления.

#### 11 Используемые модели
- Текущая конфигурация прототипа: см. `prototype-description.md` (фактические модели и ограничения пилотного стенда).
- Целевые/планируемые модели и требования к качеству: см. `functional-requirements-and-acceptance.md` (критерии, альтернативы, условия апгрейда).
