# Пользовательский интерфейс AI GOST — описание экранов

**Назначение документа**: описать целевые экраны и UX системы AI GOST для согласования с заказчиком. Документ отражает требования из SRS/functional-requirements и прототипа «Обработка документов».

## 1. Роли, аутентификация и проектный контекст
- **Экран входа**: логин, пароль/токен, выбор роли (если доступно). Ошибки авторизации и блокировки отображаются явно.
- **Контекст проекта**: обязательные `projectId/rdCipher` при работе; баннер активного проекта, быстрый выбор последнего, предупреждение при отсутствии.
- **ACL**: доступность экранов/действий зависит от роли (Учитель, Пользователь, Администратор); при нарушении ACL — отказ с причиной и запись в журнал.

## 1.1. Формирование дерева системы на основе штатного расписания
- **Назначение**: формирование организационной структуры системы (дерева подразделений) на основании штатного расписания организации.
- **Доступ**: только Администратор (по ACL).
- **Импорт штатного расписания**:
  - Импорт из файла (Excel/CSV) с организационной структурой: названия подразделений (департаменты, отделы, группы), иерархия подразделений (родительские/дочерние связи), должности сотрудников, ФИО сотрудников, другие данные (если необходимы).
  - Автоматическое построение дерева подразделений на основе импортированных данных.
  - Валидация импортированных данных (проверка структуры, обязательных полей, корректности иерархии).
  - Предпросмотр структуры перед применением, возможность корректировки.
- **Дерево системы**:
  - Иерархическая структура: организация → департаменты → отделы → группы (визуальное дерево с возможностью разворачивания/сворачивания).
  - Привязка пользователей к подразделениям и должностям (назначение пользователей в структуру организации).
  - Привязка проектов к подразделениям (опционально, для фильтрации и отчетности по подразделениям).
  - Отображение количества пользователей и проектов в каждом подразделении.
- **Использование структуры**:
  - Фильтрация по подразделениям: проекты, документы, отчеты, пользователи (выбор подразделения для фильтрации данных).
  - Настройка прав доступа по подразделениям: групповые права для подразделений, наследование прав в иерархии подразделений.
  - Отчетность по подразделениям: формирование отчетов по подразделениям (ПТО, сметный отдел и другие), использование подразделений в шаблонах отчетов.
  - Назначение задач по подразделениям: передача задач между подразделениями, уведомления подразделений о задачах.
- **Управление структурой**:
  - Редактирование дерева подразделений: добавление/удаление подразделений, перемещение подразделений в иерархии, переименование подразделений.
  - Синхронизация с актуальным штатным расписанием: повторный импорт для обновления структуры, сравнение изменений, применение обновлений.
  - Версионирование структуры: сохранение версий организационной структуры, откат к предыдущей версии, история изменений.
  - Экспорт структуры: экспорт текущей структуры в Excel/CSV для проверки и редактирования.

## 2. Импорт и обработка документов
- **Загрузка**: drag&drop файлов и кнопка «Импорт папки» (рекурсивно). Поддержка PDF/JPG/PNG/ARP/GSFX/XML/XLS/XLSX/DWG/DXF/DOCX. Список файлов с типом, размером, страницами, статусом ACL.
- **Чек-лист задач**: штамп, таблицы, смета, нормативка, отчёты; можно включать/выключать перед запуском. Поле «Инструкция системе» (промт) и выбор ГОСТ/СП.
- **Запуск обработки**: кнопка «Обработать», выбор режима ответа (list/detail/aggregate), фильтры (дата/тип/стадия/материалы), лимит выдачи. Параллельная очередь, ошибки не останавливают остальные файлы.
- **Прогресс и SLA**: шаги пайплайна (детект PDF ≤3 с/док, OCR ≤30 с/стр., общий ответ ≤30 с), таймеры по шагам, статусы (выполняется/готово/ошибка).
- **Результаты**: по каждому файлу — метаданные, ссылки на артефакты (titleBlock.json, tables.json/CSV, estimate.json/CSV, validationReport.json, итоговые Excel/CSV/JSON/PDF, trace), просмотр/скачивание, разворот извлечённого текста, ошибки/предупреждения.
- **Экспорт**: кнопка «Экспорт результатов» (архив артефактов/отчётов), сохранение настроек запуска как пресета.

## 3. Пресеты и обучение (роль Учитель)
- **Промт задачи**: форма для описания действий системы, шаблоны промтов, автоподстановка projectId/rdCipher.
- **Входные и эталонные файлы**: загрузка примеров входов и целевых выходов; таблица связок вход → эталон. Пометка «Эталон» для обучения.
- **Сохранение наборов**: кнопка «Сохранить как обучающий набор» (промт, входы, эталоны, ГОСТ/СП, настройки). Повторное применение набора в других проектах.
- **Подтверждение качества**: подсветка полей с низким confidence/CER-WER, отметки «Принять/Исправить», комментарии; влияние на правила проекта.

## 4. Версии артефактов и знаний
- **Реестр версий**: таблица с метками Reference/Draft, автором, временем, changeSummary, ссылками на артефакты. Действия: сравнить, откатить (создать новую версию), опубликовать Reference.
- **Доступность**: Учитель управляет версиями; Пользователь читает Reference; Админ задаёт политику ретенции/очистки.

## 5. Сметы и round-trip
- **Импорт**: ARP/GSFX/XML/XLSX в модель Estimate (разделы → позиции → ресурсы).
- **Просмотр/правки**: дерево сметы, статусы формул (OK/Warning/Broken), редактирование коэффициентов/цен, сверка итогов.
- **Экспорт**: round-trip обратно в исходный формат, отчёт об отклонениях и статусах формул.

## 6. Реестр шаблонов Excel и валидация
- **Список шаблонов**: название, версия, владелец, статус (активен/черновик), область применения.
- **Операции**: загрузка нового, активация, откат версии, комментарии к изменениям.
- **Проверка отчёта**: форма «Проверить по шаблону», просмотр validationReport (ошибка/предупреждение, лист/ячейка/формула), экспорт отчёта.

## 6.1. Конструктор отчетных форм (принцип «Чистого листа»)
- **Назначение**: создание произвольных отчетных форм для экспорта информации из системы без жестких программных ограничений, реализация принципа «Чистого листа».
- **Доступ**: Администратор и Учитель (по ACL проектов) могут создавать и редактировать формы.
- **Визуальный редактор**: drag-and-drop интерфейс с элементами:
  - Таблицы (произвольная структура, объединение ячеек, иерархия заголовков).
  - Текстовые блоки (заголовки, подписи, описания).
  - Графики и диаграммы (на основе данных из системы).
  - Формулы и вычисления (ссылки на данные, перекрёстные ссылки между листами).
  - Элементы форматирования (стили, шрифты, цвета, границы).
- **Источники данных**: выбор полей из артефактов системы:
  - titleBlock (реквизиты штампа: title, cipher, sheetNumber, documentName, sheetFormat, designStage, organization, documentDate, revisionNumber).
  - tables (табличные данные: материалы, оборудование, работы с количественными и стоимостными показателями).
  - estimate (сметные данные: разделы, позиции, ресурсы, qty, unitPrice, amount).
  - Нормативы (ссылки на ГОСТ/СП, пункты, редакции).
  - Метаданные проектов (projectId, projectName, rdCipher, designStage, projectType, projectTags).
  - Фильтры по проектам/датам/типам документов для динамической подстановки данных.
- **Гибкость компоновки**: произвольное размещение элементов на листе, настройка размеров, выравнивания, отступов; поддержка многолистовых книг с перекрёстными ссылками.
- **Формулы и вычисления**: поддержка формул Excel-подобного синтаксиса, ссылки на данные из других листов, агрегатные функции (суммы, средние, подсчеты).
- **Сохранение и версионирование**: сохранение созданных форм как шаблонов с версионированием, метаданными (название, описание, область применения, автор, дата создания).
- **Использование как шаблонов**: созданные формы можно применять к однотипным проектам (по projectType, projectTags, designStage) с автоматической подстановкой данных из соответствующих проектов.
- **Экспорт**: генерация отчётов по созданной форме в форматах:
  - Табличные данные: XLSX, CSV, XML.
  - Текстовые данные: RTF, PDF.
  - Графические данные: DWG, DXF (для чертежей и схем).
  - Сметы: ARP, GSFX, XML, XLSX (для сметных документов).
  - Скан-образы: PDF (для документов с изображениями).
  - Универсальные: JSON (для интеграций).
- **Ограничения**: минимальные — только технические лимиты (размер файла до согласованного лимита, число листов до согласованного лимита, сложность формул), без ограничений на структуру/формат отчёта.
- **Валидация**: проверка корректности формул, ссылок на данные, доступности источников данных перед экспортом; предупреждения о потенциальных проблемах.

## 7. Нормативка (ГОСТ/СП)
- **Загрузка/версии**: вкладка «Нормативка», загрузка DOCX/PDF, метаданные (номер, название, редакция, дата), выбор активной версии.
- **Правила**: таблица правил с уровнями Critical/Warning/Info, фильтры, покрытие приоритетных норм (%), журнал изменений.
- **Проверка**: выбор проекта/отчёта/сметы, кнопка «Проверить по ГОСТ», отчёт о несоответствиях (ссылки на норматив/пункт/страницу/редакцию), экспорт validationReport.json и PDF выжимок.
- **Пороги и ACL**: настройки порогов блокировки, ретенция версий; доступ к загрузке/активации у Учителя/Админа.

## 7.1. Конструктор чат-ботов (для Администратора)
- **Назначение**: создание специализированных чат-ботов для конкретных задач без привлечения ИТ-инженеров, реализация принципа «дописания простейших чат ботов силами Администратора».
- **Доступ**: только Администратор (по ACL).
- **Режимы создания**:
  - Создание нового бота с нуля (выбор шаблона или пустой шаблон).
  - Настройка существующего бота (изменение промптов, добавление функций, обновление правил).
- **Интерфейс**: текстовый редактор с подсказками, автодополнением, примерами промптов и правил, валидацией синтаксиса.
- **Шаблоны чат-ботов**:
  - Бот для работы со сметами (поиск, анализ, валидация сметных данных, работа с ARP/GSFX/XML).
  - Бот для поиска по ГОСТам (поиск нормативов, проверка соответствия, формирование выжимок).
  - Бот для работы с проектами (поиск аналогов, извлечение данных по проектам, формирование комплектов РД).
  - Бот для обработки документов (запуск задач OCR, извлечение данных, валидация документов).
  - Бот для генерации отчетов (создание отчетов по запросам, работа с шаблонами подразделений).
  - Пустой шаблон (создание кастомного бота с нуля).
- **Настройка бота**:
  - Название и описание бота (для идентификации и поиска).
  - Промпты и инструкции для ИИ (текстовый редактор с подсказками, примеры промптов, шаблоны инструкций).
  - Правила обработки запросов (шаблоны запросов, примеры вопросов, паттерны распознавания намерений).
  - Источники данных: выбор артефактов/проектов, доступных боту (titleBlock, tables, estimate, нормативы, метаданные проектов), фильтры по проектам/датам/типам документов.
  - Функции бота:
    - Поиск информации в базе знаний (по артефактам, проектам, документам с trace на источники).
    - Ответы на вопросы по проектам/документам (контекстные ответы с указанием источников).
    - Запуск задач обработки документов (OCR, извлечение данных, валидация по шаблонам).
    - Генерация отчетов (по запросам пользователей, в различных форматах: Excel/PDF/CSV/JSON).
    - Интеграция с другими функциями системы (связь с конструктором форм, нормативной базой, проектами).
  - Взаимодействие сотрудников: функции для помощи сотрудникам во взаимодействии через систему:
    - Передача задач между сотрудниками (назначение задач, уведомления о передаче).
    - Уведомления (о статусе задач, изменениях в проектах, новых документах).
    - Координация работы (согласование действий, синхронизация работы над проектами).
  - Формат ответов: текст, таблица, отчет (Excel/PDF/CSV), структурированные данные (JSON).
- **Тестирование**: предпросмотр и тестирование бота перед публикацией (примеры запросов, проверка корректности ответов, валидация функций, проверка взаимодействия с источниками данных).
- **Публикация и управление**:
  - Активация/деактивация бота (включение/выключение без удаления).
  - Настройка доступа: роли (Учитель, Пользователь), проекты (по ACL), подразделения.
  - Версионирование: сохранение версий ботов, откат к предыдущей версии, сравнение версий.
  - Мониторинг: статистика использования (количество запросов, популярные вопросы), логи запросов/ответов, ошибки и предупреждения.
- **Ограничения**: минимальные технические лимиты (количество ботов, сложность промптов, число функций на бота) согласовываются отдельно.

## 8. Поиск аналогов и готовые отчёты
- **Фильтры**: тип объекта, стадия, материалы, теги, даты, лимит выдачи.
- **Выдача**: список аналогов с признаками сходства и trace на артефакты.
- **Отчёты**: кнопки запуска готовых отчётов (спецификация, бюджет, сравнение проектов/аналогов), экспорт в Excel/CSV/JSON/PDF.

## 9. API и интеграции
- **Токены**: реестр токенов (проект, роль, срок действия, статус), создание/ротация/отзыв.
- **Webhooks**: настройка URL, ретраи, SLA; просмотр журнала доставок/ошибок; лимиты запросов.
- **Включение/отключение** внешних интеграций с фиксацией в журнале.

## 9.1. Интеграции «Розетка» (plug-and-play с внешними БД)
- **Назначение**: взаимодействие с иными информационными базами данных организации для экспорта информации по принципу «Розетки» (plug-and-play подключение).
- **Доступ**: только Администратор (по ACL).
- **Библиотека адаптеров**: готовые адаптеры для типовых систем:
  - ERP-системы (1С, SAP и другие популярные системы).
  - ECM/ДОУ (системы документооборота).
  - CAD-системы (AutoCAD, другие системы проектирования).
  - Бухгалтерские системы.
  - Другие корпоративные системы (по запросу).
- **Стандартизированный интерфейс**: единый интерфейс подключения (как физическая розетка) для всех типов систем, возможность добавления кастомных адаптеров.
- **Процесс подключения (plug-and-play)**:
  - Выбор типа системы из списка доступных адаптеров или создание кастомного адаптера.
  - Ввод параметров подключения (хост, порт, база данных, учетные данные, дополнительные настройки).
  - Автоматическая проверка соединения и настройка подключения.
  - Тестирование экспорта/импорта данных (проверка корректности обмена).
  - Сохранение подключения с именем и описанием.
- **Экспорт информации**:
  - Выбор данных для экспорта: артефакты (titleBlock, tables, estimate), проекты (метаданные, документы), отчеты (Excel/PDF/CSV/JSON), нормативы (ГОСТ/СП).
  - Настройка формата экспорта под целевую систему (маппинг полей, преобразование форматов).
  - Планирование экспорта: разовый экспорт, по расписанию (ежедневно/еженедельно/по событиям), по событиям (при изменении данных, завершении обработки).
  - Мониторинг статуса экспорта: история экспортов, статусы (успешно/ошибка/в процессе), логи операций.
- **Импорт информации** (двусторонний обмен):
  - Настройка импорта данных из внешних систем (проекты, документы, метаданные).
  - Маппинг полей при импорте, преобразование форматов.
  - Планирование импорта: разовый, по расписанию, по событиям.
  - Валидация импортированных данных перед сохранением в систему.
- **Управление подключениями**:
  - Список активных подключений с статусами (активно/неактивно/ошибка).
  - Включение/выключение подключений без удаления конфигурации.
  - Редактирование параметров подключения, тестирование соединения.
  - Логи экспорта/импорта и ошибок, статистика операций.
  - Версионирование адаптеров: обновление адаптеров, откат к предыдущей версии.
- **Безопасность**: шифрование учетных данных, безопасное хранение паролей/токенов, аудит всех операций экспорта/импорта, ACL для доступа к данным при экспорте.

## 9.2. Управляемое взаимодействие с сетью Ethernet
- **Назначение**: управляемое/ограниченное взаимодействие с сетью Ethernet для экспорта информации при сохранении основного режима air-gapped.
- **Доступ**: только Администратор (по ACL).
- **Управление сетевым доступом**:
  - Переключатель включения/выключения сетевого взаимодействия (главный переключатель в настройках).
  - Режимы работы:
    - Полностью offline (air-gapped) — все сетевые соединения заблокированы.
    - Управляемый экспорт — разрешен только исходящий трафик для экспорта данных, входящие соединения заблокированы.
    - Полный доступ — для настройки и тестирования (временный режим).
  - Индикация текущего режима работы (визуальный индикатор статуса).
- **Ограничения и белые списки**:
  - Белый список разрешенных адресов/доменов для экспорта (IP-адреса, доменные имена, подсети).
  - Ограничение по протоколам: HTTP/HTTPS, FTP/SFTP, другие протоколы по необходимости (выбор разрешенных протоколов).
  - Ограничение по портам: только необходимые порты для экспорта (настройка разрешенных портов).
  - Временные окна: экспорт только в определенные часы/дни (настройка расписания работы сетевого экспорта).
  - Лимиты на объем данных: максимальный размер файла/пакета за операцию экспорта.
- **Экспорт через сеть**:
  - Выбор данных для экспорта: отчеты (Excel/PDF/CSV/JSON), проекты (артефакты, метаданные), результаты обработки документов, данные для интеграций через «Розетку».
  - Настройка адреса назначения и параметров подключения (URL, порт, учетные данные, параметры шифрования).
  - Планирование экспорта: разовый экспорт, по расписанию (ежедневно/еженедельно/по событиям), по событиям (при завершении обработки, создании отчета).
  - Мониторинг статуса экспорта: история экспортов, статусы (успешно/ошибка/в процессе), логи операций, статистика использования сети.
- **Безопасность**:
  - Шифрование соединений: обязательное использование TLS/SSL для всех сетевых соединений.
  - Аутентификация при экспорте: токены, сертификаты, учетные данные (безопасное хранение).
  - Аудит всех сетевых операций: логирование всех попыток экспорта, успешных операций, ошибок, попыток несанкционированного доступа.
  - Защита от утечек: проверка данных перед экспортом на наличие конфиденциальной информации, возможность блокировки экспорта определенных типов данных.
  - Мониторинг сетевой активности: отслеживание всех сетевых соединений, предупреждения о подозрительной активности.
- **Интеграция с «Розеткой»**: использование управляемого сетевого взаимодействия для подключений через адаптеры «Розетка» к внешним БД (ERP, ECM/ДОУ, CAD, бухгалтерские системы).

## 10. Логи и аудит
- **Журналы**: операции пользователей (кто/что/когда/проект/статус), шаги обработки, ошибки.
- **Фильтры**: по пользователю, проекту, операции, шагу пайплайна; экспорт логов; отметка попыток изменения/удаления.
- **Доступ**: Администратор — полный; Учитель — по своим проектам; Пользователь — по собственным запросам.

## 11. Мониторинг и SLA
- **Дашборд**: времена по шагам (OCR/штамп/таблицы/сметы/нормативка/отчёты), состояние очередей, предупреждения о превышении лимитов размеров/страниц/слоёв.
- **Ресурсы**: состояние бэкапов/ретенции, использование диска/CPU/GPU (если доступно локально).
- **Статусы**: success/warning/error, уведомления об инцидентах SLA.

## 12. Настройки окружения
- **Параметры**: пути хранилищ, лимиты размеров файлов/страниц/листов/слоёв DXF, параметры моделей (OCR/LLM), офлайн-режим.
- **Бэкапы/ретенция**: политика очистки версий/логов, расписание резервного копирования.
- **Доступ**: только Администратор; проверки валидации при сохранении.

## 12.1. Удаленные мобильные рабочие места
- **Назначение**: настройка удаленного мобильного рабочего места для оперативного получения информации из системы.
- **Доступ**: настройка только Администратором; использование — Учитель и Пользователь согласно ACL.
- **Адаптивный веб-интерфейс**:
  - Адаптивная версия веб-интерфейса для мобильных устройств (планшеты, смартфоны).
  - Оптимизация под сенсорное управление (крупные кнопки, свайпы, жесты).
  - Упрощенный интерфейс для мобильных устройств (приоритет ключевых функций).
  - Адаптивная верстка под различные размеры экранов (responsive design).
- **VPN-подключение** (опционально):
  - Настройка VPN для доступа извне локальной сети организации.
  - Безопасное подключение к системе через VPN (шифрование, аутентификация).
  - Управление VPN-доступами администратором (создание/отзыв VPN-подключений).
  - Индикация статуса VPN-подключения.
- **Функции мобильного доступа**:
  - Текстовые запросы и получение ответов (основная функция для оперативного получения информации).
  - Просмотр отчетов (Excel/PDF/CSV) с возможностью скачивания.
  - Просмотр статуса обработки документов (прогресс, результаты, ошибки).
  - Уведомления о задачах/событиях (push-уведомления или встроенные уведомления в интерфейсе).
  - Просмотр проектов и метаданных (список проектов, информация о проектах, артефакты).
  - Ограниченный набор функций: без загрузки документов, без обучения системы, без создания чат-ботов и форм (только просмотр и запросы).
- **Настройка администратором**:
  - Включение/выключение мобильного доступа (главный переключатель).
  - Настройка прав доступа для мобильных устройств (какие функции доступны, какие проекты видны).
  - Управление VPN-подключениями (если используется): создание VPN-профилей, назначение пользователям, отзыв доступа.
  - Настройка уведомлений для мобильных устройств (типы уведомлений, частота, каналы доставки).
  - Мониторинг мобильных подключений (активные сессии, история подключений, статистика использования).
- **Безопасность**:
  - Двухфакторная аутентификация для мобильного доступа (опционально, настраивается администратором).
  - Шифрование соединений (обязательное TLS/SSL для всех мобильных подключений).
  - Ограничение доступа по ACL (мобильные пользователи видят только свои проекты согласно ACL).
  - Аудит всех операций с мобильных устройств (логирование всех действий, попыток доступа, ошибок).
  - Автоматическое отключение неактивных сессий (настраиваемый таймаут).
  - Блокировка доступа при подозрительной активности.

## 13. Общие UX-паттерны
- Состояния: initial/loading/success/error для всех форм; явные сообщения об ошибках и предупреждениях.
- Trace и источники: во всех отчётах и ответах отображаются ссылки на документ/страницу/фрагмент.
- Экспорт: единый формат скачивания (архив с артефактами) и прямые ссылки на ключевые файлы.
- Журналирование: все критичные действия (загрузка, активация, откат, выдача привилегий) пишутся в аудит.

