# Функциональные требования, сценарии и метрики приёмки AI GOST

**Версия**: 0.1 (черновик для заказчика)  
**Дата**: 2025-XX-XX  
**Назначение**: Описание функций проекта AI GOST, пользовательских сценариев и метрик приёмки.

---

## 1. Словарь терминов (кратко)
- **Учитель системы**: загружает проверенные документы, запускает обработку/обучение, подтверждает результаты.
- **Пользователь системы**: задаёт текстовые запросы, получает ответы/отчёты.
- **Администратор**: управляет правами, конфигурацией, логами, обновлениями.
- **Проектный контекст**: обязательные projectId/rdCipher для данных и операций; ACL ограничивает доступ.
- **Артефакт**: файл результата или проверки (titleBlock.json, tables.json, estimate.json/CSV, validationReport.json, routeDecision.json, итоговые Excel/CSV/JSON, логи).
- **ACL**: правила доступа по ролям и проектам.
- **SLA**: целевые сроки выполнения операции (время ответа, генерации отчёта и т.п.).
- **OCR**: распознавание текста в изображениях/сканах PDF.
- **CER/WER**: метрики точности распознавания по символам/словам.
- **NLU/LLM**: понимание естественного языка локальными моделями.
- **Estimate**: унифицированная модель сметы (разделы → позиции → ресурсы) с полями qty/unitPrice/amount.
- **ГОСТ/СП**: локальная нормативная база для проверки требований и формирования отчётов.
- **Round-trip**: импорт исходного формата (ARP/GSFX/XML/XLSX/DXF/PDF) → нормализованная модель → экспорт обратно без потерь структуры/формул.

## 2. Запросы и ответы
Описание: система принимает текстовые запросы на русском, учитывает проектный контекст и формирует структурированные ответы (Excel/JSON/CSV/ARP/GSFX/XML/XLSX/DXF/PDF) с указанием источников.
- Требования:
  - Принимает запросы с projectId и фильтрами; поддерживает list/detail/aggregate.
  - Формирует ответы с items/aggregates и trace на исходные документы.
  - Время ответа ≤ 30 секунд.
  - Ограничение длины запроса и максимального числа результатов; поддержка фильтров по дате/типу документа/проекту.
  - Ответ содержит явное указание источников (документ/страница/фрагмент); ошибки и предупреждения возвращаются явно.
- Комментарии:
  - Нужен контрольный набор запросов и целевые шаблоны ответов для проверки структуры.
  - При отсутствии projectId или нарушении ACL — отказ с понятным сообщением.
  - Согласовать лимиты на размер запроса/выдачи и формат предупреждений/ошибок.

## 3. OCR и штампы (PDF)
Описание: штамп является частью графического чертежа с основными реквизитами документа; распознаёт текст и штампы в PDF сканах/изображениях, выдаёт координаты и confidence, штамп — только из PDF. Форматы входных документов для распознавания: PDF, XLSX, DWG/DXF, RTF (для штампа — PDF).
- Требования:
  - OCR предобработка (deskew/denoise/binarize); CER/WER печатный текст ≤ 5–10%.
  - Извлечение штампа (title/cipher/sheetNumber/documentName/sheetFormat/designStage/organization/documentDate/revisionNumber) с координатами/confidence.
  - Время OCR ≤ 30 сек/страница; детект типа PDF (mc/scan/mixed) ≤ 3 сек/док.
  - Поддерживаемые DPI/качество входных сканов; обязательное сохранение времени по шагам.
  - Пороги confidence для авто-принятия/ручной проверки полей штампа; поддержка многолистовых PDF.
- Комментарии:
  - Требуются контрольные сканы/изображения для замера точности и времени.
  - DWG не берём для штампа; при необходимости конвертируем в DXF только для таблиц/текста.
  - Согласовать минимальный DPI/качество входа и пороги confidence для авто-принятия.

## 4. Таблицы (PDF/DXF)
Описание: находит табличные области, восстанавливает структуру (merged, иерархия), извлекает ценовые поля.
- Требования:
  - Полнота извлечения таблиц ≥ 95% по контрольным примерам.
  - Заполненность ценовых полей (price/amount/currency/source/date) ≥ 90%.
  - Структура таблиц (merged/иерархия/итоговые строки) сохраняется; артефакт tables.json/CSV.
  - Проверка типов данных (числа/даты/валюта); валидность итогов и формул.
  - Лимиты: число таблиц/страниц/слоёв DXF, размер файла; время извлечения в пределах SLA.
- Комментарии:
  - Нужны контрольные PDF/DXF с эталонной разметкой для валидации полноты/структуры.
  - Большие DXF со множеством слоёв могут замедлять обработку; требуется проверка на реальных примерах.
  - Согласовать лимиты по размерам/количеству таблиц и требования к валидации итогов.

## 5. Обучение и база знаний
Описание: система учится на проверенных документах, хранит знания по проектам и поддерживает экспорт/импорт контекстов.
- Требования:
  - Учитель загружает только валидированные документы; результаты обучения привязаны к projectId.
  - Контекст обучения хранится по проектам; поддержан экспорт/импорт пакетов знаний.
  - Версионирование знаний и возможность rollback; фиксация источников и правок.
  - Лимиты на размер/число артефактов в контексте; контроль качества перед публикацией (дубли/ошибки/полнота).
  - Поддержка подписки проектов на обновления контекста; журнал миграций/обновлений.
- Комментарии:
  - Нужны образцы обучающих наборов (штампы, таблицы, сметы) и правила отбора «проверенных» документов.
  - Требуется согласовать политику хранения версий и права на экспорт/импорт.
  - Согласовать лимиты на размер пакета знаний и критерии допуска в базу знаний.

## 6. Поиск аналогов по проектам
Описание: поиск похожих проектов по типу/стадии/материалам с выдачей артефактов и метаданных.
- Требования:
  - Индексирует проекты по признакам (тип объекта, стадия, материалы, теги).
  - Выдаёт аналоги с признаками сходства и trace на исходные артефакты.
  - Время ответа ≤ 30 секунд; учитывает ACL и проектный контекст.
  - Поддержка фильтров (по стадиям/материалам/дате); минимальный набор признаков сходства согласован.
  - Лимиты на число аналогов в выдаче; trace обязателен.
- Комментарии:
  - Нужен согласованный перечень признаков сходства и контрольный набор проектов.
  - Требуется формат отчёта по аналогам (поля, сортировка, trace).
  - Согласовать метрики качества поиска аналогов и контрольные тесты.

## 7. Реестр и валидация шаблонов Excel
Описание: управление шаблонами отчётов (версии, владельцы, области применения) и их валидация (структура, формулы, печать).
- Требования:
  - Хранить шаблоны с версиями и статусами; вести аудит изменений.
  - Проверять отчёты на соответствие активному шаблону (листы, названия, стили, печать, формулы).
  - Генерировать отчёт валидации (validationReport) с ошибками/предупреждениями.
  - Поддержка многолистовых книг и перекрёстных ссылок; проверка областей печати и защиты.
  - Лимиты: размер файла, число листов; SLA проверки шаблона.
- Комментарии:
  - Нужны эталоны шаблонов ПТО/сметы и правила критичности.
  - Согласовать срок жизни версий и процесс обновления/отката.
  - Требуется определить SLA проверки и лимиты по размерам/листам.

## 8. Сметы (ARP/GSFX/XML/XLSX)
Описание: конвертирует сметы в единую модель Estimate (разделы → позиции → ресурсы), валидирует поля и поддерживает round-trip.
- Требования:
  - Полнота ключевых полей ≥ 95%: разделы (код/наименование), позиции (наименование/единица/количество/цена/сумма), ресурсы.
  - Валидация qty > 0, unitPrice ≥ 0, amount = qty × unitPrice; сохранение projectId/rdCipher.
  - Корректность round-trip (импорт/экспорт) для ARP/GSFX/XML/XLSX; артефакт estimate.json/CSV.
  - Обработка формул: статусы OK/Warning/Broken; сохранение ссылок и восстановление формул при экспорте.
  - Лимиты: размер файлов/число строк/листов; время обработки в пределах SLA; поддерживаемые версии ARP/GSFX.
- Комментарии:
  - Требуются контрольные файлы смет и подтверждение версий ARP/GSFX.
  - Время обработки больших смет и ограничения по размеру файлов нужно согласовать.
  - Согласовать политику обработки Broken формул и требования к округлениям/налогам.

## 9. Нормативка (ГОСТ/СП)
Описание: загружает локальные нормы, формирует базу знаний и проверяет данные/отчёты на соответствие.
- Требования:
  - Покрытие приоритетных норм ≥ 90% (список уточняется с заказчиком).
  - Отчёты о несоответствиях содержат точные ссылки (норматив/пункт/страница/редакция/дата).
  - Время проверки нормативных требований — в рамках общего SLA ответов (≤ 30 сек для отчёта).
  - Версионирование нормативов и правил; хранение редакций и changelog.
  - Экспорт выжимок в PDF с указанием источника/редакции; хранение правил с условиями/диапазонами.
- Комментарии:
  - Нужен список приоритетных ГОСТ/СП и частота обновлений.
  - Требуется согласовать формат хранения базы норм и отчётов.
  - Согласовать ретенцию версий нормативов и формат отчётов о несоответствиях.

## 10. Отчёты и экспорт
Описание: генерирует Excel/JSON/CSV отчёты с trace на источники и валидацией структуры/форматирования.
- Требования:
  - Время генерации/экспорта отчёта ≤ 30 секунд.
  - Валидация структуры/форматирования отчётов проходит без критических ошибок.
  - В отчётах есть trace на исходные артефакты и источники цен/нормативов.
  - Поддержка шаблонов подразделений (ПТО/сметы), печатных областей, автозаполнения шапок/подвалов.
  - Лимиты: размер файла, число листов; корректность перекрёстных ссылок и формул.
- Комментарии:
  - Нужны эталоны шаблонов Excel (ПТО/сметы) для проверки форматирования и печати.
  - Требуется подтвердить лимиты по размеру файлов/числу листов.
  - Согласовать формат trace и требования к печати (ориентация, поля, колонтитулы).

## 10.1. Принцип «Чистого листа» и конструктор отчетных форм
Описание: система предоставляет возможность создания произвольных отчетных форм для экспорта информации с минимальными программными ограничениями, реализуя принцип «Чистого листа» из технического задания.
- Требования:
  - Визуальный конструктор форм с drag-and-drop интерфейсом: таблицы (произвольная структура, объединение ячеек, иерархия), текстовые блоки, графики/диаграммы, формулы и вычисления, элементы форматирования.
  - Доступ к любым полям из артефактов системы: titleBlock (реквизиты штампа), tables (табличные данные), estimate (сметные данные), нормативы (ГОСТ/СП), метаданные проектов (projectId, projectName, rdCipher, designStage, projectType, projectTags).
  - Фильтры по проектам/датам/типам документов для динамической подстановки данных при генерации отчёта.
  - Произвольная компоновка элементов на листе: настройка размеров, выравнивания, отступов; поддержка многолистовых книг с перекрёстными ссылками между листами.
  - Поддержка формул и вычислений: Excel-подобный синтаксис, ссылки на данные из других листов, агрегатные функции (суммы, средние, подсчеты).
  - Экспорт в форматы: XLSX, CSV, XML (табличные); RTF, PDF (текстовые); DWG, DXF (графические); ARP, GSFX, XML, XLSX (сметы); PDF (сканы); JSON (интеграции).
  - Сохранение форм как шаблонов с версионированием: метаданные (название, описание, область применения, автор, дата создания), версии шаблонов с возможностью отката.
  - Использование форм как шаблонов для однотипных проектов: автоматическое применение к проектам с совпадающими projectType/projectTags/designStage с подстановкой данных из соответствующих проектов.
  - Минимальные ограничения: только технические лимиты (размер файла до согласованного лимита, число листов до согласованного лимита, сложность формул), без ограничений на структуру/формат отчёта.
  - Валидация перед экспортом: проверка корректности формул, ссылок на данные, доступности источников данных; предупреждения о потенциальных проблемах.
  - Доступ: Администратор и Учитель (по ACL проектов) могут создавать и редактировать формы; Пользователь может использовать сохранённые формы для генерации отчётов.
- Комментарии:
  - Конструктор должен быть интуитивно понятным для Администратора и Учителя без привлечения высококвалифицированных ИТ-инженеров.
  - Нужны примеры созданных форм для демонстрации гибкости и возможностей конструктора.
  - Согласовать технические лимиты (размер файла, число листов, сложность формул, максимальное число элементов на листе).
  - Определить критерии «однотипности» проектов для автоматического применения шаблонов (projectType, projectTags, designStage).
  - Согласовать формат хранения шаблонов форм и процедуры миграции при обновлении системы.

## 10.2. Создание чат-ботов администратором (принцип «без ИТ-инженеров»)
Описание: система предоставляет возможность создания специализированных чат-ботов для конкретных задач силами Администратора без привлечения высококвалифицированных ИТ-инженеров, реализуя принцип «дописания простейших чат ботов на базе имеющегося интерфейса».
- Требования:
  - Визуальный/текстовый конструктор чат-ботов: текстовый редактор с подсказками, автодополнением, примерами промптов и правил, валидацией синтаксиса.
  - Режимы работы: создание нового бота с нуля (выбор шаблона или пустой шаблон), настройка существующего бота (изменение промптов, добавление функций, обновление правил).
  - Шаблоны чат-ботов: предустановленные шаблоны для типовых задач (сметы, ГОСТы, проекты, обработка документов, генерация отчетов), возможность создания кастомных шаблонов на основе пустого шаблона.
  - Настройка бота: название/описание, промпты и инструкции для ИИ (с примерами и шаблонами), правила обработки запросов (шаблоны запросов, примеры вопросов, паттерны распознавания намерений), выбор источников данных (артефакты, проекты, фильтры), настройка функций бота.
  - Функции чат-ботов:
    - Поиск информации в базе знаний системы (по артефактам, проектам, документам с trace на источники).
    - Ответы на вопросы по проектам/документам (контекстные ответы с указанием источников, поддержка многошаговых диалогов).
    - Запуск задач обработки документов (OCR, извлечение данных, валидация по шаблонам, нормативные проверки).
    - Генерация отчетов (по запросам пользователей, в различных форматах: Excel/PDF/CSV/JSON, использование шаблонов подразделений).
    - Интеграция с другими функциями системы (связь с конструктором форм, нормативной базой, проектами, поиском аналогов).
  - Взаимодействие сотрудников: функции для помощи сотрудникам во взаимодействии через систему:
    - Передача задач между сотрудниками (назначение задач, уведомления о передаче, отслеживание статуса).
    - Уведомления (о статусе задач, изменениях в проектах, новых документах, обновлениях нормативной базы).
    - Координация работы (согласование действий, синхронизация работы над проектами, совместная работа над документами).
  - Тестирование: предпросмотр и тестирование бота перед публикацией (примеры запросов, проверка корректности ответов, валидация функций, проверка взаимодействия с источниками данных, проверка функций взаимодействия сотрудников).
  - Публикация и управление: активация/деактивация ботов (включение/выключение без удаления), настройка доступа по ролям/проектам/ACL, версионирование ботов с возможностью отката и сравнения версий, мониторинг использования (статистика, логи запросов/ответов, ошибки).
  - Доступ: только Администратор может создавать и редактировать ботов; Учитель и Пользователь используют опубликованные боты согласно настройкам доступа.
  - Ограничения: минимальные технические лимиты (количество ботов, сложность промптов, число функций на бота) согласовываются отдельно.
- Комментарии:
  - Конструктор должен быть интуитивно понятным для Администратора без технических знаний программирования.
  - Нужны примеры создания ботов для типовых задач (сметы, ГОСТы, проекты, обработка документов, генерация отчетов).
  - Согласовать лимиты на количество ботов, сложность промптов, число функций на бота, максимальную длину промптов.
  - Определить критерии «простоты» ботов (какие функции доступны без ИТ-инженеров, какие требуют технической поддержки).
  - Согласовать формат хранения ботов, процедуры миграции при обновлении системы, политику ретенции неактивных ботов.

## 11. ACL и проектный контекст
Описание: все операции выполняются в проектном контексте; доступы ограничены ролями.
- Требования:
  - 100% артефактов содержат projectId/rdCipher.
  - ACL применён для Учителя/Пользователя/Администратора; при нарушении — отказ и лог.
  - Настройка проектных прав и выдача разовых привилегий фиксируются в журнале.
  - Лимиты на срок действия привилегий; обязательное подтверждение критичных операций.
  - Раздельный доступ к логам/артефактам по ролям.
- Комментарии:
  - Нужен перечень ролей и прав для финальной конфигурации.
  - Требуется согласовать срок хранения журналов ACL.
  - Согласовать политику подтверждения (approval) для загрузок/обучения.

## 11.1. Формирование дерева системы на основе штатного расписания
Описание: система формирует организационную структуру (дерево подразделений) на основании штатного расписания организации, реализуя принцип «формирования дерева системы на основании штатного расписания организации».
- Требования:
  - Импорт штатного расписания: импорт из файла (Excel/CSV) с организационной структурой (названия подразделений: департаменты, отделы, группы; иерархия подразделений: родительские/дочерние связи; должности сотрудников; ФИО сотрудников; другие данные при необходимости), автоматическое построение дерева подразделений на основе импортированных данных, валидация импортированных данных (проверка структуры, обязательных полей, корректности иерархии), предпросмотр структуры перед применением с возможностью корректировки.
  - Дерево системы: иерархическая структура (организация → департаменты → отделы → группы) с визуальным отображением, привязка пользователей к подразделениям и должностям (назначение пользователей в структуру организации), привязка проектов к подразделениям (опционально, для фильтрации и отчетности), отображение количества пользователей и проектов в каждом подразделении.
  - Использование структуры: фильтрация по подразделениям (проекты, документы, отчеты, пользователи), настройка прав доступа по подразделениям (групповые права для подразделений, наследование прав в иерархии), отчетность по подразделениям (формирование отчетов по подразделениям: ПТО, сметный отдел и другие, использование подразделений в шаблонах отчетов), назначение задач по подразделениям (передача задач между подразделениями, уведомления подразделений о задачах).
  - Управление структурой: редактирование дерева подразделений (добавление/удаление подразделений, перемещение в иерархии, переименование), синхронизация с актуальным штатным расписанием (повторный импорт для обновления структуры, сравнение изменений, применение обновлений), версионирование структуры (сохранение версий организационной структуры, откат к предыдущей версии, история изменений), экспорт структуры (экспорт текущей структуры в Excel/CSV для проверки и редактирования).
  - Доступ: только Администратор может импортировать и управлять организационной структурой; пользователи видят структуру согласно своим правам доступа.
- Комментарии:
  - Нужен формат файла штатного расписания для импорта (структура Excel/CSV, обязательные поля, формат иерархии).
  - Согласовать правила наследования прав в иерархии подразделений (как права родительского подразделения влияют на дочерние).
  - Определить политику синхронизации структуры (частота обновлений, процедуры сравнения изменений, уведомления о изменениях).
  - Согласовать использование подразделений в шаблонах отчетов (как подразделения используются в шаблонах ПТО/сметного отдела).

## 12. Управление доступом и права администратора
Описание: Администратор управляет ролями и точечными привилегиями, все изменения аудируются.
- Требования:
  - Назначение/отзыв ролей и привилегий с фиксацией автора, причины, срока действия.
  - Approval на запуск обучения/загрузок при необходимости.
  - Журнал изменений прав хранится и доступен для аудита.
  - Настройки прав по проектам и операциям (загрузка, обучение, экспорт); блокировка при нарушении.
  - Регламент ротации токенов/доступов для внешних интеграций.
- Комментарии:
  - Согласовать процесс утверждения прав и сроки хранения журнала изменений.
  - Определить, кто имеет право выдавать точечные привилегии по проектам.
  - Согласовать уровни критичности операций, требующих approval.

## 13. Версионирование данных, контекста и артефактов
Описание: результаты обучения, артефакты и метаданные версионируются с возможностью rollback.
- Требования:
  - Версии для артефактов (штамп/таблицы/сметы), логов и контекста обучения.
  - Возможность сравнения версий и восстановления предыдущей.
  - Структура каталогов артефактов предсказуема; трассировка projectId/requestId/time.
  - Ретенция версий и автоматическая очистка по политике; архивы для нормативки и шаблонов.
  - Логирование изменений версий и результатов rollback.
- Комментарии:
  - Согласовать глубину истории и место хранения версий.
  - Определить регламент очистки/архивации старых версий.
  - Уточнить формат хранения diff/истории изменений.

## 14. API для внешних систем
Описание: двусторонний REST API для получения знаний и обратной связи.
- Требования:
  - Аутентификация токенами, границы доступа по проектам.
  - Методы получения пакетов знаний и публикации обратных комментариев/актуализаций.
  - Webhook-уведомления об обновлениях с повторной доставкой при сбое.
  - SLA для API/webhook: время ответа, ретраи, лимиты запросов.
  - Форматы payload и версии API; ротация токенов.
- Комментарии:
  - Требуется согласовать список внешних систем и форматы обмена.
  - Нужен регламент ротации токенов и SLA по вебхукам.
  - Определить политику версионирования API и совместимости.

## 14.1. Интеграции «Розетка» (plug-and-play с внешними БД)
Описание: система предоставляет возможность взаимодействия с иными информационными базами данных организации для экспорта информации по принципу «Розетки» (plug-and-play подключение без сложной настройки).
- Требования:
  - Библиотека адаптеров: готовые адаптеры для типовых систем (ERP: 1С, SAP и другие; ECM/ДОУ: системы документооборота; CAD: AutoCAD и другие системы проектирования; бухгалтерские системы; другие корпоративные системы по запросу).
  - Стандартизированный интерфейс подключения: единый интерфейс (как физическая розетка) для всех типов систем, возможность добавления кастомных адаптеров через стандартный интерфейс.
  - Процесс подключения (plug-and-play): выбор типа системы из списка адаптеров или создание кастомного адаптера, ввод параметров подключения (хост, порт, БД, учетные данные), автоматическая проверка соединения и настройка, тестирование экспорта/импорта данных, сохранение подключения.
  - Экспорт информации: выбор данных для экспорта (артефакты: titleBlock, tables, estimate; проекты: метаданные, документы; отчеты: Excel/PDF/CSV/JSON; нормативы: ГОСТ/СП), настройка формата экспорта под целевую систему (маппинг полей, преобразование форматов), планирование экспорта (разовый, по расписанию, по событиям), мониторинг статуса экспорта (история, статусы, логи).
  - Импорт информации (двусторонний обмен): настройка импорта данных из внешних систем (проекты, документы, метаданные), маппинг полей при импорте, преобразование форматов, планирование импорта (разовый, по расписанию, по событиям), валидация импортированных данных перед сохранением.
  - Управление подключениями: список активных подключений с статусами (активно/неактивно/ошибка), включение/выключение подключений без удаления конфигурации, редактирование параметров подключения, тестирование соединения, логи экспорта/импорта и ошибок, статистика операций, версионирование адаптеров (обновление, откат).
  - Безопасность: шифрование учетных данных, безопасное хранение паролей/токенов, аудит всех операций экспорта/импорта, ACL для доступа к данным при экспорте, проверка прав доступа перед экспортом/импортом.
  - Доступ: только Администратор может создавать и настраивать подключения; Учитель и Пользователь могут использовать настроенные подключения для экспорта/импорта данных согласно ACL.
- Комментарии:
  - Принцип «Розетки» означает простое подключение внешних систем без привлечения ИТ-инженеров (силами Администратора).
  - Нужен список приоритетных внешних систем для разработки адаптеров в первую очередь.
  - Согласовать форматы обмена данными для каждой целевой системы (структура данных, кодировки, протоколы).
  - Определить лимиты на количество активных подключений, частоту экспорта/импорта, объем данных за операцию.
  - Согласовать политику обработки ошибок при экспорте/импорте (повторные попытки, уведомления, логирование).
  - Определить требования к производительности экспорта/импорта (SLA для операций обмена данными).

## 14.2. Управляемое взаимодействие с сетью Ethernet
Описание: система предоставляет возможность управляемого/ограниченного взаимодействия с сетью Ethernet для экспорта информации при сохранении основного режима air-gapped.
- Требования:
  - Управление сетевым доступом: переключатель включения/выключения сетевого взаимодействия (главный переключатель), режимы работы (полностью offline/air-gapped, управляемый экспорт — только исходящий трафик, полный доступ — для настройки), индикация текущего режима работы.
  - Ограничения и белые списки: белый список разрешенных адресов/доменов для экспорта (IP-адреса, доменные имена, подсети), ограничение по протоколам (HTTP/HTTPS, FTP/SFTP, другие по необходимости), ограничение по портам (только необходимые порты для экспорта), временные окна (экспорт только в определенные часы/дни), лимиты на объем данных (максимальный размер файла/пакета за операцию).
  - Экспорт через сеть: выбор данных для экспорта (отчеты: Excel/PDF/CSV/JSON; проекты: артефакты, метаданные; результаты обработки документов; данные для интеграций), настройка адреса назначения и параметров подключения (URL, порт, учетные данные, параметры шифрования), планирование экспорта (разовый, по расписанию, по событиям), мониторинг статуса экспорта (история, статусы, логи, статистика).
  - Безопасность: шифрование соединений (обязательное TLS/SSL для всех сетевых соединений), аутентификация при экспорте (токены, сертификаты, учетные данные с безопасным хранением), аудит всех сетевых операций (логирование всех попыток экспорта, успешных операций, ошибок, попыток несанкционированного доступа), защита от утечек (проверка данных перед экспортом на наличие конфиденциальной информации, возможность блокировки экспорта определенных типов данных), мониторинг сетевой активности (отслеживание всех сетевых соединений, предупреждения о подозрительной активности).
  - Интеграция с «Розеткой»: использование управляемого сетевого взаимодействия для подключений через адаптеры «Розетка» к внешним БД (ERP, ECM/ДОУ, CAD, бухгалтерские системы).
  - Доступ: только Администратор может настраивать и управлять сетевым взаимодействием; Учитель и Пользователь могут использовать настроенные экспорты согласно ACL.
- Комментарии:
  - Управляемое взаимодействие означает возможность включения/выключения сетевого доступа по необходимости, а не постоянное подключение к сети.
  - Ограниченное взаимодействие означает только исходящий трафик для экспорта, без входящих соединений, что сохраняет безопасность air-gapped окружения.
  - Нужно согласовать список разрешенных адресов/доменов для экспорта и протоколы обмена данными.
  - Определить лимиты на объем данных за операцию экспорта и частоту экспорта.
  - Согласовать требования к шифрованию и аутентификации (типы сертификатов, алгоритмы шифрования).
  - Определить политику аудита сетевых операций (срок хранения логов, формат логов, процедуры анализа).

## 14.3. Удаленные мобильные рабочие места
Описание: система предоставляет возможность настройки удаленного мобильного рабочего места для оперативного получения информации из системы.
- Требования:
  - Адаптивный веб-интерфейс: адаптивная версия веб-интерфейса для мобильных устройств (планшеты, смартфоны), оптимизация под сенсорное управление (крупные кнопки, свайпы, жесты), упрощенный интерфейс для мобильных устройств (приоритет ключевых функций), адаптивная верстка под различные размеры экранов (responsive design).
  - VPN-подключение (опционально): настройка VPN для доступа извне локальной сети организации, безопасное подключение к системе через VPN (шифрование, аутентификация), управление VPN-доступами администратором (создание/отзыв VPN-подключений), индикация статуса VPN-подключения.
  - Функции мобильного доступа:
    - Текстовые запросы и получение ответов (основная функция для оперативного получения информации).
    - Просмотр отчетов (Excel/PDF/CSV) с возможностью скачивания.
    - Просмотр статуса обработки документов (прогресс, результаты, ошибки).
    - Уведомления о задачах/событиях (push-уведомления или встроенные уведомления в интерфейсе).
    - Просмотр проектов и метаданных (список проектов, информация о проектах, артефакты).
    - Ограниченный набор функций: без загрузки документов, без обучения системы, без создания чат-ботов и форм (только просмотр и запросы).
  - Настройка администратором: включение/выключение мобильного доступа (главный переключатель), настройка прав доступа для мобильных устройств (какие функции доступны, какие проекты видны), управление VPN-подключениями (если используется): создание VPN-профилей, назначение пользователям, отзыв доступа, настройка уведомлений для мобильных устройств (типы уведомлений, частота, каналы доставки), мониторинг мобильных подключений (активные сессии, история подключений, статистика использования).
  - Безопасность: двухфакторная аутентификация для мобильного доступа (опционально, настраивается администратором), шифрование соединений (обязательное TLS/SSL для всех мобильных подключений), ограничение доступа по ACL (мобильные пользователи видят только свои проекты согласно ACL), аудит всех операций с мобильных устройств (логирование всех действий, попыток доступа, ошибок), автоматическое отключение неактивных сессий (настраиваемый таймаут), блокировка доступа при подозрительной активности.
  - Доступ: настройка только Администратором; использование — Учитель и Пользователь согласно ACL и настройкам мобильного доступа.
- Комментарии:
  - Мобильное рабочее место предназначено для оперативного получения информации, а не для полной работы с системой.
  - Нужно согласовать список функций, доступных на мобильных устройствах (приоритет оперативного получения информации).
  - Определить требования к VPN (если используется): тип VPN, протоколы, требования к инфраструктуре.
  - Согласовать требования к уведомлениям (типы, частота, каналы доставки, настройки пользователя).
  - Определить политику безопасности для мобильного доступа (двухфакторная аутентификация, таймауты сессий, блокировка при подозрительной активности).
  - Согласовать требования к производительности мобильного интерфейса (время загрузки, отзывчивость, оптимизация для мобильных сетей).

## 15. Нормативные отчёты и хранение правил
Описание: формирует выжимки нормативов, структурированные правила и отчёты о несоответствиях.
- Требования:
  - Извлекать метаданные DOCX, формировать выжимки и экспорт в PDF с точными ссылками.
  - Хранить правила с условиями/диапазонами/ссылками на пункты; версии правил и нормативов.
  - Генерировать отчёты о несоответствиях с классификацией (Critical/Warning/Info).
  - Указывать редакцию/дату норматива в отчётах и правилах; ретенция версий.
  - Лимиты на объём базы правил/выжимок; SLA на формирование отчёта.
- Комментарии:
  - Нужен список приоритетных нормативов и формат правил/выжимок.
  - Согласовать политику обновлений нормативной базы и хранения версий.
  - Согласовать формат отчётов о несоответствиях и экспорт в PDF.

## 16. Проектные шаблоны и индекс контекста
Описание: поддержка проектных шаблонов/контекстов, подписки и перенос знаний между проектами.
- Требования:
  - Хранить проектные шаблоны/контексты и подписки на обновления.
  - Экспорт/импорт контекста между проектами с миграцией зависимостей.
  - Индексация контекста для ускоренного поиска и применения шаблонов.
  - Лимиты на размер/число шаблонов и пакетов контекста; SLA на применение шаблона.
  - Трассировка изменений шаблонов (кто/когда/что изменил), права на публикацию/обновление.
- Комментарии:
  - Требуется согласовать формат пакетов контекста и правила подписки.
  - Нужны примеры проектных шаблонов для проверки процесса миграции.
  - Согласовать критерии приёмки шаблонов и контрольные тесты применения.

## 17. Логирование и аудит
Описание: фиксирует шаги обработки, ошибки, действия пользователей; хранит артефакты в предсказуемой структуре.
- Требования:
  - Логи обработки и аудита ведутся по всем операциям (кто/что/когда/статус/детали).
  - Артефакты проверок (validationReport, routeDecision, titleBlock, tables, estimate) сохраняются и версионируются.
  - Доступ к логам ограничен ролями; попытки изменения/удаления фиксируются.
- Комментарии:
  - Согласовать срок хранения логов/артефактов и объём хранилища.
  - Нужен регламент на экспорт/очистку/резервное копирование логов и артефактов.

## 18. Пользовательские сценарии (потоки)
- Учитель системы:
  - Загружает набор PDF/сметExcel/JSON/CSV/ARP/GSFX/XML/XLSX/DXF/PDF, проверяет автодетект формата, запускает обработку, просматривает/правит штамп, таблицы, сметы, повторно запускает шаг при необходимости.
  - Запускает формирование отчётов (Excel/CSV/JSON), запускает проверку отчёта против шаблона, разбирает validationReport, вносит правки и повторяет проверку.
  - Импортирует сметы (ARP/GSFX/XML), нормализует в Estimate, правит формулы/коэффициенты, экспортирует обратно и сверяет итоги/статусы Broken/Warning.
  - Запускает нормативные проверки, просматривает отчёт о несоответствиях, принимает/отклоняет рекомендации, экспортирует выжимки в PDF.
- Пользователь системы:
  - Формулирует текстовый запрос с проектом, получает структурированный ответ с trace на источники.
  - Запускает готовые отчёты (спецификация, бюджет, сравнение проектов) по выбранному проекту/аналогам и анализирует результаты.
  - Ищет похожие проекты (тип/стадия/материалы), просматривает найденные артефакты, запускает связанные задачи/отчёты по аналогу.
- Администратор:
  - Управляет ролями/ACL, назначает точечные привилегии на загрузку/обучение/проекты, ведёт аудит изменений прав.
  - Настраивает окружение (модели, пути хранения, лимиты по размерам файлов), следит за логами/инцидентами, повторно запускает шаги при ошибках.
  - Обновляет нормативную базу, модели, шаблоны отчётов; контролирует версионирование контекстов/артефактов.

## 19. Критерии готовности демо/прототипа
- Обработан согласованный контрольный набор документов (сканы PDF, таблицы, сметы, нормативные примеры).
- Достигнуты целевые метрики (OCR, штампы, таблицы, сметы, нормативка, экспорт) на контрольном наборе.
- Отчёты в Excel/JSON/CSV формируются в пределах SLA и проходят валидацию структуры/форматирования.
- ACL/аудит включены; логи и артефакты сохраняются в ожидаемой структуре.

## 20. Открытые вопросы
- Нужен утверждённый набор контрольных данных (сканы, сметы ARP/GSFX/XML, DXF примеры) и шаблоны Excel для ПТО/смет.
- Требуется список приоритетных ГОСТ/СП и частота обновлений нормативки.
- Согласовать ограничения по размеру файлов, числу страниц/листов и системным ресурсам (CPU/GPU/RAM/диск).

## 21. Модели и целевые требования (план реализации)
- **Общие принципы**: полностью офлайн; приоритет компактных моделей для пилота с опцией апгрейда на более тяжёлые при наличии ресурсов и подтверждённого выигрыша в качестве.
- **Текущие (пилот, см. prototype-description.md)**: `deepseek-r1` для JSON/структурных ответов; `llava` для vision (PDF-страницы/изображения). Ограничения по контексту/скорости — требует батчинга и нарезки.
- **План апгрейда**:
  - LLM/structured: рассмотреть `llama-3.1-70b-instruct` или `qwen2.5-72b-instruct` для повышения качества рассуждений и длинного контекста.
  - Vision: `llama-3.2-vision` или `florence-2-large` для лучшего распознавания мелких элементов на PDF/чертежах.
  - Embeddings: подобрать офлайн-модель с достаточным размером контекста; критерии — качество на контрольных данных, производительность на целевом железе.
- **Критерии перехода**: достижение/превышение целевых метрик на контрольных наборах (OCR/штампы/таблицы/сметы/нормативка, ответы с trace), соблюдение SLA (≤30 сек на запрос, OCR ≤30 сек/страница, детект PDF ≤3 сек/док), соответствие ресурсным лимитам стенда.
- **Операционные требования**: версионирование моделей, ротация/откат, отчёт о метриках при обновлении, контроль ретенции/объёма моделей, политика деградации при нехватке ресурсов (fallback на лёгкие модели).
