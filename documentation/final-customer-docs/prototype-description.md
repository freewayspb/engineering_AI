# Описание работы прототипа BA_AI_GOST

**Версия**: 0.2 (черновик для заказчика)  
**Дата**: 2025-XX-XX  
**Назначение**: Самодостаточное описание прототипа (архитектура, пайплайны, артефакты, метрики) без ссылок на другие файлы.

---

## 1. Обзор и назначение
- **Цель**: подтвердить, что локальная система ИИ может обрабатывать инженерные документы и отвечать на текстовые запросы без доступа к интернету.
- **Объем**: обработка PDF, ARP/GSFX/XML (сметы), RTF/DOCX, XLSX/CSV, изображений (JPG/PNG/TIFF/BMP); DWG при необходимости переводится в DXF для извлечения таблиц/текста (штамп только из PDF). Проектная привязка данных и формирование Excel/JSON/CSV отчётов.
- **Роли**: Учитель системы (загрузка/валидация), Пользователь (запросы/отчёты), Администратор (доступы/конфигурация).

## 2. Термины и роли (кратко)
- **Учитель**: загружает проверенные документы, запускает обработку/обучение, подтверждает результаты.
- **Пользователь**: задаёт текстовые запросы, получает структурированные ответы/отчёты.
- **Администратор**: управляет правами, конфигурацией, логами, обновлениями.
- **Проектный контекст**: все артефакты содержат projectId/rdCipher; операции ограничены ACL.
- **Артефакты**: text.json, tables.json, titleBlock.json, estimate.json/CSV, validationReport.json, routeDecision.json, итоговые Excel/CSV/JSON, логи обработки и аудита.

## 3. Архитектура и стеки
- **Компоненты**: клиент (web/desktop), backend API (Python), локальные модели Ollama для QA/классификации/извлечения, сервисы обработки файлов (PDF/RTF/XLSX/ARP/GSFX/XML, изображения), подсистема логов/артефактов.
- **Принципы**: микросервисность, контейнеризация (Docker/Compose), API-first, offline-first (air-gapped), безопасность by design.
- **Форматы и источники**: PDF (machine-readable/scan/mixed), ARP/GSFX/XML (сметы), RTF/DOCX, XLSX/CSV, изображения. DWG → DXF при необходимости (штамп не извлекается из DXF).
- **Примеры данных**: входные кейсы и артефакты хранятся в `documentation/06-assets/input-documents` и `output-documents`.

## 4. Основные пайплайны и артефакты
- **Детект формата PDF**: классификация mc_pdf/scan_pdf/mixed_pdf → выбор пути; артефакт `routeDecision.json`.
- **OCR (сканы/изображения)**: предобработка (deskew/denoise/binarize), распознавание текста, координаты; артефакт `text.json`.
- **Штампы (PDF)**: детект области штампа, распознавание полей (title/cipher/sheetNumber/documentName/sheetFormat/designStage/organization/documentDate/revisionNumber), координаты и confidence; артефакт `titleBlock.json`.
- **Таблицы**: поиск табличных областей, восстановление структуры (merged, иерархия заголовков), извлечение ценовых полей; артефакт `tables.json`/CSV.
- **Сметы (ARP/GSFX/XML/XLSX)**: унифицированная модель Estimate (разделы → позиции → ресурсы), валидация qty/unitPrice/amount, round-trip; артефакт `estimate.json`/CSV.
- **Нормативка (ГОСТ/СП)**: загрузка локальных норм, формирование базы знаний, проверки и отчёты о несоответствиях.
- **Ответы на запросы**: понимание запроса (NLU), поиск в базе знаний/артефактах, формирование ответов и отчётов (Excel/JSON/CSV).
- **Логи**: processing/audit, validationReport.json (проверки форматов/структуры), артефакты экспортов.

## 5. SLA и метрики
- OCR сканов ≤ 30 сек/страница; детект типа PDF ≤ 3 сек/док.
- Ответ на запрос/генерация Excel/экспорт ≤ 30 сек (зависит от операции).
- Точность: CER/WER печатный текст ≤ 5–10%; штампы ≥ 97%; таблицы полнота ≥ 95%, ценовые поля ≥ 90%; сметы поля ≥ 95%; покрытие приоритетных ГОСТ ≥ 90%.
- Проектная привязка: 100% артефактов с projectId/rdCipher и ACL.

### 5.1 Метрики и acceptance per-пайплайн (контрольные наборы уточняются)
- OCR: CER/WER, время на страницу, наличие координат, лог времени шагов.
- Штампы (PDF): полнота полей, точность координат/confidence, валидация форматов; `titleBlock.json`.
- Таблицы (PDF/DXF): полнота извлечения, заполненность ценовых полей, корректность структуры; `tables.json`/CSV.
- Сметы: полнота ключевых полей, валидация qty/unitPrice/amount, корректность round-trip; `estimate.json`/CSV.
- Нормативка: покрытие приоритетных норм, корректность ссылок в отчётах, время проверки.
- Экспорт/отчёты: время генерации/экспорта, валидация структуры/форматирования, наличие trace/артефактов.
- Проектный контекст/ACL: 100% артефактов с projectId/rdCipher; отказ при нарушении ACL логируется.

Примечание: контрольные наборы и точные пороги согласуются после получения эталонов данных и шаблонов.

## 6. Деплой и окружение
- Docker/Compose, сервисы для backend, клиента и моделей.
- Конфиги через ENV/файлы: пути к данным, модели, хранилища артефактов, порты.
- Локальное развертывание (air-gapped); поддержка кешей моделей/образов.

## 7. Ограничения и риски
- Качество входных данных (низкое качество сканов, сложные чертежи).
- Зависимость от локальных моделей (качество LLM/OCR в offline).
- Нужны эталоны шаблонов Excel ПТО/сметы и список приоритетных ГОСТ/СП.
- Нормативная база требует актуализации; процедуры миграции должны быть отлажены.
- Производительность на целевом железе (CPU/GPU/RAM) требует подтверждения.
- Форматы: DWG не обрабатывается напрямую — при необходимости конвертация в DXF (штамп извлекается только из PDF); ограничения по размеру файлов требуют согласования; версии ARP/GSFX для контрольных наборов пока не подтверждены.
- Скан-качество: шум/кривизна снижают точность; нужна предобработка.
- DXF: большое число слоёв/текста может замедлять обработку; нужна проверка на реальных примерах.

## 8. Открытые вопросы
- Подтвердить фактические SLA на целевом стенде (OCR/запросы/экспорт).
- Предоставить список приоритетных ГОСТ/СП и эталоны Excel-шаблонов подразделений.
- Уточнить версии и объёмы входных смет (ARP/GSFX/XML) и DXF кейсов.
- Подтвердить требования к инфраструктуре (CPU/GPU, RAM, диск) и список моделей для прод-стенда.
