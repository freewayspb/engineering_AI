# Описание работы прототипа BA_AI_GOST

**Версия**: 0.1 (черновик для заказчика)  
**Дата**: 2025-XX-XX  
**Назначение**: Консолидированное описание текущего прототипа (архитектура, пайплайны, артефакты, метрики) на основе материалов `documentation/08-tech-documentation/` и требований `documentation/02-requirements/`.

---

## 1. Обзор и назначение
- **Цель прототипа**: подтвердить техническую осуществимость локальной системы ИИ для обработки инженерных документов (извлечение, классификация, ответы на текстовые запросы) без доступа к интернету.
- **Объем**: обработка многоформатных документов (PDF, DWG/DXF, ARP/GSFX/XML, RTF/DOCX, XLSX/CSV, изображения), проектная привязка данных, формирование Excel/JSON/CSV отчётов.
- **Роли**: Учитель системы (загрузка/валидация данных), Пользователь (запросы/отчёты), Администратор (доступы/конфигурация).

## 2. Архитектура и стеки
Опирается на `solution-architecture.md` и `technical-specification.md`.
- **Компоненты**:
  - Клиентское приложение (web/desktop, папка `app/`) для загрузки и запросов.
  - Backend API (Python, папка `backend/`), REST, обработка файлов и оркестрация пайплайнов.
  - ML/LLM слой: Ollama-модели для QA/классификации/извлечения (`ollama/models`, `prompts`).
  - Файловые сервисы: парсинг PDF/DWG/RTF/XLSX/ARP/GSFX/XML, OCR, нормализация смет.
  - Логирование и артефакты: JSON/CSV/XLSX, audit/processing logs.
- **Принципы**: микросервисный подход, контейнеризация (Docker/Compose), API-first, offline-first (air-gapped), безопасность by design.
- **Форматы и источники**:
  - Документы: PDF (machine-readable/scan/mixed), DWG/DXF, ARP/GSFX/XML (сметы), RTF/DOCX, XLSX/CSV, изображения (JPG/PNG/TIFF/BMP).
  - Примеры входных данных — `documentation/06-assets/input-documents/`; примеры артефактов — `documentation/06-assets/output-documents/`.

## 3. Основные пайплайны
Сводка по FR/UC из `documentation/02-requirements/` и прототипам `documentation/03-prototypes/`:
- **Детект формата и ветвление**: определение mc_pdf/scan_pdf/mixed_pdf → выбор пути (FR-OCR-06).
- **OCR и извлечение штампа**: OCR для сканов/изображений, парсинг штампа PDF (FR-OCR-01B/01C/05, FR-STAMP-01..03) с артефактом `titleBlock.json`.
- **Таблицы и спецификации**: поиск табличных областей в PDF/DWG, восстановление структуры и итогов (FR-TABLE-01..04) → артефакты `tables.json`/CSV.
- **Сметы**: унифицированная модель Estimate и round-trip ARP/GSFX/XML/XLS (FR-ESTIMATE-01..06) → артефакты `estimate.json`/CSV и логи формул.
- **Нормативка**: загрузка, база знаний, проверки и отчёты по ГОСТ/СП (FR-NORMS-01..04, FR-NORM-05..09).
- **Ответы на запросы**: NLU + поиск в базе знаний/артефактах → формирование Excel/JSON/CSV отчётов (FR-QUERY-01..04, FR-EXCEL-01..08, FR-EXCEL-TPL-*).
- **Логи и артефакты**: processing/audit logs, routeDecision.json, validationReport.json, titleBlock.json, tables.json, estimate.json/CSV, итоговые отчёты Excel/CSV/JSON.

## 4. SLA и метрики прототипа
- OCR scan ≤ 30 сек/страница; детект типа PDF ≤ 3 сек/док.
- Ответ на текстовый запрос/формирование Excel/экспорт ≤ 30 сек (зависит от операции).
- Точность: CER/WER печатный текст ≤ 5–10%; штампы ≥ 97%; таблицы полнота ≥ 95%, ценовые поля ≥ 90%; сметы поля ≥ 95%; покрытие приоритетных ГОСТ ≥ 90%.
- Проектная привязка: 100% артефактов с projectId/rdCipher и ACL.

### 4.1 Метрики и acceptance per-пайплайн (контрольные наборы уточняются)
- **OCR (PDF/сканы/изображения)**: CER/WER; время на страницу; наличие координат; лог времени шагов.
- **Штампы (PDF)**: полнота полей, точность координат и confidence; валидация форматов; артефакт `titleBlock.json`.
- **Таблицы (PDF/DXF)**: полнота извлечения ≥ 95% (по контрольным примерам), заполненность ценовых полей ≥ 90%; корректность merged/иерархии; `tables.json`/CSV.
- **Сметы (ARP/GSFX/XML/XLSX)**: полнота ключевых полей ≥ 95%; валидация qty/unitPrice/amount; корректность round-trip; `estimate.json`/CSV.
- **Нормативка (ГОСТ/СП)**: покрытие приоритетных норм ≥ 90% (список уточняется); корректность ссылок в отчётах; время проверки.
- **Экспорт/отчёты**: время генерации/экспорта ≤ 30 сек; валидация структуры/форматирования (FR-EXCEL/FR-EXCEL-TPL); наличие trace/артефактов.
- **Проектный контекст/ACL**: 100% артефактов с projectId/rdCipher; отказ при нарушении ACL логируется.

Примечание: конкретные контрольные наборы/пороговые значения требуют согласования с заказчиком (будут уточнены после получения эталонов данных и шаблонов).

## 5. Деплой и окружение
- Контейнеры: Docker/Compose (`docker-compose.yml`), отдельные сервисы для backend, клиентской части и моделей Ollama.
- Конфиги: ENV/файлы для путей, моделей, хранилищ артефактов, портов.
- Развёртывание: полностью локально (air-gapped); поддержка кешей моделей/образов (scripts/cache/*).

## 6. Ограничения и риски
- Качество входных данных (низкое качество сканов, сложные DWG/DXF).
- Зависимость от локальных моделей (качество LLM/OCR в offline).
- Требуются эталоны шаблонов Excel ПТО/сметы и приоритетные ГОСТ/СП.
- Нормативная база требует регулярной актуализации; процедуры миграции должны быть отлажены.
- Производительность на целевом железе (CPU/GPU/RAM) требует подтверждения.
- **Форматы и обработка графики**: DWG не обрабатывается напрямую — при необходимости конвертация в DXF перед пайплайном, штамп сейчас только из PDF.
- **Версии/объёмы**: поддерживаемые версии PDF уточняются; есть ограничения на размер файлов (требуется согласование целевых лимитов).
- **Сметы**: фактические версии ARP/GSFX для контрольных наборов пока не подтверждены.
- **Скан-качество**: низкое качество/шум/кривизна страниц снижает точность OCR; требует предобработки.
- **DWG/DXF**: большое число слоёв/текста может замедлять обработку; нужна валидация на реальных примерах.

## 7. Открытые вопросы
- Подтвердить фактические SLA на целевом стенде (OCR/запросы/экспорт).
- Предоставить список приоритетных ГОСТ/СП и эталоны Excel-шаблонов подразделений.
- Уточнить версии и объёмы входных смет (ARP/GSFX/XML) и DWG/DXF кейсов.
- Подтвердить требования к инфраструктуре (CPU/GPU, RAM, диск) и список моделей Ollama для прод-стенда.
