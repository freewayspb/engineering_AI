# Прототип 1: Извлечение данных и обучение системы (OCR + Learning)

**Цель**: Проверка качества распознавания текста и обучения системы на корпоративных документах  
**Статус**: В разработке  
**Приоритет**: Критический  

---

## Описание

Прототип демонстрирует техническую осуществимость автоматического извлечения текста из различных форматов документов с использованием OCR-технологий и обучение интеллектуальной системы на этих данных для последующего ответа на текстовые запросы.

### Связь с пользовательскими сценариями (UC)
- UC-04: Извлечение данных из документов (PDF: mc_pdf/scan_pdf) с парсингом главного штампа и табличных областей
- UC-04a: DWG Title Block and Table Extraction (штамп + табличные блоки)
- UC-04b: Estimate Parsing (ARP/GSFX/XML/XLS) – первичный парсинг в унифицированную модель (без продвинутой нормализации)
- UC-01: Подготовка обучающих данных (через извлечённые структуры)

### Входные форматы
- **PDF** - сканы и текстовые документы
- **Изображения** - JPG, PNG, TIFF
- **DWG** - чертежи AutoCAD
- **Сметы** - ARP (.arp), GSFX (.gsfx)
- **Нормативные документы** - ГОСТы, СНиПы, СП (DOCX, PDF)

### Выходные данные
- Извлеченный текст с координатами
- Метаданные документа с проектной привязкой
- `titleBlock` (если применимо) + `TitleBlockExtractionLog`
- Базово структурированные таблицы (спецификации/сметы)
- Информация о качестве распознавания
- Статус обучения документа

---

## План реализации

### Этап 1: Исследование технологий (2 дня)
- [ ] Анализ OCR-решений для локального развертывания
- [ ] Тестирование Tesseract, EasyOCR, PaddleOCR
- [ ] Оценка производительности на тестовых данных
- [ ] Исследование технологий обучения на документах

### Этап 2: Базовая реализация OCR (3 дня)
- [ ] Создание модуля OCR для PDF/изображений
- [ ] Интеграция с выбранной OCR-библиотекой
- [ ] Реализация предобработки изображений
- [ ] Добавление проектной привязки к метаданным

### Этап 3: Специализированные форматы (3 дня)
- [ ] Обработка DWG-файлов (извлечение текстовых слоев)
- [ ] Парсинг смет ARP/GSFX
- [ ] Обработка нормативных документов (ГОСТы, СНиПы)
- [ ] Создание унифицированного API

### Этап 4: Обучение системы (3 дня)
- [ ] Реализация механизма обучения на документах
- [ ] Создание базы знаний из извлеченных данных
- [ ] Валидация качества обучения
- [ ] Интеграция с системой ответов на запросы

### Этап 5: Тестирование (2 дня)
- [ ] Тестирование на образцах заказчика
- [ ] Измерение точности распознавания
- [ ] Тестирование качества обучения системы
- [ ] Документирование ограничений

---

## Критерии успеха

- **Точность OCR**: ≥95% для качественных документов
- **Время обработки**: ≤30 сек на документ
- **Поддержка форматов**: PDF, JPG, PNG, DWG, ARP, GSFX, DOCX
- **Локальное развертывание**: работа без интернета
- **Качество обучения**: ≥90% успешного извлечения знаний из документов
- **Проектная привязка**: 100% документов привязаны к проектам

### Границы прототипа (out of scope для P1)
- Нормализация смет до бухгалтерской детализации (перенос в Прототип 2)
- Шаблон‑специфичное форматирование отчётов (перенос в Прототип 2)

---

## Технический стек

- **OCR**: Tesseract/EasyOCR
- **PDF**: PyMuPDF/PyPDF2
- **DWG**: ezdxf
- **Обучение**: spaCy, transformers, scikit-learn
- **База знаний**: SQLite/PostgreSQL
- **Язык**: Python 3.11+
- **Контейнеризация**: Docker

---

## Риски

- Низкое качество сканирования документов
- Сложность парсинга специализированных форматов
- Производительность на больших файлах
- Недостаток качественных данных для обучения системы
- Сложность обучения на разнородных документах
- Производительность больших моделей обучения

---

## Demo Script (без метрик)
1. Загрузка входных файлов: PDF (МЧ и СО), DWG, ARP, GSFX, XML, XLS, DOCX.
2. Автоопределение типа (mc_pdf/scan_pdf/dwg/arp/gsfx/xml/xls/docx).
3. Для PDF (СО): предобработка (deskew/denoise/binarization) и OCR.
4. Извлечение: текст + координаты; парсинг `titleBlock` (штамп) и запись `TitleBlockExtractionLog`.
5. Извлечение таблиц (спецификации) из PDF/DWG; базовый парсинг смет ARP/GSFX/XML/XLS.
6. Сохранение метаданных и структурированных данных; показ привязки к проекту.
7. Просмотр промежуточных JSON (metadata, titleBlock, tables) и экспорт примерного XLS.

## Acceptance Checklist (без метрик)
- [ ] Тип файла корректно определён для каждого входа.
- [ ] Для PDF (СО) применяется предобработка и OCR выполняется без падений.
- [ ] Поля штампа извлечены и сохранены в `titleBlock`; присутствует лог извлечения.
- [ ] Табличные данные спецификаций извлечены (PDF/DWG) в базовую структуру.
- [ ] Сметы ARP/GSFX/XML/XLS распарсены в унифицированную структуру (без полной нормализации).
- [ ] Все артефакты сохраняются локально; показана проектная привязка.

---

## Sample data pack (для демонстрации)
- `documentation/06-assets/input-documents/prototype-input-documents/1..pdf` (PDF МЧ)
- `documentation/06-assets/input-documents/prototype-input-documents/2..pdf` (PDF СО)
- `documentation/06-assets/input-documents/prototype-input-documents/3..dwg` (DWG)
- `documentation/06-assets/input-documents/prototype-input-documents/4.arp` (ARP)
- `documentation/06-assets/input-documents/prototype-input-documents/5.gsfx` (GSFX)
- `documentation/06-assets/input-documents/prototype-input-documents/6.xml` (XML)
- `documentation/06-assets/input-documents/prototype-input-documents/7..rtf` (RTF, при необходимости)
- `documentation/06-assets/input-documents/prototype-input-documents/8.xlsx` (XLSX)

Связанные UC: UC‑04, UC‑04a, UC‑04b, UC‑21..UC‑32.
