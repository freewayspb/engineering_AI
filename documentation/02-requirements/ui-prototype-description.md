# Описание пользовательского интерфейса — экран «Обработка документов» (прототип 29.11.2025)

Документ описывает пользовательский интерфейс экрана обработки документов, показанный на прототипе «2025-11-29 15.01.37.jpg», с учетом требований проекта «AI GOST» (SRS v1.0, 01.10.2025). Экран предназначен для загрузки файлов, постановки текстового вопроса и получения результатов обработки/анализа.

## 1. Назначение и пользователи
- **Цель экрана:** загрузка файлов (PDF/изображения/ARP/GSFX/XML/XLSX/DWG/DXF/DOCX), постановка вопроса к содержимому, запуск обработки и получение структурированных ответов/артефактов.
- **Роли:** Учитель системы и Пользователь системы; права и видимость файлов ограничены ACL и проектным контекстом.
- **Результаты:** текстовый ответ (markdown), метаданные файла (тип, уверенность, страницы, размер), артефакты (titleBlock.json, tables.json/CSV, estimate.json/CSV, validationReport.json, отчёты), возможность экспорта в Excel/CSV/JSON/PDF.

## 2. Общий макет
- Двухколоночный экран: слева — панель управления и загрузки, справа — статус обработки и результаты.
- Фон градиентный; визуальный акцент на правом блоке прогресса и выходных данных.
- Адаптация: на узких экранах левая панель переходит сверху, правая — ниже (стек вертикально).

## 3. Левая панель (управление)
### 3.1 Блок загрузки
- Заголовок/подсказка: «Перетащите файлы сюда или нажмите для выбора».
- Поддержка drag & drop и выбора через файловый диалог.
- Отображение списка выбранных файлов; в прототипе показан файл `4.arp` с inline-кнопкой «Обработать» для быстрого запуска обработки выбранного файла.
- Разрешенные форматы (по SRS): PDF (машиночитаемые/сканы), JPG/PNG, ARP/GSFX/XML/XLS, XLSX, DWG/DXF, DOCX (нормативные).
- Размер файла: без ограничений (ограничения определяются инфраструктурой заказчика); при загрузке показывать спиннер/прогресс при больших файлах.
- Для каждого файла отображать базовые метаданные после загрузки: имя, тип (автодетект), размер, число страниц (если применимо), проект (если уже привязан), статус проверки ACL.

### 3.2 Настройки
- Поле «Язык ответа»: выпадающий список, значение по умолчанию — Русский. Язык влияет на текстовый ответ и формулировки рекомендаций.
- Поле «Проект» (обязательное): ввод/выбор projectId или rdCipher, применяется ко всем операциям и артефактам; без него запуск запрещён.
- Опции запроса: режим ответа (list/detail/aggregate), фильтры (дата, тип документа, стадия/материал, приоритет для аналогов), лимит выдачи.

### 3.3 Вопрос к документам
- Поле многострочного ввода с подписью «Вопрос к документам».
- Подсказка в прототипе: «Просуммируй все цены и выведи только одно число суммы».
- Валидация: обязательное поле для запуска обработки (минимум 1 символ, обрезка лишних пробелов).

### 3.4 Действия
- **Обработать документы** — основная кнопка (primary). Активна при наличии хотя бы одного файла и текста вопроса.
- **Экспорт результатов** — вторичная кнопка. Активна после успешной обработки; сохраняет отчет/артефакты (XLSX/CSV/JSON/PDF).
- **Очистить** — кнопка сброса (danger/secondary): удаляет выбранные файлы, очищает вопрос и результаты.

## 4. Правая панель (статус и результаты)
### 4.1 Прогресс обработки
- Заголовок: «Прогресс обработки».
- Статусная строка: «Обработка завершена» (в успехе); в процессе — «Обработка выполняется», при ошибке — текст ошибки/причины.
- Возможное дополнение: индикатор прогресса/спиннер при активной обработке, скрыт после завершения.
- Для батча файлов отображать шаги пайплайна: загрузка → OCR/парсинг → таблицы/штамп/смета → формирование отчёта → валидация; время по шагам (SLA 30 сек на запрос/страницу OCR).

### 4.2 Результаты обработки
- Заголовок: «Результаты обработки».
- Блок по каждому файлу:
  - Ссылка на исходный файл (пример: `4.arp`) — открытие/скачивание артефакта.
  - Метаданные: Тип (архивный файл), Уверенность (процент), Страницы (число), Размер (KB/MB).
  - Тоггл/ссылка «Показать извлеченный текст» — разворачивает/сворачивает текстовые артефакты и анализ.
- Артефакты и кнопки скачивания:
  - `titleBlock.json` (штамп с координатами/confidence),
  - `tables.json` / CSV (структура таблиц, ценовые поля),
  - `estimate.json` / CSV (нормализованная смета),
  - `validationReport.json` (отчёт по шаблонам/нормативке),
  - итоговый Excel/CSV/JSON, экспорт в PDF (при необходимости).
- Текстовый ответ:
  - Формат: markdown; может содержать заголовки, списки, полужирные акценты, числовые значения и рекомендации.
  - Содержит извлеченный текст, анализ, ключевые выводы, рекомендации, суммы/агрегаты, ссылки на источники (документ/страница/фрагмент) и trace.
  - Поле read-only; допускается копирование текста (кнопка «Копировать» опционально рядом с заголовком блока).
- Ошибки/предупреждения: отдельный список с кодом/описанием (например, неподдерживаемый формат, низкий confidence, нарушение ACL); остальные файлы продолжают обрабатываться.

## 5. Основной пользовательский сценарий
1. Пользователь перетаскивает/выбирает файл(ы) в блок загрузки (пример: `4.arp`).
2. Выбирает проект (projectId/rdCipher) и при необходимости фильтры запроса, меняет «Язык ответа» (по умолчанию — Русский).
3. Вводит вопрос/задание в поле «Вопрос к документам» и выбирает режим (list/detail/aggregate).
4. Нажимает «Обработать документы» (или inline «Обработать» в списке файлов).
5. Видит статус в блоке «Прогресс обработки» (шаги → «Обработка завершена»), время выполнения.
6. В блоке «Результаты обработки» просматривает ссылки на файл, артефакты, trace и текстовый ответ.
7. При необходимости жмет «Экспорт результатов» (отчёт/артефакты) или «Очистить» для нового запуска.

## 6. Состояния и UX-детали
- **Initial:** нет файлов, поля пустые, кнопки «Обработать документы» и «Экспорт результатов» неактивны.
- **Файлы добавлены:** отображается список имен; кнопка обработки активна.
- **Обработка:** кнопки загрузки и очистки блокируются, отображается прогресс/спиннер; кнопка экспорта недоступна.
- **Успех:** статус «Обработка завершена», доступны метаданные, текстовый ответ и экспорт.
- **Ошибка:** статус с описанием ошибки; подсвечивается блок прогресса; кнопка обработки снова доступна после устранения проблемы.
- **Очистка:** удаляет выбранные файлы, сбрасывает вопрос и результаты, возвращает в initial.
- **ACL/контекст:** при отсутствии projectId или нарушении прав отображается отказ с причиной; действия блокируются до исправления.

## 7. Требования и ограничения (из SRS, применимые к UI)
- Локальная работа без интернета; все операции — внутри контура заказчика.
- Режимы ACL: доступные файлы и действия зависят от роли (teacher/user) и проекта.
- Журналирование: ошибки неподдерживаемых/битых файлов должны сообщаться пользователю и фиксироваться в логах; обработка остальных файлов продолжается.
- Форматы артефактов: текстовые ответы и отчеты должны соответствовать выбранному языку; выгрузка — Excel/CSV/JSON/PDF + служебные JSON (titleBlock/tables/estimate/validationReport).
- SLA/перфоманс: время ответа ≤ 30 сек на запрос; OCR ≤ 30 сек/страница; детект типа PDF ≤ 3 сек/док; показывать время по шагам.
- Поддержка многостраничных PDF и крупных файлов DXF/смет; при превышении лимитов отображать предупреждения и частичные результаты.

## 8. UI-взаимодействия для роли «Учитель»
- **Выбор пресетов задач при загрузке**: для каждого файла Учитель видит чек-лист типовых операций (штамп, таблицы, смета, нормативка, отчёт). Можно включать/выключать операции перед запуском; выбранный набор сохраняется как пресет проекта.
- **Редактирование инструкций**: рядом с каждым чек-боксом доступна ссылка «Настроить» — короткая форма для уточнения полей/порогов (пример: DPI, пороги confidence, тип отчёта). Сохранённые настройки применяются к следующим файлам проекта.
- **Повторный запуск шагов**: в результатах у каждого файла доступны кнопки «Повторить шаг» для конкретного этапа (OCR/таблицы/смета/валидация). После повторного запуска фиксируются новая версия артефактов и ссылка на прошлую.
- **Управление версиями артефактов**: таблица версий по файлу: время, автор, шаги, метки (Reference/Draft), ссылки на titleBlock/tables/estimate/validationReport. Кнопка «Откатить» создаёт новую версию из выбранной.
- **Качество и подтверждение**: если confidence < порога или CER/WER не проходят, блок «Требует подтверждения» подсвечивает проблемные поля штампа/таблиц/смет; Учитель отмечает «Принять/Исправить», комментарий сохраняется и повышает правила для проекта.
- **Экспорт обучающего пакета**: кнопка «Экспорт знаний» собирает выбранные артефакты (titleBlock/tables/estimate/validationReport) и настройки в пакет для импорта в другой проект; отображается размер и состав пакета.

## 9. Интерфейс работы с ГОСТ/СП (нормативка)
- **Загрузка и версия нормативов**: отдельный раздел/вкладка «Нормативка». Учитель/Админ загружает DOCX/PDF с ГОСТ/СП; система извлекает метаданные (номер, название, редакция, дата) и показывает текущую активную версию, историю версий и кнопку «Сделать активной».
- **Список правил и покрытие**: таблица правил с полями: Норматив/пункт, условие/диапазон, категория (Critical/Warning/Info), редакция, дата изменения, статус (активно/черновик). Отображается покрытие приоритетных норм (%). Фильтры по нормативу, категории, редакции.
- **Проверка соответствия**: форма выбора проекта/отчёта/сметы и кнопка «Проверить по ГОСТ». Результат — блок «Отчёт о несоответствиях» с группировкой по критичности, ссылками на норматив/пункт/страницу/редакцию, возможностью выгрузить validationReport.json и PDF выжимку.
- **Просмотр выжимок**: панель предпросмотра выжимок (выделенные выдержки из нормы) с копированием ссылки на пункт. Кнопка «Экспорт в PDF» сохраняет текущие выжимки и ссылки.
- **Версионирование и откат**: для нормативов и правил доступна история изменений с метками редакций; кнопка «Откатить» создает новую активную версию из выбранной; показываются изменения (что добавлено/убрано).
- **Настройки порогов**: поля для SLA проверки (≤30 сек), лимиты объёма базы, политика ретенции версий; пороги критичности для блокировки/предупреждения. Настройки сохраняются по проекту/глобально.
- **ACL и аудит**: доступ к загрузке/активации нормативов только у Учителя/Админа; все изменения правил и запуск проверок логируются, в UI виден журнал последних операций.

## 10. Обучение через промты и образцы (роль Учитель)
- **Промт задачи**: форма «Инструкция системе» с описанием того, что нужно сделать с документами (например, правила извлечения, формат отчёта, ссылки на пункты ГОСТ). Поддержка шаблонов промтов и автоподстановки projectId/rdCipher.
- **Входящие файлы**: блок добавления входных примеров (PDF/ARP/GSFX/XML/XLSX/DWG/DOCX). Для каждого файла фиксируются тип, размер, страницы, ссылка на проект, статус ACL. Отмечается, является ли файл эталонным для обучения.
- **Целевые (эталонные) результаты**: загрузка примеров выходных файлов, к которым нужно стремиться (Excel/CSV/JSON/PDF). UI сохраняет связь вход → ожидаемый выход; отображает список сопоставлений.
- **Привязка к ГОСТ/СП**: в промте и карточке задачи есть поле «Правила оформления (ГОСТ/СП)» с выбором нормативов и ссылками на пункты; при проверке/генерации система использует активные правила и показывает их в отчёте.
- **Проверка исполнения**: после запуска обработки рядом с артефактами показывается сравнение с эталонами (differences/OK) и несоответствия ГОСТ (Critical/Warning/Info).
- **Сохранение набора обучения**: кнопка «Сохранить как обучающий набор» фиксирует промт, входные и эталонные выходные файлы, ссылки на нормы и настройки; набор можно переиспользовать в других проектах/запусках.

## 11. Промт для генерации полного UI-описания
Используйте этот промт, чтобы сгенерировать полный документ интерфейса, покрывающий все функции из требований:

```
Сгенерируй детальное описание пользовательского интерфейса для системы AI GOST с учётом требований:
- Роли и ACL: экраны логина/выбора роли, обязательный projectId/rdCipher, настройка прав, журнал ACL/доступ к артефактам.
- Импорт/обработка: загрузка одиночных файлов и папок (рекурсивно), поддержка PDF/JPG/PNG/ARP/GSFX/XML/XLS/XLSX/DWG/DXF/DOCX, статусы ошибок без остановки очереди, шаги пайплайна (OCR/детект PDF/таблицы/штамп/смета/валидация/отчёты), SLA (30 сек запрос, OCR 30 сек/стр., детект PDF 3 сек/док), отображение времени.
- Пресеты и промты Учителя: чек-листы задач (штамп, таблицы, сметы, нормативка, отчёты), поле «Инструкция системе», связки вход→эталонный выход, выбор ГОСТ/СП и пунктов, сравнение с эталонами, сохранение обучающих наборов.
- Артефакты и версия знаний: скачивание titleBlock.json, tables.json/CSV, estimate.json/CSV, validationReport.json, итоговых Excel/CSV/JSON/PDF; версии артефактов (Reference/Draft), сравнение, откат, публикация.
- Сметы и round-trip: импорт ARP/GSFX/XML/XLSX, отображение статусов формул (OK/Warning/Broken), правка коэффициентов, экспорт обратно, сверка итогов.
- Шаблоны Excel: реестр шаблонов (версии/владелец/статус), загрузка/активация/откат, проверка отчёта против шаблона, просмотр validationReport.
- Нормативка ГОСТ/СП: загрузка/версии нормативов, таблица правил (Critical/Warning/Info), покрытие норм, запуск проверки отчётов/смет, отчёт о несоответствиях, экспорт выжимок PDF, пороги блокировки, журнал изменений.
- Поиск аналогов и готовые отчёты: фильтры по типу/стадии/материалам, выдача аналогов с trace, запуск готовых отчётов (спецификация/бюджет/сравнение), экспорт.
- API/интеграции: управление токенами, webhooks (URL/ретраи/SLA), лимиты запросов, журналы доставки.
- Логи и аудит: просмотр логов обработки/ошибок/действий, фильтры, экспорт, резервное копирование.
- Мониторинг/ресурсы: дашборд SLA, очередь задач, предупреждения по лимитам размеров/страниц/слоёв, состояние бэкапов/ретенции.
- Настройки окружения: пути хранилищ, лимиты размеров/страниц/листов, параметры моделей (OCR/LLM), офлайн-режим, бэкапы/ретенция.
Для каждого блока опиши: назначение, ключевые элементы UI, состояния (initial/loading/success/error), доступность по ролям, отображаемые артефакты и действия пользователя. Используй русский язык и термины из SRS/functional-requirements.
```

## 12. Полное описание интерфейса по требованиям

### 12.1 Роли, аутентификация и ACL
- Назначение: вход в систему, выбор роли, применение проектного контекста и прав.
- Ключевые элементы: экран логина; переключатель роли (Учитель/Пользователь/Администратор) при наличии прав; поле projectId/rdCipher (обязательное); баннер о выбранном проекте; список доступных операций по роли; журнал последней активности и ACL-событий.
- Состояния: initial (не авторизован), loading (проверка токена/ролей), success (доступ открыт), error (ошибка авторизации/нет прав/нет projectId).
- Роли и доступ: Администратор — управление ролями/ACL, токенами, нормативкой; Учитель — загрузка/обучение/промты/версии; Пользователь — запросы/отчёты/поиск аналогов.

### 12.2 Импорт и обработка документов
- Назначение: загрузка одиночных файлов и папок, запуск пайплайна (OCR → детект PDF → таблицы → штамп → смета → нормативка → отчёты).
- Ключевые элементы: drag&drop зона; кнопка «Импорт папки» (рекурсивно); список файлов с типом/размером/страницами/ACL-статусом; чек-лист задач (штамп, таблицы, смета, нормативка, отчёты); выбор режима ответа (list/detail/aggregate); лимиты результата; фильтры по дате/типу/стадии/материалам; кнопка «Обработать».
- Пайплайн и SLA: отображение шагов с таймингами (детект PDF ≤3 сек/док, OCR ≤30 сек/стр., весь запрос ≤30 сек); прогресс по батчу; ошибки без остановки очереди; лог шагов.
- Состояния: initial (нет файлов/папки), loading (загрузка), processing (пайплайн шаги), success (артефакты готовы), error (частичные/полные сбои).
- Роли: Учитель/Пользователь могут запускать; ACL фильтрует доступные файлы и операции.

### 12.3 Пресеты и промты Учителя
- Назначение: задать инструкцию, выбрать операции и целевые форматы, привязать ГОСТ/СП и эталоны.
- Ключевые элементы: поле «Инструкция системе»; чек-лист задач; выбор ГОСТ/СП и пунктов; загрузка входных файлов и эталонных выходных; список связок вход→эталон; кнопка «Сохранить как набор»; выбор сохранённого набора.
- Состояния: initial (пустой промт), editing (заполняется), saved (набор доступен), error (валидация/ACL).
- Роли: Учитель.

### 12.4 Артефакты и версии знаний
- Назначение: хранение/скачивание артефактов и управление версиями знаний по проекту.
- Ключевые элементы: список артефактов (titleBlock.json, tables.json/CSV, estimate.json/CSV, validationReport.json, итоговые Excel/CSV/JSON/PDF, trace); кнопки скачивания; таблица версий (Reference/Draft, автор, время, changeSummary); сравнение версий; откат; публикация Reference.
- Состояния: initial (нет версий), success (версии/артефакты доступны), error (нет доступа/нет артефактов).
- Роли: Учитель (создание/публикация), Администратор (ретенция/очистка), Пользователь (просмотр Reference).

### 12.5 Сметы и round-trip
- Назначение: импорт ARP/GSFX/XML/XLSX в единую модель Estimate, валидация формул, экспорт обратно.
- Ключевые элементы: форма импорта; просмотр дерева сметы (разделы→позиции→ресурсы); индикаторы формул (OK/Warning/Broken); редактор коэффициентов/цен; сверка итогов; кнопка round-trip экспорта; отчёт об отклонениях.
- Состояния: initial (нет сметы), loading (парсинг), success (модель/статусы формул), error (битый формат/несовместимая версия).
- Роли: Учитель (импорт/правки/экспорт), Пользователь (просмотр), Администратор (версионность шаблонов форматов).

### 12.6 Шаблоны Excel и валидация
- Назначение: управление шаблонами отчётов и проверка отчётов на соответствие.
- Ключевые элементы: реестр шаблонов (название, версия, владелец, статус), загрузка/активация/откат, область применения; форма «Проверить отчёт»; просмотр validationReport (ошибки/предупреждения/лист/ячейка/формула); экспорт отчёта.
- Состояния: initial (нет активного шаблона), success (активный выбран, отчёт проверен), error (нарушение структуры/формул).
- Роли: Учитель/Администратор — управление; Пользователь — проверка по активному шаблону.

### 12.7 Нормативка ГОСТ/СП
- Назначение: загрузка нормативов, управление правилами, проверка отчётов/смет.
- Ключевые элементы: вкладка «Нормативка»; список нормативов с метаданными и версиями; таблица правил (Critical/Warning/Info); покрытие норм (%); кнопка «Проверить по ГОСТ»; отчёт о несоответствиях с ссылками (норматив/пункт/страница/редакция); экспорт PDF/validationReport.json; пороги блокировки; журнал изменений.
- Состояния: initial (нет активных норм), success (правила применены, отчёт сформирован), error (нет доступа/устаревшая редакция).
- Роли: Учитель/Администратор — загрузка/активация/правила; Пользователь — запуск проверки по активным правилам.

### 12.8 Поиск аналогов и готовые отчёты
- Назначение: поиск похожих проектов и запуск готовых отчётов (спецификация/бюджет/сравнение).
- Ключевые элементы: фильтры (тип объекта, стадия, материалы, теги, даты); лимит выдачи; список аналогов с признаками сходства и trace; кнопки «Запустить отчёт» (спецификация/бюджет/сравнение); экспорт Excel/CSV/JSON/PDF.
- Состояния: initial (нет запроса), loading (поиск/генерация), success (выдача/отчёты), error (нет аналогов/лимит превышен).
- Роли: Пользователь/Учитель (анализ); ACL учитывается при выдаче артефактов.

### 12.9 API и интеграции
- Назначение: управление токенами, лимитами и webhook-уведомлениями.
- Ключевые элементы: реестр токенов (проект, роль, срок действия, статус); создание/ротация/отзыв; настройки лимитов запросов; конфигурация webhooks (URL, ретраи, SLA); журнал доставок/ошибок; включение/отключение внешних интеграций.
- Состояния: initial (нет токенов), success (токены активны, webhooks работают), error (некорректный URL/превышение лимита).
- Роли: Администратор.

### 12.10 Логи и аудит
- Назначение: контроль действий и обработки.
- Ключевые элементы: журнал операций (кто/что/когда/проект/статус); фильтры по пользователю/проекту/операции/шагу пайплайна; просмотр технических логов обработки; экспорт логов; отметка попыток изменения/удаления.
- Состояния: initial (нет фильтра), success (логи отображены), error (нет доступа/перегрузка объёма).
- Роли: Администратор (полный доступ), Учитель (по своим проектам), Пользователь (минимально, по запросам).

### 12.11 Мониторинг и SLA
- Назначение: наблюдение за временем обработки и ресурсами.
- Ключевые элементы: дашборд SLA (OCR/штамп/таблицы/сметы/нормативка/отчёты), очередь задач, предупреждения о превышении лимитов размеров/страниц/слоёв, состояние бэкапов/ретенции, использование диска/CPU/GPU (если доступно локально).
- Состояния: success (в норме), warning (порог близок), error (SLA нарушено/ресурс исчерпан).
- Роли: Администратор; Учитель видит статусы по своим пакетам.

### 12.12 Настройки окружения
- Назначение: системные параметры и лимиты.
- Ключевые элементы: пути хранилищ, лимиты размеров файлов/страниц/листов/слоёв DXF, параметры моделей (OCR/LLM), включение офлайн-режима, настройки бэкапов и ретенции, политика очистки версий/логов.
- Состояния: initial (значения по умолчанию), editing (правки), success (сохранено), error (валидация/нет прав).
- Роли: Администратор.
