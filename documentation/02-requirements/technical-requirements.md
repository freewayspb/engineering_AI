# Software Requirements Specification (SRS) — Проект «AI GOST»
Версия: 1.0 (редактура)
Дата: 01.10.2025 (редактура)
Автор: Бизнес-аналитик проекта «AI GOST»

---

## 1. Введение

### 1.1 Цель документа
Настоящий документ определяет требования к программной системе «AI GOST» на этапе анализа и разработки технического задания. Документ служит основой для планирования прототипирования, архитектурной проработки и подготовки итогового ТЗ, а также для согласования объема работ и критериев приемки с Заказчиком.

### 1.2 Область применения
Система «AI GOST» предназначена для создания интеллектуальной системы обучения на корпоративных документах, включающей:
- обучение системы на проверенных документах и накопление знаний;
- обработку текстовых запросов пользователей на русском языке;
- проектно-ориентированную работу с данными;
- извлечение данных из документов (OCR) для обучения системы;
- формирование структурированных отчетов в Excel по запросам;
- работу с нормативной базой (ГОСТы) для валидации данных;
- подготовку архитектурных материалов и итогового технического задания для промышленной системы.
Результаты настоящего этапа включают рабочие прототипы по ключевым задачам и сформированное ТЗ для последующей разработки.

### 1.3 Термины и сокращения
– AI — искусственный интеллект (класс методов и технологий анализа/генерации данных).
– ML — машинное обучение (подмножество AI; обучение моделей на данных).
– OCR — оптическое распознавание символов (распознавание текста из изображений/сканов/PDF).
– NLP — обработка естественного языка (классификация/анализ текстов).
– DWG/DXF — форматы файлов чертежей (AutoCAD/обменный формат DXF).
– ARP — формат сметной документации (проект/архив сметы). (подтвердить спецификацию у Заказчика)
– GSFX — обменный формат сметных данных. (подтвердить спецификацию у Заказчика)
– JSON — машиночитаемый формат обмена данными (JavaScript Object Notation).
– JSON Schema — спецификация для описания и валидации структуры JSON‑данных.
– CSV/XLSX — табличные форматы данных.
– API — программный интерфейс приложений для интеграций/обмена данными.
– ERP/ECM/ДОУ — корпоративные системы: управление ресурсами предприятия / управление контентом / документооборот.
– ПДн — персональные данные; GDPR — общеевропейский регламент защиты данных.
– KPI — ключевые показатели эффективности (целевые метрики проекта/прототипов).
– SLA — соглашение об уровне сервиса (целевые показатели доступности/времени реакции и т.п.).
– CER/WER — метрики ошибок распознавания символов/слов для OCR.
– macro‑F1 — усреднённая по классам метрика F1 (для классификации).
– Валидность (validity) — доля записей/объектов, прошедших проверку по схеме (например, JSON Schema) без ошибок.
– Время обработки (processing time) — длительность полной обработки одного документа прототипом (сек/док).
– LLM — большие языковые модели (локальные/офлайн для NLU/NLG задач).
– BPMN/UML — нотации моделирования бизнес‑процессов и систем.
– **Учитель системы** — роль для загрузки проверенных документов и обучения системы.
– **Пользователь системы** — роль для выполнения текстовых запросов и получения данных.
– **Проектно-ориентированная работа** — привязка всех данных к конкретным проектам.
– **Текстовые запросы** — естественные запросы пользователей на русском языке.
– **Поиск аналогов** — поиск похожих проектов и извлечение данных по ним.
– **База знаний** — накопленные знания системы о проектах и документах.

### 1.4 Ссылки на документы
- Договор №24/25 от 30.09.2025.  
- Приложение 1 — График работ и контрольные точки.  
- Приложение 2 — Состав персонала.  
- Приложение 3 — Описание ключевых прототипов.

---

## 2. Общее описание

### 2.1 Цели и задачи проекта
- Создание интеллектуальной системы, которая "учится" на корпоративных документах и накапливает знания.  
- Обеспечение возможности делать текстовые запросы на русском языке и получать структурированные ответы.  
- Реализация проектно-ориентированной работы с данными и поиска аналогов по проектам.  
- Автоматизация извлечения данных из документов для обучения системы.  
- Формирование структурированных отчетов в Excel по запросам пользователей.  
- Интеграция с нормативной базой (ГОСТы) для валидации данных.  
- Создание локальной «рабочей станции ИИ», работающей в закрытом контуре и накапливающей доменные знания сотрудников.  
- Подготовка масштабируемых прототипов по ключевым задачам и оформленного ТЗ для промышленной реализации.  
- Формирование основы для продуктовой версии, которую можно предложить другим проектным и строительным компаниям после обкатки в пилоте.

### 2.2 Заинтересованные стороны и пользователи
- Спонсор проекта: генеральный директор заказчика.  
- Владельцы продукта со стороны заказчика: Денис (инициатор, отвечает за инженерные документы и доменную экспертизу) и Елена (совладелец продукта, отвечает за бизнес-вектор и рыночную перспективу).  
- **Учитель системы**: специалист по загрузке проверенных документов и обучению системы.  
- **Пользователи системы**: инженеры, проектировщики, сметчики, которые делают текстовые запросы и получают данные.  
- ИТ-служба заказчика: интеграции, безопасность, эксплуатация локальной платформы.  
- Исполнитель и соисполнители: бизнес-аналитик, архитектор/ML-специалист, разработчики прототипов, консультант по ИБ.  
- Дополнительные стейкхолдеры: юридическая служба (лицензии/правовые ограничения), руководители подразделений, предоставляющих эталонные кейсы.

### 2.3 Область данных и ключевые форматы
- Входные данные: PDF (машиночитаемые и скан‑образы), изображения (JPG/PNG), сметные форматы ARP/GSFX/XML/XLS, чертежи DWG/DXF, текстовые и табличные файлы (DOCX/XLSX), нормативные документы (ГОСТы).  
- Выходные данные: **Excel файлы** (основной формат), структурированные JSON/CSV, отчёты об обработке, текстовые ответы на запросы.  
- Нормативно-справочная база: ГОСТы, отраслевые регламенты, корпоративные стандарты и чек-листы.  
- Метаданные: проекты, роли пользователей (учитель/пользователь), история обучения, база знаний.

### 2.4 Ограничения
- Срок выполнения: 30 календарных дней с момента предоплаты (Приложение 1).  
- Бюджет: 615 000 руб. (50%/50%).  
- Ресурсы: состав команды и трудозатраты согласно Приложению 2.  
- Объем настоящего этапа: прототипы и ТЗ; промышленная разработка и интеграции — вне объема.  
- Требования ИБ Заказчика к доступу/хранению/передаче данных на уровне коммерческих документов (не "для служебного пользования").  
- **Критическое ограничение**: Система должна работать полностью локально без доступа к интернету (air-gapped environment).

### 2.4.1 Архитектурные принципы (из BRD)
- **Локальность и автономность**: Полностью офлайн работа без внешних API и интернет-соединений
- **OpenAI-подобный UX**: Естественный интерфейс взаимодействия с системой через текстовые запросы
- **Ролевая модель и ACL**: Учитель системы; Пользователи с подролями (инженер/ПТО/сметный/юр. отдел) и различными уровнями доступа к документам по проектам
- **Модульность и расширяемость**: Компонентная архитектура для независимого развития модулей
- **Локальные хранилища**: Векторные БД и хранилища знаний без внешних сервисов
- **Надёжность и восстановление**: Резервное копирование и восстановление данных
- **Портабельность**: Развёртывание на инфраструктуре заказчика

### 2.5 Допущения
- Заказчик предоставляет репрезентативные образцы документов для обучения системы.  
- Ключевые стейкхолдеры доступны для интервью и согласований согласно графику.  
- Инфраструктура Заказчика позволяет обмен данными (Excel/JSON/CSV) и тестирование прототипов.  
- Возможна установка необходимого ПО/библиотек для прототипирования.  
- **Локальное обучение**: Заказчик предоставляет эталонные входные и выходные данные для обучения локальных AI-агентов.  
- **Автономная работа**: Все AI-модели и инструменты работают без подключения к интернету.  
- **Текстовые запросы**: Пользователи будут делать запросы на русском языке.  
- **Проектно-ориентированность**: Все данные можно привязать к конкретным проектам.

### 2.6 Организация взаимодействия
- Плановый срок текущего этапа (исследование и прототипы) — 1 календарный месяц; критическая точка — финальное согласование ТЗ к концу 4-й недели.  
- Основные контактные лица со стороны заказчика (Денис, Елена) отвечают на запросы в течение 0,5 рабочего дня и готовы к интервью после 18:00 по Москве.  
- Коммуникации: общий Telegram-чат, еженедельные статусы, ад-хок встречи по узким кейсам, фиксация решений в общем репозитории.  
- Протоколирование: ключевые договорённости дублируются на почту и в рабочем хранилище (Confluence/Google Docs).

---

## 3. Функциональные требования

### 3.1 Бизнес-кейсы
- BK-01: Обучение системы на корпоративных документах и накопление знаний.  
- BK-02: Обработка текстовых запросов пользователей на русском языке.  
- BK-03: Проектно-ориентированная работа с данными и поиск аналогов.  
- BK-04: Извлечение данных из документов (OCR) для обучения системы.  
- BK-05: Формирование структурированных отчетов в Excel по запросам.  
- BK-06: Работа с нормативной базой (ГОСТы) для валидации данных.  
- BK-07: Подготовка архитектуры и ТЗ на основании результатов прототипирования.

### 3.2 Use Cases (сводка)
См. подробные сценарии в документе `use-cases.md`. Краткая сводка (ядро интеллектуальной системы):  
- UC-01 — обучение системы на документах и накопление знаний.  
- UC-02 — обработка текстовых запросов пользователей.  
- UC-03 — проектно-ориентированная работа с данными.  
- UC-04 — извлечение данных из документов (OCR) для обучения.  
- UC-05 — формирование отчетов в Excel по запросам.  
- UC-06 — работа с нормативной базой (ГОСТы).  
- UC-11 — поиск аналогов по проектам.  
- UC-12 — извлечение ведомостей объемов работ.  
- UC-13 — формирование комплектов рабочей документации.  

Примечание: фасилитационные процессы (ИБ‑анализ, согласование архитектуры, подготовка ТЗ, исследование рынка) ведутся по `../04-project-management/work-plan.md` и не рассматриваются как прототипные Use Cases.

### 3.3 Подробное описание функций

#### 3.3.1 Обучение системы на документах
- FR-LEARN-01: Загрузка проверенных и рабочих документов учителем системы (роль Teacher; ACL).  
  Поддержать каналы загрузки: Web UI, REST API и импорт из папки (рекурсивно, включая подпапки). Лимитов размера нет; сохраняются исходные форматы. Для каждого файла доступен флаг `referenceDocument` ("Эталонный документ"). При первичной обработке рабочих документов система инициирует диалог: (а) что можно сделать с этим файлом (перечень прикладных задач по типу файла), (б) какие задачи выбрать/добавить, (в) запрос подробного описания ожидаемого результата/формата/ограничений; ответы и рекомендации Учителя учитываются при обучении. Сохранять базовые метаданные файла и проекта.
  Пресеты прикладных задач (определяются по `documentType` и найденному контенту):
  - Для PDF(МЧ)/PDF(скан): извлечение штампа, извлечение таблиц спецификаций, формирование Excel отчёта;
  - Для DWG: парсинг штампа, извлечение табличных блоков, ведомость объёмов работ;
  - Для ARP/GSFX/XML/XLS: нормализация сметы (Estimate), валидация totals/единиц, экспорт XLSX;
  - Для DOCX(норматив): извлечение метаданных (name/number/approvalDate), выжимки по запросу, экспорт PDF.
  Конкретные инструкции для системы на основе живых юз кейсов (итерационные трансформации):
  - Задача 1.1 "Сводная спецификация": "Извлеки из PDF документа штамп (реквизиты) и таблицы спецификаций. Создай Excel файл с 8 столбцами: группировка по категориям (Оборудование/Материалы), извлечение наименований, единиц измерения, количеств из таблиц спецификации";
  - Задача 1.2 "Унификация спецификации": "Возьми результат задачи 1.1 и обогати его проектной информацией. Создай Excel файл с 20 столбцами: добавь проектные метаданные (шифр РД, стадия проектирования), стандартизируй позиции, унифицируй наименования по корпоративным стандартам";
  - Задача 1.3 "Бюджетирование проекта": "Возьми результат задачи 1.2 и добавь ценовую информацию. Создай Excel файл с 27 столбцами: интегрируй цены материалов/оборудования, договоры поставщиков, рассчитай стоимость по позициям, сформируй итоговые суммы по категориям".
  Список пресетов разворачивается в явные задачи; Учитель может выбирать/редактировать/добавлять свои. Выбор сохраняется и используется в FR-LEARN-02.
  Acceptance:
  - Поддержаны три канала загрузки: UI, API и импорт из папки с подпапками; все файлы поступают в единый входной поток.
  - Сохраняются метаданные: projectId, mime, sha256 (hash), sourcePath, uploaderId, uploadedAt, version, referenceDocument.
  - Инициируется диалог по прикладным задачам для файла; выбранные задачи и подробные описания сохраняются и используются в последующей обработке/обучении.
  - Конкретные инструкции для системы предоставляются для каждой прикладной задачи: сводная спецификация (8 столбцов), унификация (20 столбцов), бюджетирование (27 столбцов).
  - Итерационные трансформации документов поддерживаются: документ 1 → 1.1 → 1.2 → 1.3 с обогащением информацией на каждом этапе.
  - Ошибки: неподдерживаемые форматы и битые файлы фиксируются с кодом/сообщением; создаётся событие аудита; обработка остальных файлов продолжается.
  - Аудит: кто загрузил, когда, проект, хеш, исходный путь, версия; трассировка к UC-01; связи: FR-DAT-02 (метаданные), FR-ACCESS-01..02 (ACL), FR-LOG-01..02 (логи/артефакты).
- FR-LEARN-02: Обработка документов и извлечение знаний.
  Контекст: Pipeline прикладных задач после загрузки из FR-LEARN-01.
  Основные возможности:
  - Выполняет выбранные сценарии (сводная спецификация, унификация, бюджетирование).
  - Формирует обязательные артефакты текста, таблиц, Estimate и журналов.
  - Поддерживает итерационные трансформации и batch-перезапуски с отслеживанием статусов.
  Обучаемость и знания: Запоминает результаты уточнений учителя и повышает confidence правил извлечения.
  Acceptance:
  - Для контрольного пакета документов создаются артефакты fullText, tables, estimate и outputs в едином каталоге.
  - Цикл уточнений запускается при confidence < 0.8 и применяет ответы учителя к повторной обработке.
  - processing.log.json фиксирует requestId, ingestionId и код результата по каждому шагу пайплайна.
  Связи: FR-LEARN-01, FR-DAT-02, FR-LOG-01, FR-LOG-02, FR-PROJECT-03.
- FR-LEARN-03: Версионирование знаний и управление выпусками.
  Контекст: Хранилище артефактов обучения по проектам.
  Основные возможности:
  - Создает версии знаний с метаданными автора, источников и статуса.
  - Позволяет просматривать историю и различия между версиями.
  - Поддерживает откат и фиксацию стабильных релизов Reference.
  Обучаемость и знания: Фиксирует changeSummary, чтобы улучшать правила извлечения.
  Acceptance:
  - API create/list/get/rollback/markReference работают и логируются с requestId.
  - Версия содержит knowledgeVersion, projectId, sourceIds, changeSummary и ссылки на артефакты FR-LEARN-02.
  - rollback формирует новую версию с восстановленными артефактами и ссылкой на причину отката.
  Связи: FR-LEARN-02, FR-DAT-04, FR-KNOW-01, FR-LOG-02.
- FR-LEARN-04: Контроль качества знаний и публикации.
  Контекст: Проверка версии перед пометкой Reference.
  Основные возможности:
  - Выявляет дубликаты, ошибки парсинга и неполные записи.
  - Формирует отчет о качестве с рекомендациями и блокировками выпуска.
  - Логирует результаты проверки для трассировки.
  Acceptance:
  - Проверка фиксации выполняется для 100% артефактов версии и обновляет статус blockPublish.
  - qualityReport.json/ .md содержат список ошибок, рекомендации и ссылки на артефакты.
  - Логи включают requestId, knowledgeVersion и принятые решения (pass/fail).
  Связи: FR-LEARN-03, FR-DAT-03, FR-LOG-01, FR-LOG-02.
Связанные подсистемы: FR-DAT-03/‑04 (логирование/версионирование), FR-LOG-01/‑02 (единый лог, артефакты).

Связанные UC: UC-01, UC-11

#### 3.3.2 Обработка текстовых запросов
- FR-QUERY-01: Прием текстовых запросов пользователей на русском языке (роль User; ACL). Поддержать свободный текст и опциональные фильтры: projectId, dateRange, docTypes. Выполнять безопасную нормализацию (sanitize), ограничение длины запроса и базовую проверку запрещённых конструкций. Возвращать requestId для трассировки.  
 
   Пресеты фильтров (разворачиваются в явные фильтры и фиксируются в квитанции запроса):
   - currentProject (текущий проект пользователя), myProjects (проекты по ACL), last7d/last30d (диапазоны дат), types:{pdf_mr,pdf_scan,dwg,arp,gsfx,xml,xls,docx_normative}; поддержать custom date range.
   Рекомендации по вводу и безопасности: sanitize (trim/collapse spaces/remove control chars), длина запроса ≤ 2000 символов (иначе 400), единый справочник docTypes с алиасами, хранить presetsUsed в аудите; значения пресетов определяются на сервере.
   Acceptance:
   - Пресеты фильтров поддержаны и корректно конвертируются в projectId/dateRange/docTypes; `presetsUsed` включён в квитанцию.
   - Квитанция запроса содержит: requestId, timestamp, userId, projectId, normalizedQuery, filters, presetsUsed; ACL нарушающие проекты отклоняются (403).
   - Логи содержат requestId (FR-LOG-01), все параметры запроса; нормализация и ограничения длины выполнены; запрещённые конструкции отфильтрованы.
- FR-QUERY-02: Понимание контекста запроса.
  Контекст: NLU для проектных запросов.
  Основные возможности:
  - Парсит сущности проекта/типа документа/операции.
  - Связывает запрос с артефактами и пресетами задач.
  - Обогащает запрос словарём синонимов/терминов.
  Acceptance:
  - Контрольные запросы маппятся на корректный project/operation; точность ≥ 0.9.
  - Артефакт parseResult сохраняет сущности и confidence.
  - Связи с пресетами задач формируются и логируются.
  Контекст: NLU для проектных запросов.
  Основные возможности:
  - Парсит сущности проекта/типа документа/операции.
  - Связывает запрос с артефактами и пресетами задач.
  - Обогащает запрос словарём синонимов/терминов.
  Acceptance:
  - Контрольные запросы маппятся на корректный project/operation; точность ≥ 0.9.
  - Артефакт parseResult сохраняет сущности и confidence.
  - Связи с пресетами задач формируются и логируются.  
  Источники контекста: текущий проект/пресеты (FR-QUERY-01), проектные словари и синонимы (FR-KNOW-01), стоп-слова проекта, метаданные документов (FR-DAT-02), типы документов и артефактов. Система интерпретирует нормализованный текст запроса и применяет контекст для уточнения фильтров/существенных параметров. Извлекаемые сущности (минимум для POC): `rdCipher`, `documentType[]`, `tableType/specKind`, `dateRange`; опционально `normCode` (ГОСТ/СП код). Требуется объяснимость: формируется краткий trace интерпретации (из текста → сущности/фильтры/пресеты), сохраняемый для аудита/отладки.
  Acceptance:
  - Использованы источники контекста (project context, dictionaries/synonyms/stop-words, metadata) при интерпретации запроса.
  - Корректно извлекаются сущности: rdCipher, documentType(s), tableType/specKind, dateRange; при наличии — normCode.
  - Сформирован и сохранён trace интерпретации: входной текст → нормализованный → выявленные сущности → применённые пресеты/фильтры; trace доступен в логах/аудите и связан с requestId.
  - Ошибки неоднозначности подсвечиваются (Warning) с указанием конфликтующих интерпретаций; допускается запрос уточнения у пользователя.
- FR-QUERY-03: Поиск в базе знаний.
  Контекст: Ретривинг артефактов под запрос.
  Основные возможности:
  - Выполняет поиск по text/tables/metadata в контексте проекта.
  - Отбирает артефакты с scores/trace; поддерживает фильтры.
  - Готовит агрегаты и ссылки на источники.
  Acceptance:
  - Контрольные запросы возвращают релевантные артефакты со score/confidence.
  - Поиск учитывает projectId/ACL; несоответствия блокируются и логируются.
  - Результаты содержат trace до исходных документов/страниц.
  Контекст: Ретривинг артефактов под запрос.
  Основные возможности:
  - Выполняет поиск по text/tables/metadata в контексте проекта.
  - Отбирает артефакты с scores/trace; поддерживает фильтры.
  - Готовит агрегаты и ссылки на источники.
  Acceptance:
  - Контрольные запросы возвращают релевантные артефакты со score/confidence.
  - Поиск учитывает projectId/ACL; несоответствия блокируются и логируются.
  - Результаты содержат trace до исходных документов/страниц.  
   Порядок выполнения: сначала применяются точные фильтры (projectId, documentType, dateRange, rdCipher и др.), затем выполняется семантический поиск/ранжирование по контенту и артефактам. Возвращается topK результатов (по умолчанию 20) с поддержкой пагинации (offset/limit). Поддержать кэширование короткого TTL по ключу (normalizedQuery+filters) с привязкой к requestId.
   Поля результата (кандидата): documentId, projectId, docType, path, score, snippet (highlight), artifactRefs (titleBlock/tables/estimate/...).
   Acceptance:
   - Корректно комбинируются фильтры и семантическое ранжирование; возвращается стабильный список topK.
   - Реализована пагинация (offset/limit) и кэш по normalizedQuery+filters (short TTL); связь с requestId сохранена в логах.
   - Каждый кандидат содержит обязательные поля id/projectId/docType/path/score/snippet и ссылки на артефакты; отсутствующие артефакты не ломают выдачу.
- FR-QUERY-04: Формирование ответа.
  Контекст: Сборка ответа в Excel/JSON/CSV.
  Основные возможности:
  - Собирает items/aggregates, формирует мета (requestId/projectId/filters/responseType).
  - Генерирует Excel по шаблону подразделения или JSON/CSV.
  - Включает warnings и рекомендации следующих задач.
  Acceptance:
  - Контрольные ответы формируются ≤ 30 сек; структура соответствует шаблону/схеме.
  - Все ссылки на артефакты и trace включены; обязательные поля заполнены.
  - Excel/JSON/CSV проходят валидацию (FR-EXCEL/FR-EXCEL-TPL/JSON schema).
  Контекст: Сборка ответа в Excel/JSON/CSV.
  Основные возможности:
  - Собирает items/aggregates, формирует мета (requestId/projectId/filters/responseType).
  - Генерирует Excel по шаблону подразделения или JSON/CSV.
  - Включает warnings и рекомендации следующих задач.
  Acceptance:
  - Контрольные ответы формируются ≤ 30 сек; структура соответствует шаблону/схеме.
  - Все ссылки на артефакты и trace включены; обязательные поля заполнены.
  - Excel/JSON/CSV проходят валидацию (FR-EXCEL/FR-EXCEL-TPL/JSON schema).
   Типы ответов: `list`, `detail`, `aggregate`; поддержать генерацию Excel по флагу/шаблону подразделения (см. FR-EXCEL-01..07, FR-EXCEL-TPL-01..04). Структура JSON ответа: `meta` (requestId, projectId, filters, responseType), `items[]` (id, fields, artifactRefs, score/trace), `aggregates` (по проекту/типам), `warnings`. При формировании ответа система также предлагает релевантные прикладные задачи (на основе типа запроса и найденных артефактов), которые можно запустить сразу из интерфейса (связь с пресетами задач из FR-LEARN-01).
   Acceptance:
   - Ответ соответствует типу (list/detail/aggregate), включает `meta/items/aggregates/trace`, ссылки на артефакты и предупреждения при неоднозначности.
   - По флагу формируется XLSX по активному шаблону; валидация шаблона (FR-EXCEL-TPL-02..04) проходит без ошибок.
   - Предложение прикладных задач отображается и включает быстрый запуск подходящих задач (штамп/таблицы/Estimate/выжимки), согласовано с проектным ACL.

Связанные UC: UC-02, UC-12

#### 3.3.3 Проектно-ориентированная работа
- FR-PROJECT-01: Привязка данных к проектам.
  Контекст: Базовая модель projectId/projectName/designStage/rdCipher.
  Основные возможности:
  - Хранит проектные метаданные и связывает артефакты.
  - Обеспечивает ACL по проектам для Teacher/User.
  - Автозаполняет project context в артефактах.
  Acceptance:
  - Все загруженные/извлечённые данные имеют projectId/rdCipher; валидатор блокирует без них.
  - ACL применён для операций; нарушения логируются.
  - Артефакты содержат метаданные проекта по схеме.
  Контекст: Базовая модель projectId/projectName/designStage/rdCipher.
  Основные возможности:
  - Хранит проектные метаданные и связывает артефакты.
  - Обеспечивает ACL по проектам для Teacher/User.
  - Автозаполняет project context в артефактах.
  Acceptance:
  - Все загруженные/извлечённые данные имеют projectId/rdCipher; валидатор блокирует без них.
  - ACL применён для операций; нарушения логируются.
  - Артефакты содержат метаданные проекта по схеме.  
 - FR-PROJECT-01: Привязка данных к проектам.
  Контекст: Базовая модель projectId/projectName/designStage/rdCipher.
  Основные возможности:
  - Хранит проектные метаданные и связывает артефакты.
  - Обеспечивает ACL по проектам для Teacher/User.
  - Автозаполняет project context в артефактах.
  Acceptance:
  - Все загруженные/извлечённые данные имеют projectId/rdCipher; валидатор блокирует без них.
  - ACL применён для операций; нарушения логируются.
  - Артефакты содержат метаданные проекта по схеме.
  Контекст: Базовая модель projectId/projectName/designStage/rdCipher.
  Основные возможности:
  - Хранит проектные метаданные и связывает артефакты.
  - Обеспечивает ACL по проектам для Teacher/User.
  - Автозаполняет project context в артефактах.
  Acceptance:
  - Все загруженные/извлечённые данные имеют projectId/rdCipher; валидатор блокирует без них.
  - ACL применён для операций; нарушения логируются.
  - Артефакты содержат метаданные проекта по схеме.  
   Обязательные атрибуты проекта: `projectId`, `projectName`, `designStage`, `rdCipher`. Ввести таксономию типов проектов и тегов (например, `projectType` и `projectTags[]`: подстанция, козырёк, металлоконструкции, АР/КМ и т.п.) для поиска смежных/похожих реализованных проектов. Все артефакты и версии знаний маркируются `projectId` и (где уместно) `projectType/tags`. Операции без `projectId` отклоняются (400). На всех операциях — проверка ACL проекта. 
   Расширение на основе живых юз кейсов: привязка ценовой информации к проектам для бюджетирования и унификации спецификаций. Ценовые данные включают: цены материалов и оборудования по позициям спецификации, договоры поставщиков с ценовыми условиями, историю ценовых изменений по проектам, интеграцию с внешними источниками ценовой информации. Структура ценовых данных: `priceId`, `projectId`, `itemCode`, `itemName`, `unitPrice`, `currency`, `supplierId`, `contractId`, `priceDate`, `validityPeriod`, `priceSource` (manual/contract/external). Интеграция с бюджетированием: автоматическое использование актуальных цен при формировании финансовых отчетов, валидация ценовых данных против договоров поставщиков, уведомления об изменении ценовых условий. 
   Acceptance:
   - Для всех операций чтения/записи требуется валидный `projectId`; артефакты/знания сохраняются с `projectId` и (при наличии) `projectType/tags`.
   - Имеется справочник типов/тегов проектов; эти метки доступны для фильтрации и используются в поиске аналогов (см. FR-QUERY-03).
   - ACL проекта применяется ко всем CRUD-операциям; нарушения отклоняются (403).
   - Ценовая информация привязывается к проектам: цены материалов/оборудования, договоры поставщиков, история ценовых изменений.
   - Структура ценовых данных включает все обязательные поля: priceId, projectId, itemCode, itemName, unitPrice, currency, supplierId, contractId, priceDate, validityPeriod, priceSource.
   - Интеграция с бюджетированием работает: актуальные цены используются автоматически, валидация против договоров, уведомления об изменениях.
- FR-PROJECT-02: Поиск аналогов по проектам.
  Контекст: Сравнение проектов по типу/стадии/материалам.
  Основные возможности:
  - Индексирует проекты с признаками для сходства.
  - Выполняет поиск аналогов и возвращает артефакты/метаданные.
  - Учитывает ACL и релевантность для пользователя.
  Acceptance:
  - Контрольные запросы возвращают аналоги с признаками сходства; ACL соблюдён.
  - Ранжирование и признаки сходства фиксируются в аналоговом отчёте.
  - Результаты пригодны для запуска прикладных задач (Excel/Estimate).
  Контекст: Сравнение проектов по типу/стадии/материалам.
  Основные возможности:
  - Индексирует проекты с признаками для сходства.
  - Выполняет поиск аналогов и возвращает артефакты/метаданные.
  - Учитывает ACL и релевантность для пользователя.
  Acceptance:
  - Контрольные запросы возвращают аналоги с признаками сходства; ACL соблюдён.
  - Ранжирование и признаки сходства фиксируются в аналоговом отчёте.
  - Результаты пригодны для запуска прикладных задач (Excel/Estimate).  
   Критерии поиска: `projectType`, `projectTags[]`, `rdCipher` (частичное совпадение), `designStage`, семантическое сходство документов по артефактам (titleBlock, tables, estimate). Алгоритм: комбинированный поиск по метаданным проектов + семантический анализ содержимого документов. Ранжирование по весовой сумме: точное совпадение projectType (0.4), пересечение projectTags (0.3), схожесть rdCipher (0.2), семантическое сходство контента (0.1). Результаты: topK проектов с полями `projectId`, `projectName`, `projectType`, `matchingTags[]`, `similarityScore`, `rdCipher`, `designStage`, `artifactMatches` (какие артефакты схожи), `lastModified`. Поддержать фильтры по дате создания/модификации проектов.
   Acceptance:
   - Поиск работает по всем критериям: projectType/tags, rdCipher, designStage, семантическое сходство артефактов.
   - Ранжирование корректно: точные совпадения получают высокие веса, семантические — дополняют оценку.
   - Результаты содержат все обязательные поля; `similarityScore` в диапазоне [0,1]; `artifactMatches` указывает конкретные схожие элементы.
   - Фильтры по датам работают; результаты ограничены topK с пагинацией; ACL проектов соблюдается.  
- FR-PROJECT-03: Извлечение данных в проектном контексте.
  Контекст: Работа с артефактами внутри выбранного проекта.
  Основные возможности:
  - Извлекает titleBlock/tables/estimate, связывает с projectId.
  - Поддерживает фильтры по документам/типам/датам.
  - Возвращает артефакты с trace и метаданными проекта.
  Acceptance:
  - Извлечённые артефакты содержат projectId/rdCipher; фильтры применены корректно.
  - Trace к исходникам сохранён; ACL проверен.
  - Артефакты валидируются схемами и готовы к прототипам/ответам.
  Контекст: Работа с артефактами внутри выбранного проекта.
  Основные возможности:
  - Извлекает titleBlock/tables/estimate, связывает с projectId.
  - Поддерживает фильтры по документам/типам/датам.
  - Возвращает артефакты с trace и метаданными проекта.
  Acceptance:
  - Извлечённые артефакты содержат projectId/rdCipher; фильтры применены корректно.
  - Trace к исходникам сохранён; ACL проверен.
  - Артефакты валидируются схемами и готовы к прототипам/ответам.  
   Типы извлекаемых данных: штампы документов (titleBlock), таблицы спецификаций (материалы/оборудование/работы), сметы (Estimate), нормативные ссылки (ГОСТ/СП), формулы и расчеты. Проектное окружение влияет на извлечение через: проектные словари и синонимы (FR-KNOW-01), специфичные шаблоны документов, историю проекта (предыдущие версии, аналоги), стандарты проекта (единицы измерения, форматы полей). Алгоритм: базовое извлечение + применение проектного контекста + валидация против проектных стандартов + обогащение данными из истории проекта. Результат: структурированные данные с метаданными `projectId`, `extractionConfidence`, `sourceDocument`, `validationStatus`, `projectContextApplied` (какие правила/словари использованы), `historicalMatches` (ссылки на похожие данные из истории проекта).
   Acceptance:
   - Извлечение работает для всех типов данных: titleBlock, tables, estimate, normativeLinks, formulas.
   - Проектный контекст применяется: используются словари/синонимы проекта, шаблоны, история проекта.
   - Валидация против проектных стандартов выполняется; результаты содержат validationStatus и рекомендации.
   - Результаты содержат все метаданные: projectId, confidence, source, validationStatus, appliedContext, historicalMatches.
   - ACL проекта соблюдается; извлечение ограничено документами проекта; аудит операций ведется.  
- FR-PROJECT-04: Формирование проектных отчётов.
  Контекст: Сборка отчётов по проекту (РД/сводки/бюджеты).
  Основные возможности:
  - Собирает артефакты проекта и формирует отчёт по шаблону.
  - Включает ссылки на источники и метаданные проекта.
  - Поддерживает Excel/JSON/CSV и печать.
  Acceptance:
  - Контрольный отчёт создаётся ≤ 30 сек; структура соответствует шаблону/схеме.
  - Все ссылки/trace на источники присутствуют; обязательные поля заполнены.
  - Отчёт проходит валидацию (FR-EXCEL/FR-EXCEL-TPL/JSON schema) и готов к выдаче.
  Контекст: Сборка отчётов по проекту (РД/сводки/бюджеты).
  Основные возможности:
  - Собирает артефакты проекта и формирует отчёт по шаблону.
  - Включает ссылки на источники и метаданные проекта.
  - Поддерживает Excel/JSON/CSV и печать.
  Acceptance:
  - Контрольный отчёт создаётся ≤ 30 сек; структура соответствует шаблону/схеме.
  - Все ссылки/trace на источники присутствуют; обязательные поля заполнены.
  - Отчёт проходит валидацию (FR-EXCEL/FR-EXCEL-TPL/JSON schema) и готов к выдаче.  
   Типы отчетов: сводные отчеты по РД (сводка всех рабочих документов проекта), детальные отчеты по разделам (СО РД, КП, расчеты), сравнительные отчеты с аналогами, отчеты по бюджету/смете. Структура отчета: заголовок с проектной информацией (projectName, rdCipher, designStage), таблицы с извлеченными данными (наименования, шифры, технические характеристики, единицы измерения, количества, цены, стоимости), итоговые суммы и агрегаты, ссылки на исходные документы. Форматы: Excel (многолистовые книги с формулами и форматированием), PDF (для печати), JSON (для API). Источники данных: извлеченные titleBlock, tables, estimate из документов проекта (FR-PROJECT-03), метаданные проекта (FR-PROJECT-01), данные аналогов (FR-PROJECT-02). Автозаполнение: шапка отчета из projectName/rdCipher/designStage, формулы расчета итогов, ссылки между листами.
   Acceptance:
   - Формируются все типы отчетов: сводные, детальные, сравнительные, бюджетные.
   - Структура отчета включает заголовок проекта, таблицы данных, итоги, ссылки на источники.
   - Поддерживаются форматы Excel (с формулами), PDF, JSON; многолистовые книги корректно работают.
   - Данные берутся из извлеченных артефактов проекта; автозаполнение шапки и формул работает.
   - ACL проекта соблюдается; отчеты ограничены документами проекта; аудит генерации ведется.  
- FR-PROJECT-05: Управление жизненным циклом проекта.  
   Операции жизненного цикла: создание проекта (инициализация с projectId, projectName, designStage, rdCipher, projectType, projectTags[]), переходы между стадиями проектирования (П, Р, РД, РП, РУ), закрытие проекта (перевод в статус Completed/Archived), архивирование завершенных проектов (перемещение в архивное хранилище с сохранением доступа по ACL). Статусы проекта: Draft, InProgress, Review, Completed, Archived. Переходы между стадиями: валидация готовности документов текущей стадии, обновление designStage, уведомления заинтересованных сторон, создание snapshot состояния проекта. Архивирование: сжатие данных, создание архива, обновление ACL для архивного доступа, удаление из активного поиска (опционально).
   Acceptance:
   - Создание проекта работает с обязательными атрибутами; валидация уникальности projectId/rdCipher.
   - Переходы между стадиями выполняются с проверкой готовности документов; обновляется designStage и статус.
   - Закрытие проекта корректно переводит в Completed/Archived; ACL сохраняется для исторического доступа.
   - Архивирование работает без потери данных; архивные проекты доступны по ACL; поиск настраивается.
   - Аудит всех операций жизненного цикла ведется; уведомления отправляются заинтересованным сторонам.
- FR-PROJECT-06: Сравнительный анализ проектов.  
   Функциональность: детальное сравнение двух или более проектов по заданным критериям, выявление различий и сходств, формирование сравнительных таблиц и отчетов. Критерии сравнения: метаданные проектов (projectType, designStage, rdCipher), извлеченные данные (titleBlock, tables, estimate), нормативные ссылки, технические характеристики. Алгоритм: парное сравнение по критериям, вычисление метрик сходства/различия, группировка результатов по типам данных, ранжирование по значимости различий. Результаты: сравнительная таблица с полями ProjectA/ProjectB, Criterion, ValueA/ValueB, Difference, SimilarityScore, Significance, детальный отчет с рекомендациями по унификации/стандартизации, визуализация различий (диаграммы, графики).
   Acceptance:
   - Сравнение работает для 2+ проектов по всем критериям: метаданные, извлеченные данные, нормативы.
   - Алгоритм корректно вычисляет метрики сходства/различия; результаты ранжируются по значимости.
   - Сравнительные таблицы содержат все обязательные поля; отчеты включают рекомендации.
   - Визуализация различий работает; поддерживаются диаграммы и графики; экспорт в Excel/PDF.
   - ACL проектов соблюдается; сравнение ограничено доступными проектами; аудит операций ведется.
- FR-PROJECT-07: Шаблоны проектов.  
   Функциональность: создание шаблонов на основе типовых проектов, применение шаблонов к новым проектам, управление библиотекой шаблонов. Создание шаблона: выбор базового проекта, извлечение типовых элементов (projectType, projectTags[], структуры документов, стандартные таблицы, нормативные ссылки), генерация шаблона с параметризацией (заменяемые поля, переменные), сохранение в библиотеке шаблонов. Применение шаблона: выбор шаблона, заполнение параметров (projectName, rdCipher, специфичные значения), генерация нового проекта на основе шаблона, валидация корректности применения. Управление библиотекой: категоризация шаблонов по projectType, версионирование шаблонов, права доступа к шаблонам, поиск и фильтрация шаблонов.
   Acceptance:
   - Создание шаблона работает: извлечение типовых элементов, параметризация, сохранение в библиотеке.
   - Применение шаблона корректно: заполнение параметров, генерация проекта, валидация результата.
   - Библиотека шаблонов поддерживает категоризацию, версионирование, поиск, фильтрацию.
   - ACL шаблонов работает; применение ограничено доступными шаблонами; аудит операций ведется.
   - Шаблоны совместимы с FR-PROJECT-01..06; интеграция с жизненным циклом и анализом проектов.

Связанные UC: UC-03, UC-13

#### 3.3.4 Извлечение данных из документов (OCR)
- FR-OCR-01A: Машиночитаемые PDF без OCR.
  Контекст: Парсинг текстового слоя и структуры PDF.
  Основные возможности:
  - Извлекает текст, таблицы, изображения, метаданные с координатами.
  - Сохраняет структуру таблиц (строки/столбцы/объединения).
  - Формирует text.json, tables.json, metadata.json для дальнейшей обработки.
  Acceptance:
  - Контрольный PDF обрабатывается ≤ 30 сек; текст/таблицы извлекаются без потери структуры.
  - Метаданные документа заполнены полностью; ссылки на изображения сохранены.
  - Артефакты соответствуют схеме FR-OCR-04 и пригодны для обучения.
- FR-OCR-01B: OCR сканированных PDF.
  Контекст: Пайплайн распознавания многостраничных сканов.
  Основные возможности:
  - Конвертирует страницы в изображения ≥300 DPI и выполняет deskew/denoise.
  - Распознает русский текст, таблицы и сохраняет координаты элементов.
  - Формирует метрики качества для последующей валидации.
  Acceptance:
  - CER ≤ 5% и WER ≤ 10% на контрольном наборе из 20 страниц.
  - Каждая страница проходит предобработку и фиксируется в processing.log с временем шага.
  - Результат содержит text.json и tables.json с координатами, время ≤ 30 сек/страницу.
  Связи: FR-OCR-01A, FR-TABLE-01, FR-LOG-01, FR-LOG-02.
- FR-OCR-01C: OCR изображений (JPG/PNG/TIFF/BMP).
  Контекст: Распознавание изображений с предобработкой.
  Основные возможности:
  - Deskew/denoise/binarize, коррекция ориентации и перспективы.
  - Распознаёт русский текст, таблицы, печати/штампы; опционально рукописный текст.
  - Сохраняет координаты элементов и метрики качества.
  Acceptance:
  - Поддержаны JPG/PNG/TIFF/BMP; обработка ≤ 30 сек на изображение.
  - CER ≤ 5%, WER ≤ 10% на контрольном наборе; таблицы/штампы локализуются корректно.
  - text.json/tables.json содержат координаты; метрики качества записаны в processing.log.
- FR-OCR-02: Улучшенная обработка сложных сканов.
  Контекст: Дополнительный модуль для низкого качества, штампов и рукописей.
  Основные возможности:
  - Повышает читаемость страниц через супер-разрешение и адаптивную фильтрацию.
  - Детектирует печати/штампы и извлекает текст с координатами.
  - Распознает рукописные элементы и классифицирует тип контента.
  Acceptance:
  - Метрики PSNR/SSIM улучшаются ≥ 20% относительно исходника на контрольном наборе.
  - Штампы локализуются с точностью ≥ 95% и заносятся в ocrArtifacts.json с координатами.
  - Рукописные элементы распознаются с точностью ≥ 85% и получают confidence ≥ 0.7.
  Связи: FR-OCR-01B, FR-STAMP-01..03, FR-LOG-02, FR-DAT-02.
- FR-OCR-03: Поддержка русского языка.
  Контекст: Русский язык во всех OCR пайплайнах.
  Основные возможности:
  - Языковые модели с кириллицей и техтерминами ГОСТ/СП/СНиП.
  - Словари и контекстная коррекция типовых OCR ошибок.
  - Поддержка русских дат, чисел и единиц измерения.
  Acceptance:
  - CER ≤ 3%, WER ≤ 8% на контрольном наборе; метаданные качества сохранены.
  - Техтермины распознаются корректно; форматирование дат/чисел соответствует стандарту.
  - Включение русского языка не увеличивает общее время обработки (≤ 30 сек/док).
- FR-OCR-04: Структурирование результатов OCR.
  Контекст: Преобразование текст/таблиц/метаданных в единый JSON для обучения.
  Основные возможности:
  - Формирует text/tables/metadata/coordinates/confidence/documentStructure.
  - Сохраняет иерархию документа, типы контента и координаты элементов.
  - Совместимость с FR-LEARN-02 и проектным контекстом FR-PROJECT-03.
  Acceptance:
  - Контрольный документ структурируется ≤ 30 сек; иерархия/координаты сохранены.
  - Таблицы преобразованы в JSON/CSV без потери merged ячеек; confidence включён.
  - Выходные артефакты соответствуют схемам базы знаний и пригодны для обучения.
- FR-OCR-05: Парсинг штампов PDF/DWG.
  Контекст: Извлечение titleBlock из PDF (mc/scan) и DWG.
  Основные возможности:
  - Детектирует область штампа, распознаёт поля title/cipher/sheetNumber/documentName/sheetFormat/designStage/organization/documentDate/revisionNumber.
  - Применяет шаблоны проекта и валидацию форматов; сохраняет координаты и confidence.
  - Готовит артефакт titleBlock.json для FR-STAMP-01..03.
  Acceptance:
  - Контрольные PDF/DWG обрабатываются ≤ 30 сек; все поля извлечены с координатами/confidence.
  - Шаблон/формат валидируется, ошибки помечены; артефакт совместим с FR-STAMP-*.
  - Логи содержат время шагов и метрики качества для каждой страницы/листа.
- FR-OCR-06: Ветвление пайплайна PDF по типу.
  Контекст: Автоопределение mc_pdf/scan_pdf/mixed_pdf и выбор пайплайна.
  Основные возможности:
  - Определяет наличие текстового слоя, качество изображений и смешанный тип.
  - Маршрутизирует: mc → FR-OCR-01A; scan → FR-OCR-01B; mixed → комбинированный.
  - Фиксирует выбор и параметры предобработки (deskew/denoise/binarize) в логе.
  Acceptance:
  - Тип PDF определяется корректно на контрольном наборе; ветка выбранного пайплайна отражена в логе.
  - Время классификации ≤ 3 сек на документ; предобработка запускается только для сканов/mixed.
  - Артефакт routeDecision.json содержит тип, уверенность, выбранный пайплайн и параметры.
#### 3.3.11 Табличные данные и формулы (PDF/DWG)
#### 3.3.11 Табличные данные и формулы (PDF/DWG)
- FR-TABLE-01: Извлечение табличных спецификаций с ценами.
  Контекст: Модуль обработки таблиц PDF и DWG документов.
  Основные возможности:
  - Находит табличные области материалов, оборудования и работ.
  - Парсит строки с единицами, количествами и ценами.
  - Возвращает координаты таблиц и метрики качества распознавания.
  Обучаемость и знания: Накопление шаблонов структур таблиц и источников цен по проектам.
  Acceptance:
  - Таблицы в эталонных PDF и DWG извлекаются с полнотой ≥ 0.95.
  - Ценовые поля (price, amount, currency, source, date) заполнены в ≥ 0.9 записей.
  - Результат сохраняется в JSON/CSV с координатами и confidence ≥ 0.8.
  Связи: BR-015, UC-22, FR-TABLE-02, FR-TABLE-03, FR-LOG-02, FR-KNOW-01.
- FR-TABLE-02: Сохранение структуры таблиц при извлечении данных.
  Контекст: Постобработка табличного OCR из PDF и DWG.
  Основные возможности:
  - Восстанавливает merged ячейки, уровни заголовков и порядок колонок.
  - Проставляет типы данных и пометки итоговых строк с методом расчета.
  - Экспортирует структуру в tables.json и позволяет реконструировать XLSX.
  Acceptance:
  - Контрольная таблица сохраняет 100% объединений и иерархии в tables.json.
  - Итоговые строки содержат formulaType и ссылку на исходные ячейки.
  - serializeToXlsx воспроизводит структуру без потерь на тестовом файле.
  Связи: FR-TABLE-01, FR-FORMULA-01, FR-EXCEL-06, FR-LOG-02.
- FR-TABLE-03: Валидация обязательных полей таблиц.
  Контекст: Контроль полноты данных для материалов, оборудования и работ.
  Основные возможности:
  - Проверяет наличие ключевых столбцов по типу таблицы.
  - Валидирует типы данных, диапазоны значений и соответствие справочникам.
  - Формирует отчет с уровнем критичности и рекомендациями по исправлению.
  Acceptance:
  - Эталонный набор выявляет все пропущенные поля (recall = 1.0) и пометкиваются как Critical.
  - report.json содержит колонку, строку, уровень и suggestedFix для каждого нарушения.
  - Используемый справочник единиц загружается из FR-KNOW-01; версия справочника логируется.
  Связи: FR-TABLE-01, FR-TABLE-02, FR-KNOW-01, FR-LOG-02, FR-EXCEL-TPL-03.
- FR-TABLE-04: Валидация согласованности итогов.
  Контекст: Сопоставление расчетов и извлеченных итогов спецификаций.
  Основные возможности:
  - Пересчитывает суммы по строкам и разделам и сравнивает с исходными значениями.
  - Классифицирует расхождения по типу и критичности и предлагает исправления.
  - Сохраняет результаты в formulaValidation.json для обучения.
  Acceptance:
  - Расхождения > 1% обнаруживаются с точностью ≥ 95% на контрольном наборе.
  - Отчет содержит ссылку на лист, ячейку, тип ошибки и предложенный fix.
  - Данные синхронизируются с FR-FORMULA-02 и логируются с projectId/requestId.
  Связи: FR-TABLE-01, FR-FORMULA-01, FR-FORMULA-02, FR-LOG-02, FR-LEARN-03.
- FR-FORMULA-01: Детектирование и проверка формул в проектных таблицах.
  Контекст: Модуль табличного анализа PDF, DWG и Excel спецификаций и смет.
  Основные возможности:
  - Детектирует формулы в спецификациях, сметах и отчетах.
  - Валидирует синтаксис, ссылки и числовой результат.
  - Логирует источник фрагмента и метаданные формулы.
  Обучаемость и знания: Накопление шаблонов и правил проверки формул по типам проектов.
  Acceptance:
  - Доля найденных обязательных формул в PDF (МЧ/скан), DWG и Excel ≥ 0.95.
  - Проверка синтаксиса и ссылок завершается ≤ 5 сек на документ.
  - Артефакт formulas.json содержит тип, входы, результат и confidence ≥ 0.8.
  Связи: BR-015, UC-24, FR-TABLE-01, FR-LOG-02, FR-KNOW-01, FR-LEARN-03.

- FR-FORMULA-02: Отчет о расхождениях расчетов и итогов.
  Контекст: Модуль сверки формул FR-FORMULA-01 с таблицами FR-TABLE-01..04.
  Основные возможности:
  - Сравнивает пересчитанные итоги с извлеченными значениями.
  - Классифицирует расхождения по типам и критичности.
  - Формирует отчет с рекомендациями и ссылками на источник.
  Обучаемость и знания: Накопление правил устранения расхождений и частых ошибок проектов.
  Acceptance:
  - Расхождения выявляются с точностью ≥ 0.95 при пороге отклонения 2%.
  - Отчет содержит ссылку на формулу, ячейку и рекомендацию для 100% выявленных ошибок.
  - Результаты сохраняются в formulaValidation.json с версией и автором проверки.
  Связи: BR-015, UC-24, FR-FORMULA-01, FR-TABLE-04, FR-LOG-02, FR-KNOW-01.

Связанные UC: UC-22, UC-24, UC-26

#### 3.3.12 Сметы (Estimate) и обмен форматами
- FR-ESTIMATE-01: Унифицированная модель Estimate.
  Контекст: Единая структура смет (ARP/GSFX/XML/XLS → Estimate).
  Основные возможности:
  - Иерархия разделы → позиции → ресурсы с атрибутами name/unit/qty/unitPrice/amount.
  - Нормализация единиц и валидация qty>0, unitPrice≥0, amount=qty×unitPrice.
  - Обработка ошибок с критичностью и отчётом по полям.
  Acceptance:
  - Контрольный набор смет конвертируется в модель без потери обязательных полей.
  - Проверки qty/unitPrice/amount проходят; валидатор отмечает отклонения с критичностью.
  - Артефакты estimate.json/CSV соответствуют схеме и готовы для FR-ESTIMATE-02..06.
- FR-ESTIMATE-02: Привязка позиций Estimate к нормам с коэффициентами.
  Контекст: Полуавтоматическое сопоставление сметных позиций GESN/FER/ТСН.
  Основные возможности:
  - Предлагает до трёх подходящих норм и коэффициентов для каждой позиции.
  - Позволяет подтвердить выбор или перейти в режим ручного ввода.
  - Сохраняет выбранные нормы и применённые коэффициенты в artefact estimate.json.
  Acceptance:
  - Для контрольного Estimate система формирует предложения норм и коэффициентов ≤ 5 сек.
  - Выбранные нормы применяются к расчётам; ручной ввод фиксирует источник (`manual`).
  - Отчёт по привязке содержит позицию, normId, набор коэффициентов (базовый/сезонный/региональный) и автора выбора.
  Связи: FR-ESTIMATE-01, FR-TABLE-01, FR-KNOW-01, BR-016.
- FR-ESTIMATE-03: Валидация итогов и обязательных полей Estimate.
  Контекст: Сверка сметной структуры с эталонным шаблоном проекта.
  Основные возможности:
  - Пересчитывает разделы и общие итоги, сравнивая с эталонными значениями.
  - Проверяет обязательные поля, единицы измерения и диапазоны по шаблону.
  - Генерирует отчёт с уровнями критичности и рекомендациями по исправлению.
  Acceptance:
  - Контрольная смета проверяется ≤ 5 сек; расхождения > 1% получают статус Critical.
  - validationReport.json содержит раздел, показатель, отклонение, уровень и совет.
  - Пользовательские настройки критичности сохраняются и применяются при повторных проверках.
  Связи: FR-ESTIMATE-01, FR-ESTIMATE-02, FR-TABLE-03, FR-LOG-02, BR-016.
- FR-ESTIMATE-04: Round-trip обмен сметными форматами.
  Контекст: Импорт/экспорт ARP, GSFX, XML, XLS через модель Estimate.
  Основные возможности:
  - Импортирует исходные файлы, преобразует в структуру Estimate и сохраняет формулы.
  - Экспортирует обратно в исходный формат без потери структуры и расчётов.
  - Формирует предупреждения о частично поддержанных элементах в exportReport.json.
  Acceptance:
  - Контрольный набор ARP/GSFX/XML/XLS проходит round-trip с расхождением ≈ 0.
  - Несопоставимые элементы отражаются в отчёте Warning, остальные выгружаются корректно.
  - Экспорт завершается ≤ 10 сек для файла 5 МБ; отчёт логируется в artefact exchange/.
  Связи: FR-ESTIMATE-01, FR-ESTIMATE-02, FR-TABLE-02, FR-TABLE-04, BR-016.
- FR-ESTIMATE-05: Перенос и верификация формул при импорте.
  Контекст: Импорт смет ARP/GSFX/XML/XLS с сохранением формул.
  Основные возможности:
  - Переносит формулы и ссылки исходного файла в структуру Estimate.
  - Проверяет синтаксис и актуальность ссылок; выявленные ошибки маркирует как Broken.
  - Требует ручной корректировки для формул со статусом Broken и логирует действия.
  Acceptance:
  - Контрольный файл импортируется ≤ 5 сек; корректные формулы применяются без изменений.
  - Нарушенные ссылки фиксируются в formulasReport.json со статусом Broken и рекомендацией.
  - После ручной правки статус обновляется; история изменений сохраняется в audit log.
  Связи: FR-ESTIMATE-01, FR-ESTIMATE-04, FR-FORMULA-01, FR-LOG-02.
- FR-ESTIMATE-06: Привязка Estimate к шифру РД и проекту.
  Контекст: Связь сметной модели с проектным контекстом.
  Основные возможности:
  - Наследует `projectId` и `rdCipher` из выбранного проекта; расхождения блокируются.
  - Проверяет, что все позиции и разделы используют актуальные данные проекта (валюта, нормы, сроки).
  - Помечает внешние ссылки как External и требует ручного согласования.
  Acceptance:
  - Создание/импорт сметы без валидного `projectId/rdCipher` отклоняется (HTTP 400).
  - auditReport содержит список External элементов с указанием источника и статуса согласования.
  - После подтверждения External-связей они привязываются к проекту или отклоняются с причиной.
  Связи: FR-PROJECT-01, FR-ESTIMATE-01, FR-ESTIMATE-02, FR-LOG-02, BR-016.

Связанные UC: UC-27..UC-32, UC-35

#### 3.3.8 Управление доступом и ролевая модель
- FR-ACCESS-01: Ролевое управление доступом (Teacher/User + расширения).
  Контекст: Управление привилегиями для обучения и прикладных задач.
  Основные возможности:
  - Определяет базовые роли: Teacher (обучение, загрузка, создание задач) и User (запросы, запуск задач).
  - Позволяет выдавать User дополнительное право загрузки/запуска по конкретным проектам.
  - Ведёт аудит всех изменений ролей и привилегий с указанием инициатора.
  Acceptance:
  - ACL-матрица фиксирует операции Teacher/User; отклонения без явного разрешения блокируются.
  - Дополнительные привилегии показываются в userPermissions.json с проектом и сроком действия.
  - Все операции изменения ролей логируются в audit log с временем, автором и старым/новым значением.
  Связи: BR-003, BR-005, FR-ACCESS-02..05, FR-LOG-02, FR-PROJECT-01.
- FR-ACCESS-02: Контроль доступа Teacher к обучению и загрузкам.
  Контекст: Настройка привилегий для запуска пайплайнов и загрузки документов.
  Основные возможности:
  - Teacher запускает обучение только по проектам, к которым имеет доступ.
  - Перед стартом обучения требуется подтверждение администратора (approval workflow).
  - Teacher и уполномоченный User могут загружать файлы; права проверяются на уровне проекта.
  Acceptance:
  - Попытка запуска обучения без project access завершается 403 и записывается в audit log.
  - Запрос на обучение создаёт approvalRecord с projectId, initiator, status (pending/approved/rejected).
  - Операции загрузки фиксируются с userId, role, projectId; нарушения привилегий блокируются.
  Связи: BR-003, BR-005, FR-ACCESS-01, FR-LEARN-01..04, FR-LOG-02, FR-PROJECT-01.
- FR-ACCESS-03: Контроль запросов пользователей по проектам.
  Контекст: Ограничение доступа User к данным и пайплайнам.
  Основные возможности:
  - User видит и запускает запросы только по проектам из своего ACL.
  - Попытки доступа к чужим проектам блокируются и фиксируются в audit log.
  - Интерфейс скрывает недоступные проекты и сценарии, показывая причину отказа.
  Acceptance:
  - Проверка ACL выполняется для 100% запросов; нарушения получают 403 и логируются.
  - userActivity.json содержит requestId, projectId, role, результат проверки.
  - UI отображает сообщение об отказе с указанием администратора для запроса доступа.
  Связи: BR-003, BR-005, FR-ACCESS-01, FR-ACCESS-02, FR-LOG-02, FR-PROJECT-01.
- FR-ACCESS-04: Аудит действий Teacher и User.
  Контекст: Отслеживание операций обучения, загрузок и запросов.
  Основные возможности:
  - Логирует каждое действие Teacher/User (userId, role, projectId, действие, результат, timestamp).
  - Хранит аудит минимум 12 месяцев с архивированием и защитой от изменений.
  - Предоставляет фильтрацию: Teacher видит только свои проекты, администратор — все записи.
  Acceptance:
  - Для контрольного периода фиксируются 100% действий; формат соответствует auditLog.json схеме.
  - Попытка изменения/удаления записи аудита блокируется и логируется как Incident.
  - UI предоставляет фильтры по проекту, роли, периоду; Teacher видит только доступные проекты.
  Связи: BR-003, BR-005, FR-ACCESS-01..03, FR-LOG-02, FR-PROJECT-01.
- FR-ACCESS-05: Ручное управление правами администратором.
  Контекст: Администрирование ролей и проектных привилегий.
  Основные возможности:
  - Назначает и отзывает роли Teacher/User, задаёт срок действия и комментарий.
  - Выдаёт точечные привилегии (загрузка, запуск задач, обучение) на уровне проекта.
  - Сохраняет журнал изменений с автором, причиной и предыдущими значениями.
  Acceptance:
  - Любое изменение прав требует указать причину; запись появляется в accessChanges.json.
  - Изменения применяются мгновенно после валидации пользователя и проекта; неуспешные операции блокируются.
  - Журнал изменений доступен для аудита и хранится ≥ 12 месяцев.
  Связи: BR-003, BR-005, FR-ACCESS-01..04, FR-LOG-02, FR-PROJECT-01.

#### 3.3.9 Управление знаниями и обновлениями
- FR-KNOW-01: Переносимый контекст обучения по проектам.
  Контекст: Словари, шаблоны и корректировки, накопленные при обучении.
  Основные возможности:
  - Хранит контекст в базе знаний по projectId с версионированием и метаданными.
  - Предоставляет API export/import для пакетов JSON с автоматической миграцией зависимостей.
  - Позволяет администратору расшарить контекст на другие проекты через подписку на обновления.
  Acceptance:
  - Контрольный пакет выгружается и импортируется без потерь; версии фиксируются в knowledgePackages.json.
  - Подписанные проекты получают обновления автоматически; журнал содержит время, проект, версию.
  - При отмене подписки контекст перестаёт обновляться, но локальная копия сохраняется.
  Связи: BR-003, BR-005, FR-LEARN-02, FR-DAT-04, FR-LOG-02, FR-ACCESS-05.
- FR-KNOW-02: Процедура миграции и отката знаний.
  Контекст: Обновление пакетов контекста при новой версии модели.
  Основные возможности:
  - Формирует контрольный список изменений (diff) между текущей и целевой версией.
  - Запускает тестовый прогон (smoke) перед применением миграции.
  - Требует ручного подтверждения администратора; создаёт rollback-пакет.
  Acceptance:
  - Миграция выполняется после успешного smoke-теста; отчёт фиксируется в migrationLog.json.
  - Rollback-пакет создаётся автоматически и позволяет восстановить прежнюю версию ≤ 5 мин.
  - Все изменения версий отражены в knowledgeVersionHistory с автором и причинами.
  Связи: FR-KNOW-01, FR-DAT-04, FR-LOG-02, FR-ACCESS-05, BR-003.
- FR-KNOW-03: Ручная проверка обновлений нормативной базы.
  Контекст: Обновление локальных каталогов ГОСТ/СП/СНиП.
  Основные возможности:
  - Администратор вручную запускает проверку указанных каталогов/архивов.
  - Система сравнивает версии документов с текущей базой и формирует diff-отчёт.
  - Предлагает обновить базу знаний и создаёт заявку на миграцию при подтверждении.
  Acceptance:
  - Проверка фиксирует результат в normsCheck.json (дата, инициатор, найденные обновления).
  - Для контрольного каталога корректно определяются новые/изменённые/удалённые документы.
  - Подтверждённые обновления передаются в процедуру миграции (FR-KNOW-02); отклонённые сохраняют причину.
  Связи: BR-007, BR-017, FR-NORMS-01..04, FR-LOG-02, FR-KNOW-02.
- FR-KNOW-04: Логирование обновлений нормативных данных.
  Контекст: Фиксация источников и результатов успешных проверок ГОСТ/СП/СНиП.
  Основные возможности:
  - Сохраняет сведения об источнике, версии, дате обновления и инициаторе для успешных обновлений.
  - Ошибки и отклонённые проверки помещаются в отдельный отчёт incidents.json.
  - Предоставляет аудиторам фильtrenый доступ к журналу успешных обновлений.
  Acceptance:
  - Для подтверждённого обновления создаётся запись в normativeUpdates.json с источником и версией.
  - Ошибки проверки фиксируются в incidents.json с причиной и статусом.
  - Аудиторы могут выгрузить журнал по фильтрам (дата, источник, инициатор); данные хранятся ≥ 12 месяцев.
  Связи: BR-007, BR-017, FR-KNOW-03, FR-LOG-02, FR-ACCESS-05.
- FR-KNOW-05: Двусторонний API для внешних корпоративных систем.
  Контекст: Интеграция накопленного знания с внешними приложениями.
  Основные возможности:
  - REST API с аутентификацией по токенам (per-project scopes, подпись запросов).
  - Предоставляет получение контента (GET /knowledge/{projectId}) и публикацию обратных комментариев/актуализаций (POST /feedback).
  - Поддерживает webhooks для уведомлений об обновлениях и обратную синхронизацию комментариев.
  Acceptance:
  - Контрольное внешнее приложение получает пакет знаний и публикует комментарии; все события появляются в integrationLog.json.
  - API отклоняет запросы без валидных токенов или прав; ошибки фиксируются с кодом и причиной.
  - Webhook уведомления доставляются с подтверждением; повторная отправка при сбое работает корректно.
  Связи: BR-003, BR-017, FR-KNOW-01, FR-KNOW-02, FR-ACCESS-05, FR-LOG-02.

### 3.4 Трассировка требований (BR ↔ UC ↔ FR)

| BR (из BRD) | UC (Use Cases) | FR (из SRS) | Примечание |
|---|---|---|---|
| BR-001 Обучение системы | UC-01, UC-11 | FR-LEARN-01..04 | Качество обучения и накопление знаний |
| BR-002 Текстовые запросы | UC-02, UC-12 | FR-QUERY-01..04 | Скорость и точность ответов |
| BR-003 Проектно-ориентированность | UC-03, UC-13 | FR-PROJECT-01..04 | Поиск аналогов и извлечение данных |
| BR-005 OCR | UC-04, UC-14 | FR-OCR-01..06; FR-TABLE-01..04; FR-STAMP-01..03 | Качество распознавания, извлечение таблиц/штампа |
| BR-006 Excel отчеты | UC-05, UC-15 | FR-EXCEL-01..07; FR-EXCEL-TPL-01..04 | Шаблоны, многолистовые книги, валидация |
| BR-007 ГОСТы | UC-06, UC-16 | FR-NORMS-01..04; FR-NORM-05..09 | Полнота, версияция, правила, отчёты |

Дополнения (атомарные UC по входным документам):
| BR-014 Штамп РД | UC-21, UC-23, UC-25 | FR-OCR-05..06, FR-DAT-05..06 | Извлечение штампа PDF/DWG |
| BR-015 Табличное содержание | UC-22, UC-24, UC-26 | FR-TABLE-01..04; FR-FORMULA-01..02 | Извлечение таблиц/валидация формул |
| BR-016 Сметы нормализация | UC-27..UC-32, UC-35 | FR-ESTIMATE-01..06; FR-DAT-07; FR-EXCEL-05 | Модель Estimate и обмен |
| BR-018 Отчёты по шаблонам | UC-05, UC-15 | FR-EXCEL-TPL-01..04; FR-EXCEL-06..07 | Реестр/версионирование шаблонов |
| BR-017 Нормативные выжимки | UC-33, UC-34 | FR-NORM-05..06 | DOCX реквизиты и выжимки |

### 3.5 Метрики и критерии демо по прототипам

| Прототип | Цель | Метрики | Базовые целевые значения |
|---|---|---|---|
| Обучение системы | Качественное обучение на документах | Качество обучения, скорость обработки | ≥ 90% точность обучения |
| Текстовые запросы | Точные ответы на запросы | Точность ответов, скорость обработки | ≥ 90% точность, ≤ 5 сек |
| Проектно-ориентированность | Корректная привязка к проектам | Точность привязки, качество поиска аналогов | ≥ 85% точность привязки |
| OCR | Надежное распознавание для обучения | CER/WER, время/документ | CER/WER ≤ 5%, ≤ 30 сек |
| Header stamp (PDF/DWG) | Полнота реквизитов штампа | Field completeness, accuracy | ≥ 98% completeness, ≥ 97% accuracy |
| Estimates | Корректность парсинга смет | Totals delta, units check | totals delta ≤ 0.5%, ≥ 95% fields parsed |
| Excel отчеты | Качественные отчеты | Качество форматирования, скорость создания | ≥ 95% корректность, ≤ 10 сек |
| Нормативная база | Полная база знаний | Полнота нормативной базы | ≥ 90% покрытие ГОСТов |

Примечание: точные пороги согласуются с Заказчиком (см. «Открытые вопросы»).

Полный список метрик и статусы согласования см. в документе [metrics.md](metrics.md).

#### POC-интерпретация результатов
- Цель этапа — подтвердить/опровергнуть техническую осуществимость (feasibility), а не достигнуть продакшн‑SLA.
- Исход по каждому прототипу: Achieved / Partial / Not feasible now (с указанием причин: данные/модель/процесс).
- Недостижение порога допускается, если предоставлены воспроизводимые результаты, анализ ограничений и рекомендации (см. metrics.md: Status/Reason/Recommendation/Decision).

---

## 3. Нефункциональные требования

### 3.1 Безопасность и соответствие
- NFR-SEC-01: Доступ к данным прототипов ограничивается участниками проекта (ACL/роль).  
- NFR-SEC-02: Все данные заказчика хранятся и передаются в защищенном виде на уровне коммерческих документов.  
- NFR-SEC-03: Соблюдение требований ИБ заказчика на уровне коммерческих документов (не "для служебного пользования").  
- NFR-SEC-04: Логирование действий и аудиторский след обработки данных.  
- NFR-SEC-05: Ролевая модель с двумя типами пользователей: учитель системы и пользователь системы.  
- NFR-SEC-06: Разграничение доступа к функциям обучения и запросов по ролям пользователей.  
- NFR-SEC-07: Аудит доступа и действий пользователей с документами.  
- NFR-SEC-08: Отслеживание обновлений нормативной базы с фиксацией источника, даты и внесённых изменений.

### 3.2 Производительность и точность
- NFR-PERF-01: Время обработки текстового запроса — не более 5 секунд.  
- NFR-PERF-02: Время обучения системы на документе — не более 30 секунд.  
- NFR-PERF-03: Время формирования Excel отчета — не более 10 секунд.  
- NFR-PERF-04: Поддержка пакетной обработки документов для обучения (batch).  
- NFR-ACC-01: Целевая точность ответов на текстовые запросы — ≥ 90%.  
- NFR-ACC-02: Целевая точность обучения системы — ≥ 90%.  
- NFR-ACC-03: Целевая точность поиска аналогов по проектам — ≥ 85%.  
- NFR-ACC-04: Целевая точность OCR — ≥ 95%.  
- NFR-ACC-05: Целевая точность формирования Excel отчетов — ≥ 95%.

### 3.3 Надежность и отказоустойчивость
- NFR-REL-01: Прототипы корректно обрабатывают ошибки входных данных (битые файлы, неподдерживаемые форматы).  
- NFR-REL-02: Повторяемость результатов на одинаковых входах.  
- NFR-REL-03: Отдельные модули не блокируют работу других (изоляция прототипов).
- NFR-REL-04: Резервное копирование и восстановление знаний (моделей, обучающих выборок, правил) без потери контекста.

### 3.4 Масштабируемость
- NFR-SCAL-01: Возможность горизонтального масштабирования на уровне сервисов (в будущей системе).  
- NFR-SCAL-02: Отделимость модулей (OCR, NLP, DWG/сметы) для независимой эволюции.

### 3.5 SLA и эксплуатационные требования
- NFR-SLA-01: В рабочем прототипировании — режим best-effort; в промышленной системе — SLA согласуется отдельно.  
- NFR-OPS-01: Документированная процедура запуска/тестирования прототипов.  
- NFR-OPS-02: Хранение и версия образцов данных/результатов для воспроизводимости.
- NFR-OPS-03: Регламент обновления моделей (планирование, тестовый контур, критерии принятия и отката) согласуется до внедрения новой версии.
- NFR-OPS-04: Хранилище артефактов демо: структура каталогов для входов/выходов/логов; стандартизованные имена файлов.

(вопросы по хранению ПДн/ретенции — см. «Открытые вопросы»)

---

## 4. Архитектура и интерфейсы

### 4.1 Архитектурная схема продукта (Stage 2)

#### 4.1.1 Высокоуровневая архитектура
Продуктовая система «AI GOST» построена по модульной архитектуре с четким разделением ответственности:

**Уровень представления (Presentation Layer)**
- Web-интерфейс для учителей системы (загрузка документов, обучение, мониторинг)
- Web-интерфейс для пользователей системы (текстовые запросы, просмотр результатов)
- API Gateway для внешних интеграций
- Desktop-клиент для работы с локальными файлами (опционально)

**Уровень бизнес-логики (Business Logic Layer)**
- Модуль управления документами (Document Management Service)
- Модуль обучения системы (Learning Service)
- Модуль обработки запросов (Query Processing Service)
- Модуль проектного управления (Project Management Service)
- Модуль нормативной базы (Normative Service)
- Модуль отчетности (Reporting Service)

**Уровень обработки данных (Data Processing Layer)**
- OCR Engine (Tesseract/EasyOCR/PaddleOCR)
- Document Parser (PDF/DWG/ARP/GSFX/XML/XLS/DOCX)
- NLP Engine (классификация, извлечение сущностей)
- Knowledge Extraction Engine (структурирование данных)
- Template Engine (генерация Excel отчетов)

**Уровень данных (Data Layer)**
- Document Storage (файловое хранилище с метаданными)
- Knowledge Base (векторная база знаний)
- Project Database (проекты, пользователи, роли)
- Audit Log (журнал действий и обработки)
- Configuration Store (настройки системы)

#### 4.1.2 Компоненты системы

**Document Ingestion Service**
- Автоопределение типа документа (mc_pdf/scan_pdf/dwg/arp/gsfx/xml/xls/docx_normative)
- Валидация входных файлов
- Извлечение метаданных
- Привязка к проектам
- Очередь обработки документов

**OCR Processing Engine**
- Предобработка изображений (deskew, denoise, binarization)
- Распознавание текста с координатами
- Извлечение штампов (Title Block Extractor)
- Поддержка русского языка
- Batch-обработка документов

**Knowledge Extraction Service**
- Парсинг таблиц и структурированных данных
- Нормализация смет (ARP/GSFX/XML/XLS → Estimate model)
- Извлечение нормативных ссылок
- Валидация данных по схемам
- Создание векторных представлений

**Learning & Classification Service**
- Обучение на корпоративных документах
- Тематическая классификация документов
- Проектная классификация
- Поиск аналогов по проектам (semantic search)
- Обновление базы знаний

**Query Processing Service**
- Анализ текстовых запросов на русском языке
- Поиск в базе знаний
- Формирование структурированных ответов
- Генерация Excel отчетов по шаблонам
- Кэширование результатов

**Security & Access Control**
- Аутентификация пользователей
- Авторизация по ролям (учитель/пользователь/админ)
- Разграничение доступа к проектам
- Аудит действий пользователей
- Шифрование данных

#### 4.1.3 Потоки данных

**Поток обучения системы:**
1. Загрузка документа → Document Ingestion Service
2. Автоопределение типа → Document Parser
3. OCR/парсинг → OCR Processing Engine
4. Извлечение знаний → Knowledge Extraction Service
5. Обучение модели → Learning & Classification Service
6. Сохранение в базе знаний → Knowledge Base

**Поток обработки запросов:**
1. Текстовый запрос → Query Processing Service
2. Анализ запроса → NLP Engine
3. Поиск в базе знаний → Knowledge Base
4. Формирование ответа → Template Engine
5. Генерация отчета → Reporting Service
6. Возврат результата → Web-интерфейс

### 4.2 Технологический стек

#### 4.2.1 Основные технологии
- **Backend**: Python 3.11+ (FastAPI/Django)
- **Frontend**: React/Vue.js + TypeScript
- **Database**: PostgreSQL (основные данные) + Redis (кэш)
- **Vector Database**: FAISS/ChromaDB (база знаний)
- **OCR**: Tesseract + EasyOCR/PaddleOCR
- **NLP**: spaCy + transformers (BERT/RoBERTa)
- **File Storage**: MinIO/S3-совместимое хранилище
- **Message Queue**: Redis/RabbitMQ
- **Monitoring**: Prometheus + Grafana
- **Logging**: ELK Stack (Elasticsearch + Logstash + Kibana)

#### 4.2.2 Контейнеризация и развертывание
- **Containerization**: Docker + Docker Compose
- **Orchestration**: Kubernetes (для масштабирования)
- **CI/CD**: GitLab CI/GitHub Actions
- **Configuration**: Helm Charts
- **Secrets Management**: HashiCorp Vault

### 4.3 Интеграции

#### 4.3.1 Внутренние интеграции
- REST API для взаимодействия между сервисами
- Event-driven архитектура для асинхронной обработки
- Shared Database для общих данных
- File-based интеграции для batch-обработки

#### 4.3.2 Внешние интеграции (Stage 2)
- **ERP системы**: REST API/SOAP для обмена данными проектов
- **ECM системы**: WebDAV/FTP для документооборота
- **CAD системы**: DWG/DXF импорт/экспорт
- **Бухгалтерские системы**: Excel/CSV экспорт смет
- **Нормативные базы**: Локальные источники ГОСТов/СНиПов

#### 4.3.3 Форматы обмена данными
- **Входные**: PDF, JPG/PNG, DWG/DXF, ARP, GSFX, XML, XLS/XLSX, DOCX
- **Выходные**: XLSX (основной), JSON, CSV, PDF отчеты
- **API**: REST JSON, GraphQL (опционально)
- **Batch**: ZIP архивы с результатами обработки

### 4.4 Принципы архитектуры

#### 4.4.1 Локальность и автономность
- Полная изоляция от интернета (air-gapped environment)
- Локальные AI-модели и библиотеки
- Автономная работа всех компонентов
- Резервное копирование и восстановление

#### 4.4.2 Масштабируемость
- Горизонтальное масштабирование сервисов
- Микросервисная архитектура
- Асинхронная обработка документов
- Кэширование результатов

#### 4.4.3 Надежность
- Отказоустойчивость компонентов
- Graceful degradation при сбоях
- Retry механизмы для внешних вызовов
- Мониторинг состояния системы

#### 4.4.4 Безопасность
- Шифрование данных в покое и при передаче
- Аудит всех операций
- Разграничение доступа по ролям
- Защита от инъекций и атак

---

## 5. Эксплуатация и администрирование

### 5.1 Развертывание системы

#### 5.1.1 Требования к инфраструктуре
- **Минимальные требования**:
  - CPU: 8 ядер (Intel Xeon/AMD EPYC)
  - RAM: 32 GB (рекомендуется 64 GB)
  - Storage: 1 TB SSD (рекомендуется 2 TB)
  - Network: 1 Gbps локальная сеть
- **Рекомендуемые требования**:
  - CPU: 16+ ядер
  - RAM: 128+ GB
  - Storage: 4+ TB NVMe SSD
  - GPU: NVIDIA RTX 4090/A100 (для ускорения AI-моделей)

#### 5.1.2 Операционная система
- **Основная**: Ubuntu 22.04 LTS / CentOS Stream 9
- **Контейнеры**: Docker 24.0+ / Podman 4.0+
- **Оркестрация**: Kubernetes 1.28+ (опционально)

#### 5.1.3 Процедура развертывания
1. **Подготовка окружения**:
   - Установка Docker и Docker Compose
   - Настройка файрвола и сетевой безопасности
   - Создание пользователей и групп
2. **Развертывание сервисов**:
   - Запуск базовых сервисов (PostgreSQL, Redis, MinIO)
   - Развертывание AI-сервисов (OCR, NLP)
   - Настройка веб-интерфейса
3. **Конфигурация**:
   - Настройка параметров системы
   - Создание административных пользователей
   - Импорт начальных данных (ГОСТы, шаблоны)

### 5.2 Мониторинг и логирование

#### 5.2.1 Система мониторинга
- **Метрики производительности**:
  - CPU, RAM, Disk I/O, Network
  - Время обработки документов
  - Количество активных пользователей
  - Размер базы знаний
- **Метрики качества**:
  - Точность OCR распознавания
  - Качество классификации документов
  - Успешность обработки запросов
- **Алерты**:
  - Превышение лимитов ресурсов
  - Ошибки обработки документов
  - Сбои в работе сервисов

#### 5.2.2 Логирование
- **Структурированные логи** (JSON формат):
  - Логи обработки документов
  - Логи пользовательских действий
  - Логи системных событий
  - Логи ошибок и исключений
- **Ротация логов**:
  - Автоматическая ротация по размеру/времени
  - Сжатие старых логов
  - Архивирование критических событий

### 5.3 Резервное копирование и восстановление

#### 5.3.1 Стратегия резервного копирования
- **Ежедневные бэкапы**:
  - База данных PostgreSQL (полный дамп)
  - Файловое хранилище документов
  - Конфигурационные файлы
- **Еженедельные бэкапы**:
  - Полный образ системы
  - База знаний (векторные данные)
- **Хранение бэкапов**:
  - Локальное хранилище (30 дней)
  - Внешний носитель (90 дней)
  - Шифрование бэкапов

#### 5.3.2 Процедура восстановления
- **Восстановление базы данных**: из дампа PostgreSQL
- **Восстановление файлов**: из архива документов
- **Восстановление конфигурации**: из бэкапа настроек
- **Тестирование восстановления**: ежемесячные проверки

### 5.4 Обновления и миграции

#### 5.4.1 Обновление системы
- **Планирование обновлений**:
  - Уведомление пользователей за 48 часов
  - Создание резервной копии
  - Тестирование в тестовом окружении
- **Процедура обновления**:
  - Остановка сервисов
  - Обновление кода и конфигурации
  - Миграция базы данных
  - Запуск и проверка сервисов
- **Откат изменений**:
  - Процедура быстрого отката
  - Восстановление из бэкапа
  - Коммуникация с пользователями

#### 5.4.2 Миграция знаний
- **Обновление AI-моделей**:
  - Сохранение текущих моделей
  - Обучение новых моделей
  - Тестирование качества
  - Переключение на новые модели
- **Миграция базы знаний**:
  - Экспорт векторных представлений
  - Обновление схем данных
  - Импорт в новую структуру

### 5.5 Безопасность и соответствие

#### 5.5.1 Управление доступом
- **Аутентификация**:
  - Локальные учетные записи
  - Интеграция с Active Directory (опционально)
  - Двухфакторная аутентификация
- **Авторизация**:
  - Ролевая модель (учитель/пользователь/админ)
  - Разграничение доступа к проектам
  - Временные права доступа

#### 5.5.2 Защита данных
- **Шифрование**:
  - Данные в покое (AES-256)
  - Данные в передаче (TLS 1.3)
  - Шифрование бэкапов
- **Аудит безопасности**:
  - Логирование всех действий пользователей
  - Мониторинг подозрительной активности
  - Регулярные проверки безопасности

### 5.6 Производительность и масштабирование

#### 5.6.1 Оптимизация производительности
- **Кэширование**:
  - Redis для кэширования результатов запросов
  - Кэширование OCR результатов
  - Кэширование классификации документов
- **Параллельная обработка**:
  - Асинхронная обработка документов
  - Параллельное выполнение запросов
  - Batch-обработка больших объемов

#### 5.6.2 Масштабирование
- **Горизонтальное масштабирование**:
  - Добавление узлов обработки
  - Балансировка нагрузки
  - Распределение базы знаний
- **Вертикальное масштабирование**:
  - Увеличение ресурсов сервера
  - Оптимизация конфигурации
  - Использование GPU для AI-задач

---

## 6. Критерии приемки

### 6.1 Функциональные критерии
- **AC-FUNC-01**: Обучение документов — ≥90% без критических ошибок; контрольный пакет проходит end-to-end.
- **AC-FUNC-02**: Запросы — ≥90% релевантных ответов; время ответа ≤5 сек.
- **AC-FUNC-03**: Проектный контекст — 100% артефактов имеют projectId/rdCipher; ACL соблюден.
- **AC-FUNC-04**: OCR — точность CER/WER по целевым форматам ≥95% (печать); штампы/таблицы извлекаются с координатами.
- **AC-FUNC-05**: Excel/шаблоны — отчеты формируются ≤30 сек, структура/формулы валидированы (FR-EXCEL/FR-EXCEL-TPL).
- **AC-FUNC-06**: Нормативка — приоритетные ГОСТы покрыты ≥90%; валидации норм выполняются автоматически.

### 6.2 Нефункциональные критерии
- **AC-PERF-01**: Время OCR scan ≤30 сек/страница; PDF тип детектируется ≤3 сек (FR-OCR-06).
- **AC-PERF-02**: Обучение/нормализация одного документа ≤30 сек; экспорт/ответы ≤30 сек.
- **AC-SEC-01**: ACL/аутентификация/аудит включены; шифрование при хранении/передаче; air-gapped соблюден.
- **AC-REL-01**: Ошибки входа обрабатываются без падения; reproducible результаты на одинаковых входах; бэкап/restore проверен.
- **AC-SCAL-01**: Горизонтальное масштабирование поддержано; модули обновляются независимо; рост нагрузки обрабатывается линейно.

### 6.3 Критерии развертывания
- **AC-DEPLOY-01**: Сборка/запуск в Docker на целевом минимуме железа; конфиги через файлы/ENV.
- **AC-DEPLOY-02**: Мониторинг/логирование включены по умолчанию; обновления без потери данных.
- **AC-INT-01**: REST API доступен (CRUD, auth); импорт/экспорт стандартных форматов (Excel/JSON/CSV) работает; интеграции с корпоративными системами через утвержденные точки входа.

### 6.4 Пользовательский опыт
- **AC-UX-01**: UI понятен; загрузка документов без ошибок; ввод/обработка запросов удобны.
- **AC-UX-02**: Результаты отображаются ясно; поддержка русского языка полная; примеры/гайд доступны.

### 6.5 Порядок приемки
- **Шаг 1**: Функциональные проверки (обучение, запросы, OCR, Excel, нормативка) на контрольном пакете.
- **Шаг 2**: Нагрузочные проверки (время ответа, OCR/обучение) по SLA.
- **Шаг 3**: Безопасность (ACL, аудит, шифрование, air-gapped).
- **Шаг 4**: UX-тесты с пользователями и финальная сверка артефактов/логов.
5. **Интеграционное тестирование**: проверка внешних интеграций

#### 6.5.2 Критерии успеха
- **Все критически важные критерии (AC-FUNC-01..06, AC-SEC-01..05) выполнены**
- **≥90% некритических критериев выполнены**
- **Пользователи подтверждают готовность к продуктивному использованию**
- **Администраторы подтверждают готовность к эксплуатации**

Актуальные целевые значения и изменения метрик публикуются в [metrics.md](metrics.md).

### 5.2 Порядок демонстрации прототипов
- Демонстрация каждого прототипа (Обучение системы, Текстовые запросы, Проектно-ориентированная работа, OCR, Excel отчеты, Нормативная база) проводится на согласованном наборе документов Заказчика.  
- По результатам демонстрации предоставляются: отчет с метриками, выгрузки данных (Excel/JSON/CSV), описание выявленных ограничений и рекомендации.  
- Замечания Заказчика фиксируются и классифицируются (критичность/приоритет), по ним формируется план корректировок (если применимо).  
- POC-демо: в отчете обязательно указывать Status (Achieved/Partial/Not feasible now), Reason, Recommendation и Decision (Proceed/Iterate/Pivot/Stop) для каждого прототипа.

### 5.3 Условия согласования итогового ТЗ
- Итоговое ТЗ включает: функциональные/нефункциональные требования, архитектурное описание, спецификацию форматов данных, критерии приемки.  
- ТЗ считается согласованным после:  
  - (а) выполнения демонстраций прототипов согласно п.6.2;  
  - (б) достижения согласованных порогов метрик из п.6.1;  
  - (в) утверждения Заказчиком письменной версии ТЗ.  
- Сроки и порядок рассмотрения/правок — в соответствии с договором (до 10 рабочих дней на проверку; доработки по согласованию).

(конкретные значения порогов будут зафиксированы по итогам пилотных тестов)

---

## 6. Приложения

### 6.1 График работ и контрольные точки
Согласно Приложению 1 к договору №24/25 от 30.09.2025:
- Срок выполнения: 30 календарных дней с момента предоплаты.  
- Ключевые этапы:  
  - День 14: Завершение интервью с стейкхолдерами и анализа требований.  
  - День 21: Готовность первых прототипов (OCR, структурирование).  
  - День 28: Завершение архитектурной проработки и всех прототипов.  
  - День 30: Сдача итогового ТЗ и всех результатов.  
(точные даты будут внесены после получения предоплаты)

### 6.2 Состав команды проекта
Согласно Приложению 2 к договору:
- Менеджер проекта: 32 часа (координация, коммуникация).  
- Архитектор: 40 часов (системное проектирование, выбор технологий, документация).  
- Бизнес-аналитик: 40 часов (сбор требований, моделирование процессов).  
- Специалист по AI/ML: 20 часов (оценка моделей, прототипирование).  
Общие трудозатраты: 132 часа.

### 6.3 Описание ключевых прототипов
Согласно Приложению 3 к договору №24/25:

#### **Прототип 1: Извлечение данных**
- **Цель**: Проверка качества распознавания текста при обработке PDF, изображений DWG (.dwg), смет ARP (.arp), GSFX (.gsfx)
- **Описание реализации**: Модуль OCR с тестами на реальных и шумных данных, анализ точности распознавания
- **Критерии оценки эффективности**: Точность OCR, полнота извлечения текста, скорость обработки

#### **Прототип 2: Структурирование**
- **Цель**: Проверка способности объединять и организовывать табличные и текстовые данные
- **Описание реализации**: Алгоритмы группировки и классификации данных, тестирование на разных форматах
- **Критерии оценки эффективности**: Корректность структурирования, полнота классификации

#### **Прототип 3: Тематическая классификация**
- **Цель**: Оценка качества тематической классификации документов и данных
- **Описание реализации**: NLP-модели для тематической группировки, тестирование на тематических кейсах
- **Критерии оценки эффективности**: Метрики точности классификации (precision, recall, F1-score)

Каждый прототип — минимальная изолированная версия для проверки технической осуществимости конкретной задачи.

### 6.4 Ссылки на исходные документы
- Договор №24/25 от 30.09.2025 — основной документ проекта.  
- Приложение 1 — График работ и контрольные точки.  
- Приложение 2 — Состав персонала.  
- Приложение 3 — Описание ключевых прототипов.  
- Документы проекта: Vision Document (`../01-project-overview/project-vision.md`), BRD (`business-requirements.md`), Use Cases (`use-cases.md`).  
(пути к корпоративному хранилищу будут добавлены после размещения)

---

**Документ подготовлен в соответствии со стандартом IEEE 29148 (адаптированный).**  
**Статус**: Редактура завершена, требует валидации с Заказчиком и закрытия пунктов из раздела «Открытые вопросы».

---

## 7. Открытые вопросы и действия

### 7.1 Вопросы по прототипам (Stage 1)

| № | Тема | Описание вопроса | Ответственный | Дедлайн | Статус |
|---|---|---|---|---|---|
| OQ‑01 | Текстовые запросы | Конкретные примеры запросов для тестирования | BA/Client | TBD | Открыт |
| OQ‑02 | Проекты | Список проектов для тестирования (подстанция, козырек и т.д.) | BA/Client | TBD | Открыт |
| OQ‑03 | Нормативная база | Объем ГОСТов и регламентов для обучения | BA/Client | TBD | Открыт |
| OQ‑04 | Excel формат | Подтвердить Excel как основной выходной формат | BA/Client | TBD | Открыт |
| OQ‑05 | Диаграмма | Утвердить архитектурную диаграмму интеллектуальной системы | Архитектор | TBD | Открыт |
| OQ‑06 | Метрики | Зафиксировать пороги точности для интеллектуальной системы | BA/Client | TBD | Открыт |
| OQ‑07 | Эталоны XLS | Получить эталонные выходные XLS для целей операций (формирование спецификации, унификация, бюджетирование) | Client | TBD | Открыт |
| OQ‑08 | Шаблоны подразделений | Предоставить Excel‑шаблоны ПТО/Сметного отдела (листы, заголовки, формат чисел) | Client | TBD | Открыт |
 23| OQ‑09 | DWG‑слои/атрибуты | Согласовать минимальный список слоёв/атрибутов DWG для извлечения (штамп/табличные блоки) | Client/BA | TBD | Открыт |
| OQ‑10 | Приоритетные ГОСТы | Перечень приоритетных ГОСТов и формат номера/даты утверждения (нормализация) | Client/BA | TBD | Открыт |

### 7.2 Вопросы по продуктовой версии (Stage 2)

| № | Тема | Описание вопроса | Ответственный | Дедлайн | Статус |
|---|---|---|---|---|---|
| OQ‑11 | Инфраструктура | Требования к серверному оборудованию и сетевой инфраструктуре | Client/IT | TBD | Открыт |
| OQ‑12 | Интеграции | Список корпоративных систем для интеграции (ERP/ECM/CAD) | Client/IT | TBD | Открыт |
| OQ‑13 | Безопасность | Детальные требования ИБ и соответствие корпоративным стандартам | Client/IT | TBD | Открыт |
| OQ‑14 | Пользователи | Количество пользователей и роли в системе | Client/BA | TBD | Открыт |
| OQ‑15 | Данные | Объемы документов и требования к хранению | Client/IT | TBD | Открыт |
| OQ‑16 | SLA | Требования к доступности и времени отклика системы | Client/BA | TBD | Открыт |
| OQ‑17 | Обновления | Частота и процедуры обновления системы | Client/IT | TBD | Открыт |
| OQ‑18 | Поддержка | Требования к технической поддержке и обучению пользователей | Client/BA | TBD | Открыт |
| OQ‑19 | Лицензирование | Требования к лицензиям ПО и правовым аспектам | Client/Legal | TBD | Открыт |
| OQ‑20 | Миграция | Процедуры миграции данных из существующих систем | Client/IT | TBD | Открыт |

### 7.3 Приоритизация вопросов

**Критически важные (блокируют разработку)**:
- OQ‑07, OQ‑08, OQ‑09, OQ‑10 (эталоны и шаблоны для прототипов)
- OQ‑11, OQ‑12, OQ‑13 (инфраструктура и интеграции)

**Важные (влияют на архитектуру)**:
- OQ‑01, OQ‑02, OQ‑03 (тестовые данные)
- OQ‑14, OQ‑15, OQ‑16 (масштабирование)

**Желательные (оптимизация)**:
- OQ‑04, OQ‑05, OQ‑06 (форматы и метрики)
- OQ‑17, OQ‑18, OQ‑19, OQ‑20 (эксплуатация)
§
